<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SportHealth Management - Professional Edition</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
  <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E3A8A',
                        secondary: '#1F2937',
                        success: '#10B981',
                        energy: '#F97316',
                        neutral: '#F9FAFB'
                    }
                }
            }
        }
    </script>
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            box-sizing: border-box;
            background: #F9FAFB;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        
        /* Cards Profissionais */
        .card-professional {
            background: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid #E5E7EB;
        }
        
        .card-professional:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.15);
        }
        
        /* Stats Cards Premium */
        .stat-card {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%);
            border-radius: 16px;
            padding: 32px;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(30, 58, 138, 0.2);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .stat-card-success {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }
        
        .stat-card-energy {
            background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
        }
        
        /* Navegação Profissional */
        .nav-btn {
            color: #6B7280;
            transition: all 0.3s ease;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.875rem;
            position: relative;
        }
        
        .nav-btn:hover {
            color: #1E3A8A;
            background: #EFF6FF;
        }
        
        .nav-btn.active {
            color: #1E3A8A;
            background: #EFF6FF;
        }
        
        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 3px;
            background: #1E3A8A;
            border-radius: 2px 2px 0 0;
        }
        
        /* Botões Premium */
        .btn-primary {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%);
            color: #FFFFFF;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 700;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(30, 58, 138, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(30, 58, 138, 0.4);
        }
        
        .btn-secondary {
            background: #FFFFFF;
            color: #1E3A8A;
            border: 2px solid #1E3A8A;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 700;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #1E3A8A;
            color: #FFFFFF;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: #FFFFFF;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 700;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }
        
        /* Test Cards Profissionais */
        .test-card {
            background: #FFFFFF;
            border-radius: 16px;
            padding: 28px;
            transition: all 0.3s ease;
            border: 2px solid #E5E7EB;
            position: relative;
        }
        
        .test-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(30, 58, 138, 0.12);
            border-color: #1E3A8A;
        }
        
        /* Icon Badge Premium */
        .icon-badge {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);
            color: #1E3A8A;
            transition: all 0.3s ease;
        }
        
        .icon-badge:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%);
            color: #FFFFFF;
        }
        
        .icon-badge-success {
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
            color: #10B981;
        }
        
        .icon-badge-success:hover {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: #FFFFFF;
        }
        
        .icon-badge-energy {
            background: linear-gradient(135deg, #FED7AA 0%, #FDBA74 100%);
            color: #F97316;
        }
        
        .icon-badge-energy:hover {
            background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
            color: #FFFFFF;
        }
        
        /* Athlete Card Premium */
        .athlete-card {
            background: #FFFFFF;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
            border: 1px solid #E5E7EB;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .athlete-card:hover {
            border-color: #1E3A8A;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.15);
            transform: translateY(-2px);
        }
        
        /* Badge Profissional */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-primary {
            background: #EFF6FF;
            color: #1E3A8A;
            border: 1px solid #BFDBFE;
        }
        
        .badge-success {
            background: #D1FAE5;
            color: #059669;
            border: 1px solid #A7F3D0;
        }
        
        .badge-energy {
            background: #FED7AA;
            color: #EA580C;
            border: 1px solid #FDBA74;
        }
        
        .badge-neutral {
            background: #F3F4F6;
            color: #1F2937;
            border: 1px solid #E5E7EB;
        }
        
        /* Inputs Profissionais */
        input, select, textarea {
            background: #FFFFFF !important;
            border: 2px solid #E5E7EB !important;
            color: #1F2937 !important;
            transition: all 0.3s ease;
            border-radius: 10px !important;
            padding: 12px 16px !important;
            font-weight: 500;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #1E3A8A !important;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1) !important;
            outline: none !important;
        }
        
        label {
            color: #1F2937;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        /* Header Profissional */
        .header-professional {
            background: #FFFFFF;
            border-bottom: 1px solid #E5E7EB;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        /* Section Title Premium */
        .section-title {
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            color: #1F2937;
            position: relative;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #1E3A8A, #10B981);
            border-radius: 2px;
        }
        
        .section { display: none; }
        .section.active { display: block; }
        
        .loading-spinner {
            border: 2px solid #E5E7EB;
            border-top: 2px solid #1E3A8A;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 0.6s linear infinite;
            display: inline-block;
            margin-left: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .photo-preview {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            object-fit: cover;
            border: 3px solid #1E3A8A;
        }
        
        .modal-content {
            background: #FFFFFF;
            border-radius: 16px;
        }

        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 1000;
            padding: 16px 28px;
            border-radius: 12px;
            font-weight: 700;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            font-size: 0.875rem;
            border: 2px solid;
        }

        .notification.success {
            background: #D1FAE5;
            color: #059669;
            border-color: #10B981;
        }

        .notification.error {
            background: #FEE2E2;
            color: #DC2626;
            border-color: #EF4444;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #F3F4F6;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #9CA3AF;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #6B7280;
        }

        /* Animação de Entrada */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeInUp 0.5s ease-out;
        }

        /* Logo Style */
        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 900;
            box-shadow: 0 2px 8px rgba(30, 58, 138, 0.3);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body><!-- Header Professional -->
  <header class="header-professional sticky top-0 z-40">
   <div class="container mx-auto px-6 py-4">
    <div class="flex items-center justify-between">
     <div class="flex items-center space-x-4">
      <div class="logo-icon">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z" />
       </svg>
      </div>
      <div>
       <h1 id="app-title" class="text-2xl font-black tracking-tight" style="color: #1E3A8A;">SPORTHEALTH PRO</h1>
       <p id="app-subtitle" class="text-xs font-bold uppercase tracking-wider" style="color: #6B7280;">Gestão Profissional de Atletas</p>
      </div>
     </div>
     <nav class="flex space-x-2"><button onclick="showSection('dashboard')" class="nav-btn active"> Dashboard </button> <button onclick="showSection('athletes')" class="nav-btn"> Atletas </button> <button onclick="showSection('tests')" class="nav-btn"> Avaliações </button> <button onclick="showSection('records')" class="nav-btn"> Histórico </button>
     </nav>
    </div>
   </div>
  </header><!-- Main Content -->
  <main class="container mx-auto px-6 py-10"><!-- Dashboard Section -->
   <section id="dashboard" class="section active animate-in">
    <div class="mb-8">
     <h2 id="dashboard-title" class="text-4xl font-black mb-2" style="color: #1F2937;">Dashboard Executivo</h2>
     <p class="text-sm font-semibold" style="color: #6B7280;">Visão completa e profissional do desempenho</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
     <div class="stat-card animate-in" style="animation-delay: 0.1s">
      <div class="flex items-center justify-between relative z-10">
       <div>
        <p class="text-xs font-bold uppercase tracking-wider mb-3 opacity-90">Total de Avaliações</p>
        <p id="total-tests" class="text-5xl font-black">0</p>
       </div>
       <div class="icon-badge" style="background: rgba(255,255,255,0.2); color: white;">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
        </svg>
       </div>
      </div>
     </div>
     <div class="stat-card stat-card-success animate-in" style="animation-delay: 0.2s">
      <div class="flex items-center justify-between relative z-10">
       <div>
        <p class="text-xs font-bold uppercase tracking-wider mb-3 opacity-90">Atletas Ativos</p>
        <p id="total-athletes" class="text-5xl font-black">0</p>
       </div>
       <div class="icon-badge" style="background: rgba(255,255,255,0.2); color: white;">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
       </div>
      </div>
     </div>
     <div class="stat-card stat-card-energy animate-in" style="animation-delay: 0.3s">
      <div class="flex items-center justify-between relative z-10">
       <div>
        <p class="text-xs font-bold uppercase tracking-wider mb-3 opacity-90">Última Avaliaç��o</p>
        <p id="last-test-date" class="text-xl font-black">Nenhuma</p>
       </div>
       <div class="icon-badge" style="background: rgba(255,255,255,0.2); color: white;">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
       </div>
      </div>
     </div>
    </div>
    <div class="card-professional p-8 animate-in" style="animation-delay: 0.4s">
     <h3 class="text-2xl font-black mb-6" style="color: #1F2937;">Avaliações Recentes</h3>
     <div id="recent-tests" class="space-y-4">
      <p class="text-gray-400 text-center py-12 text-sm font-semibold">Nenhuma avaliação registrada ainda</p>
     </div>
    </div>
   </section><!-- Athletes Section -->
   <section id="athletes" class="section">
    <div class="flex justify-between items-center mb-8">
     <div>
      <h2 id="athletes-title" class="text-4xl font-black mb-2" style="color: #1F2937;">Base de Atletas</h2>
      <p class="text-sm font-semibold" style="color: #6B7280;">Gerencie todos os seus atletas profissionalmente</p>
     </div>
     <div class="flex space-x-3"><input type="file" accept="application/pdf" class="hidden" id="pdf-upload-input" onchange="handlePdfUpload(event)"> <button onclick="document.getElementById('pdf-upload-input').click()" class="btn-success flex items-center space-x-2">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
       </svg><span>Importar PDF</span> </button> <button onclick="createTestAthlete()" class="btn-secondary flex items-center space-x-2">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z" />
       </svg><span>Atleta Demo</span> </button> <button onclick="openAthleteForm()" class="btn-primary flex items-center space-x-2"> <span>
        <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
        </svg> Novo Atleta </span> </button>
     </div>
    </div>
    <div class="space-y-4">
     <div id="athletes-list">
      <p class="text-gray-400 text-center py-16 card-professional text-sm font-semibold">Nenhum atleta cadastrado</p>
     </div>
    </div>
   </section><!-- Tests Section -->
   <section id="tests" class="section">
    <div class="mb-8">
     <h2 id="tests-title" class="text-4xl font-black mb-2" style="color: #1F2937;">Avaliações Físicas</h2>
     <p class="text-sm font-semibold" style="color: #6B7280;">Escolha a avaliação profissional que deseja aplicar</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Yo-Yo Test -->
     <div class="test-card">
      <div class="flex items-center justify-between mb-5">
       <div class="icon-badge">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
       </div><span class="badge badge-primary">Cardio</span>
      </div>
      <h3 class="text-xl font-black mb-3" style="color: #1F2937;">Yo-Yo Test</h3>
      <p class="text-gray-600 text-sm mb-5 leading-relaxed font-medium">Avalia capacidade aeróbica e recuperação em exercícios intermitentes de alta intensidade</p><button onclick="openTestForm('Yo-Yo Test')" class="w-full btn-primary"> <span>Iniciar Teste</span> </button>
     </div><!-- Salto Vertical -->
     <div class="test-card">
      <div class="flex items-center justify-between mb-5">
       <div class="icon-badge-success icon-badge">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
       </div><span class="badge badge-success">Força</span>
      </div>
      <h3 class="text-xl font-black mb-3" style="color: #1F2937;">Salto Vertical</h3>
      <p class="text-gray-600 text-sm mb-5 leading-relaxed font-medium">Mede potência explosiva dos membros inferiores e força de impulsão</p><button onclick="openTestForm('Salto Vertical')" class="w-full btn-success"> <span>Iniciar Teste</span> </button>
     </div><!-- Sprint 30m -->
     <div class="test-card">
      <div class="flex items-center justify-between mb-5">
       <div class="icon-badge-energy icon-badge">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
        </svg>
       </div><span class="badge badge-energy">Velocidade</span>
      </div>
      <h3 class="text-xl font-black mb-3" style="color: #1F2937;">Sprint 30m</h3>
      <p class="text-gray-600 text-sm mb-5 leading-relaxed font-medium">Avalia velocidade máxima e aceleração em distância curta</p><button onclick="openTestForm('Sprint 30m')" class="w-full btn-primary"> <span>Iniciar Teste</span> </button>
     </div><!-- Flexibilidade -->
     <div class="test-card">
      <div class="flex items-center justify-between mb-5">
       <div class="icon-badge">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
       </div><span class="badge badge-neutral">Mobilidade</span>
      </div>
      <h3 class="text-xl font-black mb-3" style="color: #1F2937;">Flexibilidade</h3>
      <p class="text-gray-600 text-sm mb-5 leading-relaxed font-medium">Mede amplitude de movimento e flexibilidade da cadeia posterior</p><button onclick="openTestForm('Flexibilidade')" class="w-full btn-primary"> <span>Iniciar Teste</span> </button>
     </div><!-- Agilidade -->
     <div class="test-card">
      <div class="flex items-center justify-between mb-5">
       <div class="icon-badge-success icon-badge">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
        </svg>
       </div><span class="badge badge-success">Coordenação</span>
      </div>
      <h3 class="text-xl font-black mb-3" style="color: #1F2937;">Teste de Agilidade</h3>
      <p class="text-gray-600 text-sm mb-5 leading-relaxed font-medium">Avalia capacidade de mudança rápida de direção e coordenação motora</p><button onclick="openTestForm('Teste de Agilidade')" class="w-full btn-success"> <span>Iniciar Teste</span> </button>
     </div><!-- Resistência -->
     <div class="test-card">
      <div class="flex items-center justify-between mb-5">
       <div class="icon-badge-energy icon-badge">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
        </svg>
       </div><span class="badge badge-energy">Endurance</span>
      </div>
      <h3 class="text-xl font-black mb-3" style="color: #1F2937;">Resistência</h3>
      <p class="text-gray-600 text-sm mb-5 leading-relaxed font-medium">Mede capacidade aeróbica máxima com Cooper 12 minutos</p><button onclick="openTestForm('Resistência')" class="w-full btn-primary"> <span>Iniciar Teste</span> </button>
     </div>
    </div>
   </section><!-- Records Section -->
   <section id="records" class="section">
    <div class="mb-8">
     <h2 id="records-title" class="text-4xl font-black mb-2" style="color: #1F2937;">Histórico de Avaliações</h2>
     <p class="text-sm font-semibold" style="color: #6B7280;">Todos os registros profissionais de avaliações realizadas</p>
    </div>
    <div class="space-y-4">
     <div id="records-list">
      <p class="text-gray-400 text-center py-16 card-professional text-sm font-semibold">Nenhum registro encontrado</p>
     </div>
    </div>
   </section>
  </main><!-- Athlete Form Modal -->
  <div id="athlete-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 overflow-y-auto backdrop-blur-sm" style="display: none;">
   <div class="modal-content shadow-2xl max-w-5xl w-full mx-4 my-8 max-h-[90%] overflow-y-auto">
    <div class="sticky top-0 px-8 py-6 flex justify-between items-center rounded-t-2xl z-10" style="background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%);">
     <h3 class="text-2xl font-black text-white uppercase tracking-wide">Cadastro de Atleta</h3><button onclick="closeAthleteForm()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form id="athlete-form" onsubmit="submitAthlete(event)" class="p-8"><!-- Seção 1: Foto do Atleta -->
     <div class="mb-8">
      <h4 class="section-title">1. Foto do Atleta</h4>
      <div class="flex items-center space-x-6">
       <div id="photo-preview-container" class="hidden"><img id="photo-preview" class="photo-preview" alt="Preview da foto">
       </div>
       <div class="card-professional p-6 text-center flex-1">
        <div class="icon-badge mx-auto mb-4">
         <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
         </svg>
        </div>
        <p class="font-bold text-sm mb-1" style="color: #1F2937;">Selecionar Foto</p>
        <p class="text-xs text-gray-500 mb-4">JPG, PNG até 5MB</p><input type="file" accept="image/*" class="hidden" id="athlete-photo" onchange="previewPhoto(event)"> <button type="button" onclick="document.getElementById('athlete-photo').click()" class="btn-secondary text-xs"> Escolher Arquivo </button>
       </div>
      </div>
     </div><!-- Seção 2: Dados Pessoais -->
     <div class="mb-8">
      <h4 class="section-title">2. Dados Pessoais</h4>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
       <div class="md:col-span-2"><label for="athlete-full-name" class="block mb-2">Nome Completo *</label> <input type="text" id="athlete-full-name" required class="w-full">
       </div>
       <div><label for="athlete-birth-date" class="block mb-2">Data de Nascimento *</label> <input type="date" id="athlete-birth-date" required onchange="calculateDetailedAge(); calculateCategory();" class="w-full">
       </div>
       <div><label for="athlete-age-display" class="block mb-2">Idade</label>
        <div id="athlete-age-display" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 flex items-center min-h-[48px] text-gray-700 text-sm rounded-lg font-semibold">
         Preencha a data de nascimento
        </div>
       </div>
       <div><label for="athlete-sex" class="block mb-2">Sexo Biológico *</label> <select id="athlete-sex" required class="w-full"> <option value="">Selecione</option> <option value="Masculino">Masculino</option> <option value="Feminino">Feminino</option> </select>
       </div>
       <div><label for="athlete-rg" class="block mb-2">RG</label> <input type="text" id="athlete-rg" class="w-full">
       </div>
       <div><label for="athlete-phone" class="block mb-2">Telefone *</label> <input type="tel" id="athlete-phone" required placeholder="(11) 99999-9999" maxlength="15" class="w-full">
       </div>
       <div><label for="athlete-email" class="block mb-2">E-mail</label> <input type="email" id="athlete-email" class="w-full">
       </div>
       <div><label for="athlete-profession" class="block mb-2">Profissão</label> <input type="text" id="athlete-profession" class="w-full">
       </div>
       <div><label for="athlete-team" class="block mb-2">Equipe/Time *</label> <input type="text" id="athlete-team" required placeholder="Nome da equipe ou time" class="w-full">
       </div>
      </div><!-- Redes Sociais -->
      <div class="mt-6">
       <h5 class="text-xs font-bold text-gray-700 mb-4 uppercase tracking-wider">Redes Sociais</h5>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
        <div><label for="athlete-instagram" class="block mb-2">Instagram</label>
         <div class="flex"><span class="inline-flex items-center px-4 rounded-l-lg bg-gray-100 border-2 border-r-0 border-gray-300 text-gray-700 text-sm font-bold">@</span> <input type="text" id="athlete-instagram" placeholder="usuario" class="flex-1 rounded-r-lg" style="border-radius: 0 10px 10px 0 !important;">
         </div>
        </div>
        <div><label for="athlete-tiktok" class="block mb-2">TikTok</label>
         <div class="flex"><span class="inline-flex items-center px-4 rounded-l-lg bg-gray-100 border-2 border-r-0 border-gray-300 text-gray-700 text-sm font-bold">@</span> <input type="text" id="athlete-tiktok" placeholder="usuario" class="flex-1 rounded-r-lg" style="border-radius: 0 10px 10px 0 !important;">
         </div>
        </div>
       </div>
      </div>
     </div><!-- Seção 3: Endereço -->
     <div class="mb-8">
      <h4 class="section-title">3. Endereço</h4>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
       <div><label for="athlete-cep" class="block mb-2">CEP *</label> <input type="text" id="athlete-cep" placeholder="00000-000" maxlength="9" onblur="fetchAddressByCEP()" class="w-full">
        <div id="cep-loading" class="hidden mt-2 text-xs font-bold" style="color: #1E3A8A;"><span class="loading-spinner"></span> Buscando endereço...
        </div>
       </div>
       <div><label for="athlete-state" class="block mb-2">Estado</label> <input type="text" id="athlete-state" readonly class="w-full bg-gray-50">
       </div>
       <div><label for="athlete-city" class="block mb-2">Cidade</label> <input type="text" id="athlete-city" readonly class="w-full bg-gray-50">
       </div>
       <div><label for="athlete-neighborhood" class="block mb-2">Bairro</label> <input type="text" id="athlete-neighborhood" readonly class="w-full bg-gray-50">
       </div>
       <div><label for="athlete-address" class="block mb-2">Logradouro</label> <input type="text" id="athlete-address" placeholder="Rua, Avenida, etc." class="w-full">
       </div>
       <div><label for="athlete-number" class="block mb-2">Número *</label> <input type="text" id="athlete-number" required placeholder="123" class="w-full">
       </div>
       <div class="md:col-span-2"><label for="athlete-complement" class="block mb-2">Complemento</label> <input type="text" id="athlete-complement" placeholder="Apto 101, Bloco A, etc." class="w-full">
       </div>
      </div>
     </div><!-- Seção 4: Contato de Emergência -->
     <div class="mb-8">
      <h4 class="section-title">4. Contato de Emergência</h4>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
       <div><label for="guardian-name" class="block mb-2">Nome do Responsável *</label> <input type="text" id="guardian-name" required class="w-full">
       </div>
       <div><label for="guardian-relationship" class="block mb-2">Parentesco *</label> <select id="guardian-relationship" required class="w-full"> <option value="">Selecione</option> <option value="Pai">Pai</option> <option value="Mãe">Mãe</option> <option value="Avô">Avô</option> <option value="Avó">Avó</option> <option value="Tio">Tio</option> <option value="Tia">Tia</option> <option value="Irmão">Irmão</option> <option value="Irmã">Irmã</option> <option value="Tutor Legal">Tutor Legal</option> <option value="Outro">Outro</option> </select>
       </div>
       <div><label for="guardian-phone" class="block mb-2">Telefone do Responsável *</label> <input type="tel" id="guardian-phone" required placeholder="(11) 99999-9999" maxlength="15" class="w-full">
       </div>
       <div><label for="guardian-email" class="block mb-2">E-mail do Responsável</label> <input type="email" id="guardian-email" class="w-full">
       </div>
      </div><!-- Contatos Adicionais -->
      <div id="additional-contacts" class="mt-5 space-y-4"></div>
      <div class="mt-4"><button type="button" onclick="addEmergencyContact()" class="btn-secondary flex items-center space-x-2 text-xs">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
        </svg><span>Adicionar Contato</span> </button>
      </div>
     </div><!-- Seção 5: Dados Escolares -->
     <div class="mb-8">
      <h4 class="section-title">5. Dados Escolares</h4>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
       <div class="md:col-span-2"><label for="school-name" class="block mb-2">Nome da Escola</label> <input type="text" id="school-name" class="w-full">
       </div>
       <div><label for="school-grade" class="block mb-2">S��rie/Ano</label> <select id="school-grade" class="w-full"> <option value="">Selecione</option> <option value="1º Ano EF">1º Ano EF</option> <option value="2º Ano EF">2º Ano EF</option> <option value="3º Ano EF">3º Ano EF</option> <option value="4º Ano EF">4º Ano EF</option> <option value="5º Ano EF">5º Ano EF</option> <option value="6º Ano EF">6º Ano EF</option> <option value="7º Ano EF">7º Ano EF</option> <option value="8º Ano EF">8º Ano EF</option> <option value="9º Ano EF">9º Ano EF</option> <option value="1º Ano EM">1º Ano EM</option> <option value="2º Ano EM">2º Ano EM</option> <option value="3º Ano EM">3º Ano EM</option> <option value="Ensino Superior">Ensino Superior</option> <option value="Não Estuda">Não Estuda</option> </select>
       </div>
       <div><label for="school-shift" class="block mb-2">Turno</label> <select id="school-shift" class="w-full"> <option value="">Selecione</option> <option value="Matutino">Matutino</option> <option value="Vespertino">Vespertino</option> <option value="Noturno">Noturno</option> <option value="Integral">Integral</option> </select>
       </div>
       <div class="md:col-span-2"><label for="school-address" class="block mb-2">Endereço da Escola</label> <input type="text" id="school-address" class="w-full">
       </div>
       <div class="md:col-span-2"><label class="block mb-3">Compete pela Escola?</label>
        <div class="flex space-x-6"><label class="flex items-center cursor-pointer"> <input type="radio" name="competes-for-school" value="true" class="mr-3 w-5 h-5"> <span class="text-sm font-bold">Sim</span> </label> <label class="flex items-center cursor-pointer"> <input type="radio" name="competes-for-school" value="false" class="mr-3 w-5 h-5"> <span class="text-sm font-bold">Não</span> </label>
        </div>
       </div>
      </div>
     </div><!-- Seção 6: Dados Esportivos -->
     <div class="mb-8">
      <h4 class="section-title">6. Dados Esportivos</h4>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
       <div><label for="main-sport" class="block mb-2">Modalidade Principal *</label> <select id="main-sport" required onchange="updatePositions(); calculateCategory();" class="w-full"> <option value="">Selecione</option> <option value="Futebol">Futebol</option> <option value="Futsal">Futsal</option> <option value="Basquete">Basquete</option> <option value="Vôlei">Vôlei</option> <option value="Handebol">Handebol</option> <option value="Natação">Natação</option> <option value="Atletismo">Atletismo</option> <option value="Tênis">Tênis</option> <option value="Judô">Judô</option> <option value="Outro">Outro</option> </select>
       </div>
       <div><label for="position" class="block mb-2">Posição/Função</label> <select id="position" class="w-full"> <option value="">Selecione primeiro a modalidade</option> </select>
       </div>
       <div><label for="category-display" class="block mb-2">Categoria</label>
        <div id="category-display" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 flex items-center min-h-[48px] text-gray-700 text-sm rounded-lg font-semibold">
         Preencha data de nascimento e modalidade
        </div>
       </div>
       <div><label for="club" class="block mb-2">Clube/Equipe</label> <input type="text" id="club" class="w-full">
       </div>
       <div><label for="other-activities" class="block mb-2">Outras Atividades Físicas</label> <input type="text" id="other-activities" placeholder="Ex: Musculação, corrida" class="w-full">
       </div>
       <div><label for="athlete-status" class="block mb-2">Status do Atleta *</label> <select id="athlete-status" required class="w-full"> <option value="">Selecione</option> <option value="Ativo">Ativo</option> <option value="Lesionado">Lesionado</option> <option value="Suspenso">Suspenso</option> <option value="Inativo">Inativo</option> <option value="Aposentado">Aposentado</option> </select>
       </div>
      </div>
     </div><!-- Seção 7: Plano de Sa��de -->
     <div class="mb-8">
      <h4 class="section-title">7. Plano de Saúde</h4>
      <div class="grid grid-cols-1 gap-5">
       <div><label for="health-plan-type" class="block mb-2">Tipo de Plano *</label> <select id="health-plan-type" required onchange="toggleHealthPlanFields()" class="w-full"> <option value="">Selecione</option> <option value="sem-plano">Sem Plano</option> <option value="sus">SUS</option> <option value="particular">Particular</option> </select>
       </div><!-- Campos SUS -->
       <div id="sus-fields" class="hidden grid grid-cols-1 md:grid-cols-2 gap-5 p-6 bg-gray-50 rounded-xl border-2 border-gray-200">
        <div class="md:col-span-2">
         <h5 class="font-bold text-gray-700 mb-4 uppercase text-xs tracking-wider">Informações do SUS</h5>
        </div>
        <div><label for="sus-card-number" class="block mb-2">Número da Carteirinha SUS</label> <input type="text" id="sus-card-number" placeholder="000 0000 0000 0000" maxlength="19" class="w-full">
        </div>
        <div><label for="ubs-reference" class="block mb-2">UBS de Referência</label>
         <div class="flex space-x-2"><input type="text" id="ubs-reference" placeholder="Nome da UBS" readonly class="w-full bg-white"> <button type="button" onclick="searchUBSByAddress()" class="btn-secondary px-4 text-xs whitespace-nowrap"> Buscar UBS </button>
         </div>
         <div id="ubs-loading" class="hidden mt-2 text-xs font-bold" style="color: #1E3A8A;"><span class="loading-spinner"></span> Buscando UBS próxima...
         </div>
         <p class="text-xs text-gray-500 mt-2">A UBS será sugerida com base no endereço do atleta</p>
        </div>
       </div><!-- Campos Particular -->
       <div id="particular-fields" class="hidden grid grid-cols-1 md:grid-cols-2 gap-5 p-6 bg-gray-50 rounded-xl border-2 border-gray-200">
        <div class="md:col-span-2">
         <h5 class="font-bold text-gray-700 mb-4 uppercase text-xs tracking-wider">Plano Particular</h5>
        </div>
        <div><label for="health-insurance" class="block mb-2">Convênio *</label> <select id="health-insurance" onchange="updateHospitalsByPlan()" class="w-full"> <option value="">Selecione</option> <option value="Amil">Amil</option> <option value="Bradesco Saúde">Bradesco Saúde</option> <option value="Care Plus">Care Plus</option> <option value="Golden Cross">Golden Cross</option> <option value="Hapvida">Hapvida</option> <option value="NotreDame Intermédica">NotreDame Intermédica</option> <option value="Omint">Omint</option> <option value="Porto Seguro Saúde">Porto Seguro Saúde</option> <option value="Prevent Senior">Prevent Senior</option> <option value="SulAmérica">SulAmérica</option> <option value="Unimed">Unimed</option> <option value="Outro">Outro</option> </select>
        </div>
        <div><label for="insurance-card-number" class="block mb-2">Número da Carteirinha</label> <input type="text" id="insurance-card-number" placeholder="Número da carteirinha" class="w-full">
        </div>
        <div><label for="insurance-expiry" class="block mb-2">Data de Vencimento</label> <input type="date" id="insurance-expiry" class="w-full">
        </div>
        <div><label for="emergency-hospital" class="block mb-2">Hospital de Referência</label> <select id="emergency-hospital" class="w-full"> <option value="">Selecione primeiro o convênio</option> </select>
        </div>
       </div>
      </div>
     </div><!-- Seção 8: Documentos -->
     <div class="mb-8">
      <h4 class="section-title">8. Anexar Documentos</h4>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5"><!-- Carteirinha do Plano -->
       <div class="card-professional p-6 text-center">
        <div class="icon-badge mx-auto mb-4">
         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
         </svg>
        </div>
        <p class="font-bold text-sm mb-1" style="color: #1F2937;">Carteirinha do Plano</p>
        <p class="text-xs text-gray-500 mb-4">JPG, PNG até 5MB</p><input type="file" accept="image/*" class="hidden" id="health-card-doc" onchange="previewDocument(event, 'health-card')"> <button type="button" onclick="document.getElementById('health-card-doc').click()" class="btn-secondary text-xs"> Escolher Arquivo </button>
        <div id="health-card-preview" class="hidden mt-4 p-3 bg-green-50 text-green-700 rounded-lg text-xs font-bold border-2 border-green-200">
         ✓ Arquivo selecionado
        </div>
       </div><!-- RG -->
       <div class="card-professional p-6 text-center">
        <div class="icon-badge mx-auto mb-4">
         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
         </svg>
        </div>
        <p class="font-bold text-sm mb-1" style="color: #1F2937;">RG (Identidade)</p>
        <p class="text-xs text-gray-500 mb-4">JPG, PNG até 5MB</p><input type="file" accept="image/*" class="hidden" id="rg-doc" onchange="previewDocument(event, 'rg')"> <button type="button" onclick="document.getElementById('rg-doc').click()" class="btn-secondary text-xs"> Escolher Arquivo </button>
        <div id="rg-preview" class="hidden mt-4 p-3 bg-green-50 text-green-700 rounded-lg text-xs font-bold border-2 border-green-200">
         ✓ Arquivo selecionado
        </div>
       </div>
      </div>
     </div>
     <div class="flex space-x-4 pt-6 border-t-2 border-gray-200"><button type="button" onclick="closeAthleteForm()" class="flex-1 px-4 py-4 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-bold text-sm uppercase tracking-wide"> Cancelar </button> <button type="submit" id="athlete-submit-btn" class="flex-1 btn-primary py-4"> <span>Cadastrar Atleta</span> </button>
     </div>
    </form>
   </div>
  </div><!-- Athlete Details Modal -->
  <div id="athlete-details-modal" class="fixed inset-0 bg-black bg-opacity-60 items-center justify-center z-50 overflow-y-auto backdrop-blur-sm" style="display: none;">
   <div class="modal-content shadow-2xl max-w-6xl w-full mx-4 my-8 max-h-[90%] overflow-y-auto">
    <div class="sticky top-0 px-8 py-6 flex justify-between items-center rounded-t-2xl z-10" style="background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%);">
     <h3 class="text-2xl font-black text-white uppercase tracking-wide">Ficha Completa do Atleta</h3>
     <div class="flex items-center space-x-3"><button id="edit-athlete-btn" onclick="editAthlete()" class="btn-success px-4 py-3 flex items-center space-x-2 text-xs">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
       </svg><span>Editar</span> </button> <button onclick="closeAthleteDetails()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
    </div>
    <div id="athlete-details-content" class="p-8"><!-- Content will be populated dynamically -->
    </div>
   </div>
  </div><!-- Test Form Modal -->
  <div id="test-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 backdrop-blur-sm" style="display: none;">
   <div class="modal-content shadow-2xl p-8 max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-6">
     <h3 id="modal-title" class="text-2xl font-black" style="color: #1F2937;">Registrar Avaliação</h3><button onclick="closeTestForm()" class="text-gray-500 hover:bg-gray-100 rounded-full p-2 transition">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form id="test-form" onsubmit="submitTest(event)">
     <div class="space-y-4">
      <div><label for="athlete-name" class="block mb-2">Nome do Atleta</label> <input type="text" id="athlete-name" required class="w-full">
      </div>
      <div><label for="athlete-age" class="block mb-2">Idade</label> <input type="number" id="athlete-age" required min="5" max="25" class="w-full">
      </div>
      <div><label for="athlete-sport" class="block mb-2">Esporte</label> <input type="text" id="athlete-sport" required class="w-full">
      </div>
      <div><label for="test-date" class="block mb-2">Data da Avaliação</label> <input type="date" id="test-date" required class="w-full">
      </div>
      <div><label class="block mb-2" id="result-label">Resultado</label> <input type="number" id="test-result" required step="0.01" class="w-full">
      </div>
      <div><label for="test-notes" class="block mb-2">Observações</label> <textarea id="test-notes" rows="3" class="w-full"></textarea>
      </div>
     </div>
     <div class="flex space-x-4 mt-6"><button type="button" onclick="closeTestForm()" class="flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-bold text-sm uppercase"> Cancelar </button> <button type="submit" id="submit-btn" class="flex-1 btn-primary py-3 text-sm"> <span>Salvar Avaliação</span> </button>
     </div>
    </form>
   </div>
  </div>
  <script>
        const defaultConfig = {
            app_title: "SPORTHEALTH PRO",
            app_subtitle: "Gestão Profissional de Atletas",
            dashboard_title: "Dashboard Executivo",
            tests_title: "Avaliações Físicas",
            records_title: "Histórico de Avaliações",
            athletes_title: "Base de Atletas",
            primary_color: "#1E3A8A",
            secondary_color: "#1F2937",
            success_color: "#10B981",
            font_family: "Inter",
            font_size: 16
        };

        let currentTestType = '';
        let allRecords = [];
        let nextAthleteId = 110001;
        let currentEditingAthlete = null;
        let athletePhotos = {};
        let athleteDocuments = {};

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                allRecords = data;
                updateDashboard(data);
                updateRecordsList(data);
                updateAthletesList(data);
                updateNextAthleteId(data);
            }
        };

        function updateNextAthleteId(data) {
            const athletes = data.filter(record => record.record_type === 'athlete');
            if (athletes.length > 0) {
                const maxId = Math.max(...athletes.map(athlete => parseInt(athlete.athlete_id)));
                nextAthleteId = maxId + 1;
            }
        }

        function previewPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('Arquivo muito grande. Máximo 5MB permitido.', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('photo-preview');
                    const container = document.getElementById('photo-preview-container');
                    preview.src = e.target.result;
                    preview.dataset.photoData = e.target.result;
                    container.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function formatPhone(value) {
            return value
                .replace(/\D/g, '')
                .replace(/(\d{2})(\d)/, '($1) $2')
                .replace(/(\d{4})(\d)/, '$1-$2')
                .replace(/(\d{4})-(\d)(\d{4})/, '$1$2-$3')
                .replace(/(-\d{4})\d+?$/, '$1');
        }

        function formatCEP(value) {
            return value
                .replace(/\D/g, '')
                .replace(/(\d{5})(\d)/, '$1-$2')
                .replace(/(-\d{3})\d+?$/, '$1');
        }

        // Mapeamento de hospitais por plano de saúde em São Paulo
        const hospitalsByPlan = {
            'Amil': [
                'Hospital Albert Einstein',
                'Hospital Sírio-Libanês',
                'Hospital São Luiz',
                'Hospital Samaritano',
                'Hospital Villa Lobos',
                'Hospital Brasil',
                'BP - A Beneficência Portuguesa'
            ],
            'Bradesco Saúde': [
                'Hospital Albert Einstein',
                'Hospital Sírio-Libanês',
                'Hospital São Luiz',
                'Hospital Samaritano',
                'Hospital Oswaldo Cruz',
                'Hospital 9 de Julho',
                'BP - A Beneficência Portuguesa'
            ],
            'Care Plus': [
                'Hospital Albert Einstein',
                'Hospital Sírio-Libanês',
                'Hospital São Luiz',
                'Hospital Samaritano',
                'Hospital Villa Lobos'
            ],
            'Golden Cross': [
                'Hospital Albert Einstein',
                'Hospital Sírio-Libanês',
                'Hospital São Luiz',
                'Hospital Oswaldo Cruz',
                'BP - A Beneficência Portuguesa'
            ],
            'Hapvida': [
                'Hospital Santa Paula',
                'Hospital Santa Joana',
                'Hospital e Maternidade São Cristóvão',
                'Hospital Igesp',
                'Hospital San Paolo'
            ],
            'NotreDame Intermédica': [
                'Hospital Albert Einstein',
                'Hospital São Luiz',
                'Hospital Santa Paula',
                'Hospital Sepaco',
                'Hospital Santa Joana'
            ],
            'Omint': [
                'Hospital Albert Einstein',
                'Hospital Sírio-Libanês',
                'Hospital São Luiz',
                'Hospital Oswaldo Cruz',
                'Hospital Samaritano'
            ],
            'Porto Seguro Saúde': [
                'Hospital Albert Einstein',
                'Hospital São Luiz',
                'Hospital Samaritano',
                'Hospital e Maternidade Santa Joana',
                'Hospital Oswaldo Cruz'
            ],
            'Prevent Senior': [
                'Hospital Prevent Senior Santana',
                'Hospital Prevent Senior Vila Mariana',
                'Hospital Prevent Senior Mooca'
            ],
            'SulAmérica': [
                'Hospital Albert Einstein',
                'Hospital Sírio-Libanês',
                'Hospital São Luiz',
                'Hospital Oswaldo Cruz',
                'Hospital 9 de Julho',
                'BP - A Beneficência Portuguesa'
            ],
            'Unimed': [
                'Hospital Albert Einstein',
                'Hospital Sírio-Libanês',
                'Hospital São Luiz',
                'Hospital Santa Catarina',
                'Hospital e Maternidade São Luiz Itaim',
                'BP - A Beneficência Portuguesa'
            ]
        };

        // Mapeamento de UBS por bairro em São Paulo
        const ubsByNeighborhood = {
            'centro': 'UBS Santa Cecília',
            'santa cecilia': 'UBS Santa Cecília',
            'bela vista': 'UBS Bela Vista',
            'consolacao': 'UBS Consolação',
            'liberdade': 'UBS Liberdade',
            'republica': 'UBS República',
            'vila mariana': 'UBS Vila Mariana',
            'mooca': 'UBS Mooca',
            'tatuape': 'UBS Tatuapé',
            'ipiranga': 'UBS Ipiranga',
            'saude': 'UBS Saúde',
            'jabaquara': 'UBS Jabaquara',
            'santana': 'UBS Santana',
            'casa verde': 'UBS Casa Verde',
            'tucuruvi': 'UBS Tucuruvi',
            'vila maria': 'UBS Vila Maria',
            'vila guilherme': 'UBS Vila Guilherme',
            'pinheiros': 'UBS Pinheiros',
            'butanta': 'UBS Butantã',
            'lapa': 'UBS Lapa',
            'perdizes': 'UBS Perdizes',
            'vila leopoldina': 'UBS Vila Leopoldina',
            'jaguare': 'UBS Jaguaré',
            'itaim bibi': 'UBS Itaim Bibi',
            'vila olimpia': 'UBS Vila Olímpia',
            'moema': 'UBS Moema',
            'campo belo': 'UBS Campo Belo',
            'santo amaro': 'UBS Santo Amaro',
            'brooklin': 'UBS Brooklin',
            'vila andrade': 'UBS Vila Andrade',
            'morumbi': 'UBS Morumbi',
            'butanta': 'UBS Butantã',
            'penha': 'UBS Penha',
            'vila matilde': 'UBS Vila Matilde',
            'aricanduva': 'UBS Aricanduva',
            'itaquera': 'UBS Itaquera',
            'sao miguel': 'UBS São Miguel Paulista',
            'ermelino matarazzo': 'UBS Ermelino Matarazzo',
            'guaianases': 'UBS Guaianases',
            'cidade tiradentes': 'UBS Cidade Tiradentes',
            'sao mateus': 'UBS São Mateus',
            'sapopemba': 'UBS Sapopemba',
            'pirituba': 'UBS Pirituba',
            'freguesia do o': 'UBS Freguesia do Ó',
            'brasilandia': 'UBS Brasilândia',
            'cachoeirinha': 'UBS Cachoeirinha',
            'limao': 'UBS Limão',
            'campo limpo': 'UBS Campo Limpo',
            'capao redondo': 'UBS Capão Redondo',
            'jardim angela': 'UBS Jardim Ângela',
            'm boi mirim': 'UBS M\'Boi Mirim',
            'parelheiros': 'UBS Parelheiros',
            'socorro': 'UBS Socorro',
            'cidade dutra': 'UBS Cidade Dutra',
            'pedreira': 'UBS Pedreira',
            'cursino': 'UBS Cursino'
        };

        function updateHospitalsByPlan() {
            const planSelect = document.getElementById('health-insurance');
            const hospitalSelect = document.getElementById('emergency-hospital');
            const selectedPlan = planSelect.value;
            
            hospitalSelect.innerHTML = '<option value="">Selecione</option>';
            
            if (selectedPlan && hospitalsByPlan[selectedPlan]) {
                hospitalsByPlan[selectedPlan].forEach(hospital => {
                    const option = document.createElement('option');
                    option.value = hospital;
                    option.textContent = hospital;
                    hospitalSelect.appendChild(option);
                });
            } else if (selectedPlan === 'Outro') {
                hospitalSelect.innerHTML = '<option value="">Digite manualmente</option>';
                hospitalSelect.removeAttribute('readonly');
            }
        }

        function searchUBSByAddress() {
            const neighborhood = document.getElementById('athlete-neighborhood').value;
            const city = document.getElementById('athlete-city').value;
            const ubsInput = document.getElementById('ubs-reference');
            const loadingDiv = document.getElementById('ubs-loading');
            
            if (!neighborhood || !city) {
                showNotification('Preencha o endereço do atleta primeiro (CEP).', 'error');
                return;
            }
            
            if (city.toLowerCase() !== 'são paulo' && city.toLowerCase() !== 'sao paulo') {
                showNotification('Busca de UBS disponível apenas para São Paulo capital.', 'error');
                return;
            }
            
            loadingDiv.classList.remove('hidden');
            
            setTimeout(() => {
                const normalizedNeighborhood = neighborhood.toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '');
                
                let foundUBS = null;
                
                for (const [key, value] of Object.entries(ubsByNeighborhood)) {
                    if (normalizedNeighborhood.includes(key) || key.includes(normalizedNeighborhood)) {
                        foundUBS = value;
                        break;
                    }
                }
                
                if (foundUBS) {
                    ubsInput.value = foundUBS;
                    showNotification(`UBS encontrada: ${foundUBS}`, 'success');
                } else {
                    ubsInput.value = `UBS ${neighborhood}`;
                    showNotification(`Sugestão: UBS ${neighborhood}. Confirme com a região.`, 'success');
                }
                
                loadingDiv.classList.add('hidden');
            }, 1000);
        }

        let emergencyContactCount = 0;

        function addEmergencyContact() {
            emergencyContactCount++;
            const contactId = `emergency-${emergencyContactCount}`;
            
            const contactHtml = `
                <div id="${contactId}" class="card-professional p-5">
                    <div class="flex justify-between items-center mb-4">
                        <h5 class="font-bold text-gray-700 uppercase text-xs tracking-wider">Contato de Emergência ${emergencyContactCount + 1}</h5>
                        <button type="button" onclick="removeEmergencyContact('${contactId}')" class="text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full p-2 transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-2">Nome</label>
                            <input type="text" class="emergency-contact-name w-full">
                        </div>
                        <div>
                            <label class="block mb-2">Parentesco</label>
                            <select class="emergency-contact-relationship w-full">
                                <option value="">Selecione</option>
                                <option value="Pai">Pai</option>
                                <option value="Mãe">Mãe</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-2">Telefone</label>
                            <input type="tel" class="emergency-contact-phone w-full" placeholder="(11) 99999-9999" maxlength="15">
                        </div>
                        <div>
                            <label class="block mb-2">E-mail</label>
                            <input type="email" class="emergency-contact-email w-full">
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('additional-contacts').insertAdjacentHTML('beforeend', contactHtml);
            
            const newPhoneInput = document.querySelector(`#${contactId} .emergency-contact-phone`);
            newPhoneInput.addEventListener('input', function(e) {
                e.target.value = formatPhone(e.target.value);
            });
        }

        function removeEmergencyContact(contactId) {
            document.getElementById(contactId).remove();
        }

        function toggleHealthPlanFields() {
            const planType = document.getElementById('health-plan-type').value;
            const susFields = document.getElementById('sus-fields');
            const particularFields = document.getElementById('particular-fields');
            
            susFields.classList.add('hidden');
            particularFields.classList.add('hidden');
            
            if (planType === 'sus') {
                susFields.classList.remove('hidden');
            } else if (planType === 'particular') {
                particularFields.classList.remove('hidden');
            }
        }

        function previewDocument(event, docType) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('Arquivo muito grande. Máximo 5MB permitido.', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (!currentEditingAthlete) {
                        const tempId = `temp_${Date.now()}`;
                        if (!athleteDocuments[tempId]) {
                            athleteDocuments[tempId] = {};
                        }
                        athleteDocuments[tempId][docType] = e.target.result;
                        document.getElementById('athlete-form').dataset.tempId = tempId;
                    } else {
                        if (!athleteDocuments[currentEditingAthlete.athlete_id]) {
                            athleteDocuments[currentEditingAthlete.athlete_id] = {};
                        }
                        athleteDocuments[currentEditingAthlete.athlete_id][docType] = e.target.result;
                    }
                };
                reader.readAsDataURL(file);
                
                const previewDiv = document.getElementById(`${docType}-preview`);
                previewDiv.classList.remove('hidden');
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 5000);
        }

        // Add input formatting
        document.addEventListener('DOMContentLoaded', function() {
            const phoneInputs = document.querySelectorAll('#athlete-phone, #guardian-phone');
            phoneInputs.forEach(input => {
                input.addEventListener('input', function(e) {
                    e.target.value = formatPhone(e.target.value);
                });
            });

            const cepInput = document.getElementById('athlete-cep');
            cepInput.addEventListener('input', function(e) {
                e.target.value = formatCEP(e.target.value);
            });

            const susCardInput = document.getElementById('sus-card-number');
            susCardInput.addEventListener('input', function(e) {
                e.target.value = e.target.value
                    .replace(/\D/g, '')
                    .replace(/(\d{3})(\d)/, '$1 $2')
                    .replace(/(\d{4})(\d)/, '$1 $2')
                    .replace(/(\d{4})(\d)/, '$1 $2')
                    .replace(/(\d{4})\d+?$/, '$1');
            });
        });

        function openAthleteForm() {
            document.getElementById('athlete-modal').style.display = 'flex';
        }

        function closeAthleteForm() {
            document.getElementById('athlete-modal').style.display = 'none';
            document.getElementById('athlete-form').reset();
            document.getElementById('photo-preview-container').classList.add('hidden');
            document.getElementById('additional-contacts').innerHTML = '';
            document.getElementById('sus-fields').classList.add('hidden');
            document.getElementById('particular-fields').classList.add('hidden');
            document.getElementById('health-card-preview').classList.add('hidden');
            document.getElementById('rg-preview').classList.add('hidden');
            document.getElementById('athlete-submit-btn').innerHTML = '<span>Cadastrar Atleta</span>';
            
            const preview = document.getElementById('photo-preview');
            preview.src = '';
            preview.dataset.photoData = '';
            
            const formTempId = document.getElementById('athlete-form').dataset.tempId;
            if (formTempId && athleteDocuments[formTempId]) {
                delete athleteDocuments[formTempId];
            }
            document.getElementById('athlete-form').dataset.tempId = '';
            
            emergencyContactCount = 0;
            currentEditingAthlete = null;
        }

        function updatePositions() {
            const sport = document.getElementById('main-sport').value;
            const positionSelect = document.getElementById('position');
            
            positionSelect.innerHTML = '<option value="">Selecione</option>';
            
            const positions = {
                'Futebol': ['Goleiro', 'Zagueiro', 'Lateral', 'Volante', 'Meio-campo', 'Atacante'],
                'Basquete': ['Armador', 'Ala-Armador', 'Ala', 'Ala-Pivô', 'Pivô'],
                'Vôlei': ['Levantador', 'Oposto', 'Central', 'Ponteiro', 'Líbero'],
                'Handebol': ['Goleiro', 'Armador', 'Ponta', 'Pivô']
            };
            
            if (positions[sport]) {
                positions[sport].forEach(position => {
                    const option = document.createElement('option');
                    option.value = position;
                    option.textContent = position;
                    positionSelect.appendChild(option);
                });
            }
        }

        async function submitAthlete(event) {
            event.preventDefault();
            
            if (allRecords.length >= 999) {
                showNotification('Limite máximo de 999 registros atingido. Exclua alguns registros primeiro.', 'error');
                return;
            }

            const submitBtn = document.getElementById('athlete-submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span>Cadastrando...<span class="loading-spinner"></span></span>';
            
            const competesForSchool = document.querySelector('input[name="competes-for-school"]:checked');
            
            const additionalContacts = [];
            document.querySelectorAll('#additional-contacts > div').forEach((contactDiv, index) => {
                const name = contactDiv.querySelector('.emergency-contact-name').value;
                const relationship = contactDiv.querySelector('.emergency-contact-relationship').value;
                const phone = contactDiv.querySelector('.emergency-contact-phone').value;
                const email = contactDiv.querySelector('.emergency-contact-email').value;
                
                if (name || phone) {
                    additionalContacts.push({ name, relationship, phone, email });
                }
            });

            const photoPreview = document.getElementById('photo-preview');
            const photoData = photoPreview.dataset.photoData || null;

            const athleteId = currentEditingAthlete ? currentEditingAthlete.athlete_id : nextAthleteId.toString();

            const athleteData = {
                record_type: 'athlete',
                athlete_id: athleteId,
                athlete_name: document.getElementById('athlete-full-name').value,
                birth_date: document.getElementById('athlete-birth-date').value,
                biological_sex: document.getElementById('athlete-sex').value,
                rg: document.getElementById('athlete-rg').value || '',
                phone: document.getElementById('athlete-phone').value,
                email: document.getElementById('athlete-email').value || '',
                address: document.getElementById('athlete-address').value || '',
                address_number: document.getElementById('athlete-number').value,
                address_complement: document.getElementById('athlete-complement').value || '',
                city: document.getElementById('athlete-city').value || '',
                state: document.getElementById('athlete-state').value || '',
                neighborhood: document.getElementById('athlete-neighborhood').value || '',
                cep: document.getElementById('athlete-cep').value || '',
                profession: document.getElementById('athlete-profession').value || '',
                team: document.getElementById('athlete-team').value,
                instagram: document.getElementById('athlete-instagram').value || '',
                tiktok: document.getElementById('athlete-tiktok').value || '',
                guardian_name: document.getElementById('guardian-name').value,
                guardian_relationship: document.getElementById('guardian-relationship').value,
                guardian_phone: document.getElementById('guardian-phone').value,
                guardian_email: document.getElementById('guardian-email').value || '',
                additional_contacts: JSON.stringify(additionalContacts),
                health_plan_type: document.getElementById('health-plan-type').value,
                sus_card_number: document.getElementById('sus-card-number').value || '',
                ubs_reference: document.getElementById('ubs-reference').value || '',
                health_insurance: document.getElementById('health-insurance').value || '',
                insurance_card_number: document.getElementById('insurance-card-number').value || '',
                insurance_expiry: document.getElementById('insurance-expiry').value || '',
                emergency_hospital: document.getElementById('emergency-hospital').value || '',
                school_name: document.getElementById('school-name').value || '',
                school_grade: document.getElementById('school-grade').value || '',
                school_shift: document.getElementById('school-shift').value || '',
                school_address: document.getElementById('school-address').value || '',
                competes_for_school: competesForSchool ? (competesForSchool.value === 'true') : null,
                main_sport: document.getElementById('main-sport').value,
                position: document.getElementById('position').value || '',
                category: document.getElementById('category-display').textContent || '',
                club: document.getElementById('club').value || '',
                other_activities: document.getElementById('other-activities').value || '',
                athlete_status: document.getElementById('athlete-status').value,
                created_at: currentEditingAthlete ? currentEditingAthlete.created_at : new Date().toISOString()
            };
            
            if (photoData) {
                athletePhotos[athleteId] = photoData;
            }
            
            const formTempId = document.getElementById('athlete-form').dataset.tempId;
            if (formTempId && athleteDocuments[formTempId]) {
                athleteDocuments[athleteId] = athleteDocuments[formTempId];
                delete athleteDocuments[formTempId];
            }
            
            let result;
            if (currentEditingAthlete) {
                const updatedAthlete = { ...currentEditingAthlete, ...athleteData };
                result = await window.dataSdk.update(updatedAthlete);
            } else {
                result = await window.dataSdk.create(athleteData);
            }
            
            if (result.isOk) {
                closeAthleteForm();
                showSection('athletes');
                document.querySelectorAll('.nav-btn')[1].classList.add('active');
                showNotification(currentEditingAthlete ? 'Atleta atualizado com sucesso!' : `Atleta cadastrado com sucesso! ID: ${athleteId}`);
                currentEditingAthlete = null;
            } else {
                showNotification('Erro ao cadastrar atleta. Tente novamente.', 'error');
            }
            
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<span>Cadastrar Atleta</span>';
        }

        function updateAthletesList(data) {
            const athletes = data.filter(record => record.record_type === 'athlete');
            const athletesList = document.getElementById('athletes-list');
            
            if (athletes.length === 0) {
                athletesList.innerHTML = '<p class="text-gray-400 text-center py-16 card-professional text-sm font-semibold">Nenhum atleta cadastrado</p>';
                return;
            }
            
            const sortedAthletes = [...athletes].sort((a, b) => a.athlete_name.localeCompare(b.athlete_name));
            
            const athletesHtml = sortedAthletes.map(athlete => {
                const age = calculateAge(athlete.birth_date);
                const photoData = athletePhotos[athlete.athlete_id];
                
                return `
                    <div class="athlete-card cursor-pointer" onclick="showAthleteDetails('${athlete.__backendId}')">
                        <div class="flex items-start justify-between">
                            <div class="flex items-start space-x-5 flex-1">
                                <div class="flex-shrink-0">
                                    ${photoData ? 
                                        `<img src="${photoData}" alt="Foto de ${athlete.athlete_name}" class="w-20 h-20 rounded-xl object-cover border-3" style="border-color: #1E3A8A;">` :
                                        `<div class="w-20 h-20 rounded-xl flex items-center justify-center text-2xl font-black text-white" style="background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%);">${athlete.athlete_name.charAt(0).toUpperCase()}</div>`
                                    }
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 mb-3">
                                        <h4 class="text-xl font-black" style="color: #1F2937;">${athlete.athlete_name}</h4>
                                        <span class="badge badge-primary">ID: ${athlete.athlete_id}</span>
                                        <span class="badge badge-success">${athlete.main_sport}</span>
                                    </div>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                        <div>
                                            <p class="text-xs text-gray-500 uppercase font-bold mb-1 tracking-wider">Idade</p>
                                            <p class="font-black text-lg" style="color: #1F2937;">${age} anos</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500 uppercase font-bold mb-1 tracking-wider">Equipe</p>
                                            <p class="font-black" style="color: #1F2937;">${athlete.team}</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500 uppercase font-bold mb-1 tracking-wider">Posição</p>
                                            <p class="font-black" style="color: #1F2937;">${athlete.position || 'N/A'}</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500 uppercase font-bold mb-1 tracking-wider">Status</p>
                                            <p class="font-black" style="color: #1F2937;">${athlete.athlete_status}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="event.stopPropagation(); openTestFormForAthlete('${athlete.athlete_id}', '${athlete.athlete_name}')" class="btn-secondary px-4 py-3 text-xs">
                                    Nova Avaliação
                                </button>
                                <button onclick="event.stopPropagation(); deleteAthlete('${athlete.__backendId}')" class="text-gray-500 hover:bg-gray-100 p-3 rounded-lg transition">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            athletesList.innerHTML = athletesHtml;
        }

        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }

        function calculateDetailedAge() {
            const birthDateInput = document.getElementById('athlete-birth-date');
            const ageDisplay = document.getElementById('athlete-age-display');
            
            if (!birthDateInput.value) {
                ageDisplay.textContent = 'Preencha a data de nascimento';
                return;
            }
            
            const birthDate = new Date(birthDateInput.value);
            const today = new Date();
            
            let years = today.getFullYear() - birthDate.getFullYear();
            let months = today.getMonth() - birthDate.getMonth();
            let days = today.getDate() - birthDate.getDate();
            
            if (days < 0) {
                months--;
                const lastMonth = new Date(today.getFullYear(), today.getMonth(), 0);
                days += lastMonth.getDate();
            }
            
            if (months < 0) {
                years--;
                months += 12;
            }
            
            let ageText = '';
            if (years > 0) ageText += `${years} ano${years !== 1 ? 's' : ''}`;
            if (months > 0) {
                if (ageText) ageText += ', ';
                ageText += `${months} mês${months !== 1 ? 'es' : ''}`;
            }
            if (days > 0) {
                if (ageText) ageText += ' e ';
                ageText += `${days} dia${days !== 1 ? 's' : ''}`;
            }
            
            ageDisplay.textContent = ageText || '0 dias';
        }

        async function fetchAddressByCEP() {
            const cepInput = document.getElementById('athlete-cep');
            const cep = cepInput.value.replace(/\D/g, '');
            
            if (cep.length !== 8) return;
            
            const loadingDiv = document.getElementById('cep-loading');
            loadingDiv.classList.remove('hidden');
            
            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();
                
                if (!data.erro) {
                    document.getElementById('athlete-state').value = data.uf;
                    document.getElementById('athlete-city').value = data.localidade;
                    document.getElementById('athlete-neighborhood').value = data.bairro;
                    
                    if (data.logradouro) {
                        document.getElementById('athlete-address').value = data.logradouro;
                        document.getElementById('athlete-address').focus();
                    }
                } else {
                    showNotification('CEP não encontrado. Verifique o número digitado.', 'error');
                }
            } catch (error) {
                showNotification('Erro ao buscar CEP. Tente novamente.', 'error');
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }

        function calculateCategory() {
            const birthDateInput = document.getElementById('athlete-birth-date');
            const sportSelect = document.getElementById('main-sport');
            const categoryDisplay = document.getElementById('category-display');
            
            if (!birthDateInput.value || !sportSelect.value) {
                categoryDisplay.textContent = 'Preencha data de nascimento e modalidade';
                return;
            }
            
            const birthDate = new Date(birthDateInput.value);
            const today = new Date();
            const age = today.getFullYear() - birthDate.getFullYear();
            
            let category = '';
            
            if (age <= 11) category = 'Sub-11';
            else if (age <= 13) category = 'Sub-13';
            else if (age <= 15) category = 'Sub-15';
            else if (age <= 17) category = 'Sub-17';
            else if (age <= 20) category = 'Sub-20';
            else if (age <= 35) category = 'Adulto';
            else category = 'Master';
            
            categoryDisplay.textContent = category;
        }

        function openTestFormForAthlete(athleteId, athleteName) {
            document.getElementById('athlete-name').value = athleteName;
            document.getElementById('athlete-name').readOnly = true;
            document.getElementById('athlete-name').dataset.athleteId = athleteId;
            
            const athletes = allRecords.filter(record => record.record_type === 'athlete');
            const athlete = athletes.find(a => a.athlete_id === athleteId);
            if (athlete) {
                document.getElementById('athlete-age').value = calculateAge(athlete.birth_date);
                document.getElementById('athlete-sport').value = athlete.main_sport;
            }
            
            openTestForm('Yo-Yo Test');
        }

        function showAthleteDetails(backendId) {
            const athlete = allRecords.find(r => r.__backendId === backendId);
            if (!athlete) return;

            currentEditingAthlete = athlete;

            const age = calculateAge(athlete.birth_date);
            const photoData = athletePhotos[athlete.athlete_id];

            let healthPlanHtml = '';
            if (athlete.health_plan_type === 'sus') {
                healthPlanHtml = `
                    <div class="bg-gray-50 border-2 border-gray-200 rounded-xl p-6">
                        <h5 class="font-bold text-gray-700 mb-4 uppercase text-xs tracking-wider">SUS</h5>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Carteirinha SUS</p>
                                <p class="font-black" style="color: #1F2937;">${athlete.sus_card_number || 'Não informado'}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">UBS de Referência</p>
                                <p class="font-black" style="color: #1F2937;">${athlete.ubs_reference || 'Não informado'}</p>
                            </div>
                        </div>
                    </div>
                `;
            } else if (athlete.health_plan_type === 'particular') {
                healthPlanHtml = `
                    <div class="bg-gray-50 border-2 border-gray-200 rounded-xl p-6">
                        <h5 class="font-bold text-gray-700 mb-4 uppercase text-xs tracking-wider">Plano Particular</h5>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Convênio</p>
                                <p class="font-black" style="color: #1F2937;">${athlete.health_insurance || 'Não informado'}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Carteirinha</p>
                                <p class="font-black" style="color: #1F2937;">${athlete.insurance_card_number || 'Não informado'}</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                healthPlanHtml = `<p class="text-gray-500 text-sm font-semibold">Sem plano de saúde</p>`;
            }

            const detailsHtml = `
                <!-- Header with Photo -->
                <div class="flex items-start space-x-6 mb-8 pb-6 border-b-2 border-gray-200">
                    <div class="flex-shrink-0">
                        ${photoData ? 
                            `<img src="${photoData}" alt="Foto de ${athlete.athlete_name}" class="w-32 h-32 rounded-xl object-cover border-3" style="border-color: #1E3A8A;">` :
                            `<div class="w-32 h-32 rounded-xl flex items-center justify-center text-4xl font-black text-white" style="background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%);">${athlete.athlete_name.charAt(0).toUpperCase()}</div>`
                        }
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-3">
                            <h4 class="text-3xl font-black" style="color: #1F2937;">${athlete.athlete_name}</h4>
                            <span class="badge badge-primary">ID: ${athlete.athlete_id}</span>
                        </div>
                        <div class="flex items-center space-x-8 mt-4 text-sm">
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Idade</p>
                                <p class="text-2xl font-black" style="color: #1F2937;">${age} anos</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Modalidade</p>
                                <p class="text-2xl font-black" style="color: #1E3A8A;">${athlete.main_sport}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Status</p>
                                <p class="text-2xl font-black" style="color: #10B981;">${athlete.athlete_status}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dados Pessoais -->
                <div class="mb-8">
                    <h4 class="section-title">Dados Pessoais</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-5 card-professional p-6 text-sm">
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Nome Completo</p>
                            <p class="font-black" style="color: #1F2937;">${athlete.athlete_name}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Data de Nascimento</p>
                            <p class="font-black" style="color: #1F2937;">${new Date(athlete.birth_date).toLocaleDateString('pt-BR')}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Sexo</p>
                            <p class="font-black" style="color: #1F2937;">${athlete.biological_sex}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Telefone</p>
                            <p class="font-black" style="color: #1F2937;">${athlete.phone}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">E-mail</p>
                            <p class="font-black" style="color: #1F2937;">${athlete.email || 'Não informado'}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Equipe</p>
                            <p class="font-black" style="color: #1F2937;">${athlete.team}</p>
                        </div>
                    </div>
                </div>

                <!-- Endereço -->
                <div class="mb-8">
                    <h4 class="section-title">Endereço</h4>
                    <div class="card-professional p-6 text-sm">
                        <p class="font-black" style="color: #1F2937;">
                            ${athlete.address || 'N/A'}${athlete.address_number ? ', ' + athlete.address_number : ''}<br>
                            ${athlete.neighborhood ? athlete.neighborhood + ' - ' : ''}${athlete.city || 'N/A'} - ${athlete.state || 'N/A'}<br>
                            CEP: ${athlete.cep || 'N/A'}
                        </p>
                    </div>
                </div>

                <!-- Contatos de Emergência -->
                <div class="mb-8">
                    <h4 class="section-title">Contatos de Emergência</h4>
                    <div class="card-professional p-6">
                        <h5 class="font-bold text-gray-700 mb-4 uppercase text-xs tracking-wider">Respons��vel Principal</h5>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Nome</p>
                                <p class="font-black" style="color: #1F2937;">${athlete.guardian_name}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Parentesco</p>
                                <p class="font-black" style="color: #1F2937;">${athlete.guardian_relationship}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Telefone</p>
                                <p class="font-black" style="color: #1F2937;">${athlete.guardian_phone}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">E-mail</p>
                                <p class="font-black" style="color: #1F2937;">${athlete.guardian_email || 'Não informado'}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dados Esportivos -->
                <div class="mb-8">
                    <h4 class="section-title">Dados Esportivos</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-5 card-professional p-6 text-sm">
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Modalidade</p>
                            <p class="font-black" style="color: #1E3A8A;">${athlete.main_sport}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Posição</p>
                            <p class="font-black" style="color: #1F2937;">${athlete.position || 'Não informado'}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Categoria</p>
                            <p class="font-black" style="color: #1F2937;">${athlete.category || 'Não informado'}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Status</p>
                            <p class="font-black" style="color: #10B981;">${athlete.athlete_status}</p>
                        </div>
                    </div>
                </div>

                <!-- Plano de Saúde -->
                <div class="mb-8">
                    <h4 class="section-title">Plano de Saúde</h4>
                    ${healthPlanHtml}
                </div>

                <!-- Documentos Anexados -->
                <div class="mb-8">
                    <h4 class="section-title">Documentos Anexados</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        ${athleteDocuments[athlete.athlete_id]?.health_card ? `
                        <div class="card-professional p-6">
                            <div class="flex items-start space-x-4">
                                <div class="icon-badge flex-shrink-0">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-sm mb-2" style="color: #1F2937;">Carteirinha do Plano</p>
                                    <img src="${athleteDocuments[athlete.athlete_id].health_card}" alt="Carteirinha" class="w-full rounded-lg border-2 border-gray-200 cursor-pointer hover:border-blue-500 transition" onclick="window.open(this.src, '_blank')">
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${athleteDocuments[athlete.athlete_id]?.rg ? `
                        <div class="card-professional p-6">
                            <div class="flex items-start space-x-4">
                                <div class="icon-badge flex-shrink-0">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-sm mb-2" style="color: #1F2937;">RG (Identidade)</p>
                                    <img src="${athleteDocuments[athlete.athlete_id].rg}" alt="RG" class="w-full rounded-lg border-2 border-gray-200 cursor-pointer hover:border-blue-500 transition" onclick="window.open(this.src, '_blank')">
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${!athleteDocuments[athlete.athlete_id] || (!athleteDocuments[athlete.athlete_id].health_card && !athleteDocuments[athlete.athlete_id].rg) ? `
                        <div class="md:col-span-2">
                            <p class="text-gray-400 text-center py-8 text-sm font-semibold">Nenhum documento anexado</p>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;

            document.getElementById('athlete-details-content').innerHTML = detailsHtml;
            document.getElementById('athlete-details-modal').style.display = 'flex';
        }

        function closeAthleteDetails() {
            document.getElementById('athlete-details-modal').style.display = 'none';
        }

        async function createTestAthlete() {
            if (allRecords.length >= 999) {
                showNotification('Limite máximo de 999 registros atingido.', 'error');
                return;
            }

            const names = ['Lucas Silva', 'Maria Santos', 'Pedro Oliveira', 'Ana Costa', 'João Souza'];
            const sports = ['Futebol', 'Basquete', 'Vôlei', 'Handebol', 'Natação'];
            const teams = ['Equipe Alpha', 'Equipe Beta', 'Clube Esportivo'];
            
            const randomName = names[Math.floor(Math.random() * names.length)];
            const randomSport = sports[Math.floor(Math.random() * sports.length)];
            const randomTeam = teams[Math.floor(Math.random() * teams.length)];
            const randomAge = Math.floor(Math.random() * 10) + 10;
            
            const birthYear = new Date().getFullYear() - randomAge;
            const birthDate = `${birthYear}-${String(Math.floor(Math.random() * 12) + 1).padStart(2, '0')}-${String(Math.floor(Math.random() * 28) + 1).padStart(2, '0')}`;

            const athleteId = nextAthleteId.toString();

            const testAthleteData = {
                record_type: 'athlete',
                athlete_id: athleteId,
                athlete_name: randomName,
                birth_date: birthDate,
                biological_sex: Math.random() > 0.5 ? 'Masculino' : 'Feminino',
                rg: '',
                phone: `(11) 9${Math.floor(1000 + Math.random() * 9000)}-${Math.floor(1000 + Math.random() * 9000)}`,
                email: `${randomName.toLowerCase().replace(' ', '.')}@email.com`,
                address: 'Rua Exemplo',
                address_number: String(Math.floor(Math.random() * 1000) + 1),
                address_complement: '',
                city: 'São Paulo',
                state: 'SP',
                neighborhood: 'Centro',
                cep: '01000-000',
                profession: 'Estudante',
                team: randomTeam,
                instagram: randomName.toLowerCase().replace(' ', '.'),
                tiktok: '',
                guardian_name: 'Responsável Teste',
                guardian_relationship: 'Pai',
                guardian_phone: `(11) 9${Math.floor(1000 + Math.random() * 9000)}-${Math.floor(1000 + Math.random() * 9000)}`,
                guardian_email: 'responsavel@email.com',
                additional_contacts: '[]',
                health_plan_type: 'particular',
                sus_card_number: '',
                ubs_reference: '',
                health_insurance: 'Unimed',
                insurance_card_number: String(Math.floor(100000000000 + Math.random() * 900000000000)),
                insurance_expiry: '',
                emergency_hospital: 'Hospital Exemplo',
                school_name: 'Escola Teste',
                school_grade: '1º Ano EM',
                school_shift: 'Matutino',
                school_address: 'Rua da Escola, 123',
                competes_for_school: true,
                main_sport: randomSport,
                position: 'Atacante',
                category: `Sub-${randomAge + 2}`,
                club: randomTeam,
                other_activities: 'Musculação',
                athlete_status: 'Ativo',
                created_at: new Date().toISOString()
            };

            const result = await window.dataSdk.create(testAthleteData);

            if (result.isOk) {
                showNotification(`Atleta demo "${randomName}" criado! ID: ${athleteId}`);
            } else {
                showNotification('Erro ao criar atleta demo.', 'error');
            }
        }

        function editAthlete() {
            if (!currentEditingAthlete) return;
            
            closeAthleteDetails();
            
            document.getElementById('athlete-full-name').value = currentEditingAthlete.athlete_name || '';
            document.getElementById('athlete-birth-date').value = currentEditingAthlete.birth_date || '';
            document.getElementById('athlete-sex').value = currentEditingAthlete.biological_sex || '';
            document.getElementById('athlete-rg').value = currentEditingAthlete.rg || '';
            document.getElementById('athlete-phone').value = currentEditingAthlete.phone || '';
            document.getElementById('athlete-email').value = currentEditingAthlete.email || '';
            document.getElementById('athlete-profession').value = currentEditingAthlete.profession || '';
            document.getElementById('athlete-team').value = currentEditingAthlete.team || '';
            document.getElementById('athlete-instagram').value = currentEditingAthlete.instagram || '';
            document.getElementById('athlete-tiktok').value = currentEditingAthlete.tiktok || '';
            
            document.getElementById('athlete-cep').value = currentEditingAthlete.cep || '';
            document.getElementById('athlete-state').value = currentEditingAthlete.state || '';
            document.getElementById('athlete-city').value = currentEditingAthlete.city || '';
            document.getElementById('athlete-neighborhood').value = currentEditingAthlete.neighborhood || '';
            document.getElementById('athlete-address').value = currentEditingAthlete.address || '';
            document.getElementById('athlete-number').value = currentEditingAthlete.address_number || '';
            document.getElementById('athlete-complement').value = currentEditingAthlete.address_complement || '';
            
            document.getElementById('guardian-name').value = currentEditingAthlete.guardian_name || '';
            document.getElementById('guardian-relationship').value = currentEditingAthlete.guardian_relationship || '';
            document.getElementById('guardian-phone').value = currentEditingAthlete.guardian_phone || '';
            document.getElementById('guardian-email').value = currentEditingAthlete.guardian_email || '';
            
            document.getElementById('school-name').value = currentEditingAthlete.school_name || '';
            document.getElementById('school-grade').value = currentEditingAthlete.school_grade || '';
            document.getElementById('school-shift').value = currentEditingAthlete.school_shift || '';
            document.getElementById('school-address').value = currentEditingAthlete.school_address || '';
            
            if (currentEditingAthlete.competes_for_school !== null) {
                const radio = document.querySelector(`input[name="competes-for-school"][value="${currentEditingAthlete.competes_for_school}"]`);
                if (radio) radio.checked = true;
            }
            
            document.getElementById('main-sport').value = currentEditingAthlete.main_sport || '';
            updatePositions();
            document.getElementById('position').value = currentEditingAthlete.position || '';
            document.getElementById('club').value = currentEditingAthlete.club || '';
            document.getElementById('other-activities').value = currentEditingAthlete.other_activities || '';
            document.getElementById('athlete-status').value = currentEditingAthlete.athlete_status || '';
            
            document.getElementById('health-plan-type').value = currentEditingAthlete.health_plan_type || '';
            toggleHealthPlanFields();
            
            if (currentEditingAthlete.health_plan_type === 'sus') {
                document.getElementById('sus-card-number').value = currentEditingAthlete.sus_card_number || '';
                document.getElementById('ubs-reference').value = currentEditingAthlete.ubs_reference || '';
            } else if (currentEditingAthlete.health_plan_type === 'particular') {
                document.getElementById('health-insurance').value = currentEditingAthlete.health_insurance || '';
                updateHospitalsByPlan();
                document.getElementById('insurance-card-number').value = currentEditingAthlete.insurance_card_number || '';
                document.getElementById('insurance-expiry').value = currentEditingAthlete.insurance_expiry || '';
                setTimeout(() => {
                    document.getElementById('emergency-hospital').value = currentEditingAthlete.emergency_hospital || '';
                }, 100);
            }
            
            const photoData = athletePhotos[currentEditingAthlete.athlete_id];
            if (photoData) {
                const preview = document.getElementById('photo-preview');
                const container = document.getElementById('photo-preview-container');
                preview.src = photoData;
                preview.dataset.photoData = photoData;
                container.classList.remove('hidden');
            }
            
            calculateDetailedAge();
            calculateCategory();
            
            document.getElementById('athlete-submit-btn').innerHTML = '<span>Atualizar Atleta</span>';
            
            openAthleteForm();
        }

        async function deleteAthlete(backendId) {
            const athlete = allRecords.find(r => r.__backendId === backendId);
            if (!athlete) return;

            const deleteBtn = event.currentTarget;
            deleteBtn.disabled = true;
            deleteBtn.innerHTML = '<span class="loading-spinner"></span>';
            
            const result = await window.dataSdk.delete(athlete);
            
            if (!result.isOk) {
                showNotification('Erro ao excluir atleta.', 'error');
                deleteBtn.disabled = false;
                deleteBtn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>';
            }
        }

        // Initialize SDKs
        async function initializeApp() {
            const dataResult = await window.dataSdk.init(dataHandler);
            if (!dataResult.isOk) {
                console.error("Failed to initialize data SDK");
            }

            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        const customFont = config.font_family || defaultConfig.font_family;
                        const baseSize = config.font_size || defaultConfig.font_size;
                        const baseFontStack = 'Arial, sans-serif';

                        document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
                        document.body.style.fontSize = `${baseSize}px`;

                        document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
                        document.getElementById('app-subtitle').textContent = config.app_subtitle || defaultConfig.app_subtitle;
                        document.getElementById('dashboard-title').textContent = config.dashboard_title || defaultConfig.dashboard_title;
                        document.getElementById('tests-title').textContent = config.tests_title || defaultConfig.tests_title;
                        document.getElementById('records-title').textContent = config.records_title || defaultConfig.records_title;
                        document.getElementById('athletes-title').textContent = config.athletes_title || defaultConfig.athletes_title;

                        document.getElementById('app-title').style.fontSize = `${baseSize * 1.5}px`;
                        document.querySelectorAll('h2').forEach(el => el.style.fontSize = `${baseSize * 2}px`);
                        document.querySelectorAll('h3').forEach(el => el.style.fontSize = `${baseSize * 1.25}px`);
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [
                            {
                                get: () => config.primary_color || defaultConfig.primary_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.config.primary_color = value;
                                        window.elementSdk.setConfig({ primary_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.secondary_color || defaultConfig.secondary_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.config.secondary_color = value;
                                        window.elementSdk.setConfig({ secondary_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.success_color || defaultConfig.success_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.config.success_color = value;
                                        window.elementSdk.setConfig({ success_color: value });
                                    }
                                }
                            }
                        ],
                        borderables: [],
                        fontEditable: {
                            get: () => config.font_family || defaultConfig.font_family,
                            set: (value) => {
                                if (window.elementSdk) {
                                    window.elementSdk.config.font_family = value;
                                    window.elementSdk.setConfig({ font_family: value });
                                }
                            }
                        },
                        fontSizeable: {
                            get: () => config.font_size || defaultConfig.font_size,
                            set: (value) => {
                                if (window.elementSdk) {
                                    window.elementSdk.config.font_size = value;
                                    window.elementSdk.setConfig({ font_size: value });
                                }
                            }
                        }
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["app_title", config.app_title || defaultConfig.app_title],
                        ["app_subtitle", config.app_subtitle || defaultConfig.app_subtitle],
                        ["dashboard_title", config.dashboard_title || defaultConfig.dashboard_title],
                        ["tests_title", config.tests_title || defaultConfig.tests_title],
                        ["records_title", config.records_title || defaultConfig.records_title],
                        ["athletes_title", config.athletes_title || defaultConfig.athletes_title]
                    ])
                });
            }

            document.getElementById('test-date').valueAsDate = new Date();
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
        }

        function openTestForm(testType) {
            currentTestType = testType;
            document.getElementById('modal-title').textContent = `Registrar ${testType}`;
            
            const resultLabel = document.getElementById('result-label');
            const resultInput = document.getElementById('test-result');
            
            switch(testType) {
                case 'Yo-Yo Test':
                case 'Resistência':
                    resultLabel.textContent = 'Distância (metros)';
                    resultInput.placeholder = 'Ex: 1200';
                    break;
                case 'Salto Vertical':
                case 'Flexibilidade':
                    resultLabel.textContent = 'Altura/Distância (cm)';
                    resultInput.placeholder = 'Ex: 45';
                    break;
                case 'Sprint 30m':
                case 'Teste de Agilidade':
                    resultLabel.textContent = 'Tempo (segundos)';
                    resultInput.placeholder = 'Ex: 4.5';
                    break;
            }
            
            document.getElementById('test-modal').style.display = 'flex';
        }

        function closeTestForm() {
            document.getElementById('test-modal').style.display = 'none';
            document.getElementById('test-form').reset();
        }

        async function submitTest(event) {
            event.preventDefault();
            
            if (allRecords.length >= 999) {
                showNotification('Limite máximo atingido.', 'error');
                return;
            }

            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span>Salvando...<span class="loading-spinner"></span></span>';
            
            const athleteNameField = document.getElementById('athlete-name');
            const athleteId = athleteNameField.dataset.athleteId || 'manual';
            
            const testData = {
                record_type: 'test',
                athlete_id: athleteId,
                athlete_name: document.getElementById('athlete-name').value,
                test_type: currentTestType,
                test_date: document.getElementById('test-date').value,
                result_value: parseFloat(document.getElementById('test-result').value),
                notes: document.getElementById('test-notes').value,
                created_at: new Date().toISOString()
            };
            
            const result = await window.dataSdk.create(testData);
            
            if (result.isOk) {
                closeTestForm();
                showSection('records');
                document.querySelectorAll('.nav-btn')[3].classList.add('active');
                showNotification('Avaliação registrada com sucesso!');
            } else {
                showNotification('Erro ao salvar avaliação.', 'error');
            }
            
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<span>Salvar Avaliação</span>';
        }

        function updateDashboard(data) {
            const tests = data.filter(record => record.record_type === 'test');
            const athletes = data.filter(record => record.record_type === 'athlete');
            
            document.getElementById('total-tests').textContent = tests.length;
            document.getElementById('total-athletes').textContent = athletes.length;
            
            if (tests.length > 0) {
                const sortedTests = [...tests].sort((a, b) => new Date(b.test_date) - new Date(a.test_date));
                const lastTest = sortedTests[0];
                const date = new Date(lastTest.test_date);
                document.getElementById('last-test-date').textContent = date.toLocaleDateString('pt-BR');
                
                const recentTests = sortedTests.slice(0, 5);
                const recentTestsHtml = recentTests.map(test => {
                    const athlete = athletes.find(a => a.athlete_id === test.athlete_id);
                    const sport = athlete ? athlete.main_sport : 'N/A';
                    
                    return `
                        <div class="flex items-center justify-between p-5 card-professional">
                            <div class="flex-1">
                                <p class="font-black text-base" style="color: #1F2937;">${test.athlete_name}</p>
                                <p class="text-xs text-gray-600 font-semibold">${test.test_type} - ${sport}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-black text-2xl" style="color: #1E3A8A;">${test.result_value}</p>
                                <p class="text-xs text-gray-500 font-semibold">${new Date(test.test_date).toLocaleDateString('pt-BR')}</p>
                            </div>
                        </div>
                    `;
                }).join('');
                
                document.getElementById('recent-tests').innerHTML = recentTestsHtml;
            } else {
                document.getElementById('last-test-date').textContent = 'Nenhuma';
                document.getElementById('recent-tests').innerHTML = '<p class="text-gray-400 text-center py-12 text-sm font-semibold">Nenhuma avaliação registrada ainda</p>';
            }
        }

        function updateRecordsList(data) {
            const tests = data.filter(record => record.record_type === 'test');
            const athletes = data.filter(record => record.record_type === 'athlete');
            const recordsList = document.getElementById('records-list');
            
            if (tests.length === 0) {
                recordsList.innerHTML = '<p class="text-gray-400 text-center py-16 card-professional text-sm font-semibold">Nenhum registro encontrado</p>';
                return;
            }
            
            const sortedTests = [...tests].sort((a, b) => new Date(b.test_date) - new Date(a.test_date));
            
            const recordsHtml = sortedTests.map(test => {
                const athlete = athletes.find(a => a.athlete_id === test.athlete_id);
                const sport = athlete ? athlete.main_sport : 'N/A';
                const age = athlete ? calculateAge(athlete.birth_date) : 'N/A';
                
                return `
                    <div class="athlete-card mb-4">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-3">
                                    <h4 class="text-xl font-black" style="color: #1F2937;">${test.athlete_name}</h4>
                                    <span class="badge badge-primary">ID: ${test.athlete_id}</span>
                                    <span class="badge badge-success">${sport}</span>
                                </div>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                    <div>
                                        <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Avaliação</p>
                                        <p class="font-black" style="color: #1F2937;">${test.test_type}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Resultado</p>
                                        <p class="font-black text-2xl" style="color: #1E3A8A;">${test.result_value}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Idade</p>
                                        <p class="font-black" style="color: #1F2937;">${age} anos</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Data</p>
                                        <p class="font-black" style="color: #1F2937;">${new Date(test.test_date).toLocaleDateString('pt-BR')}</p>
                                    </div>
                                </div>
                                ${test.notes ? `<p class="text-xs text-gray-600 mt-3 font-semibold"><strong>Observações:</strong> ${test.notes}</p>` : ''}
                            </div>
                            <button onclick="deleteRecord('${test.__backendId}')" class="ml-4 text-gray-500 hover:bg-gray-100 p-3 rounded-lg transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            recordsList.innerHTML = recordsHtml;
        }

        async function deleteRecord(backendId) {
            const record = allRecords.find(r => r.__backendId === backendId);
            if (!record) return;

            const deleteBtn = event.currentTarget;
            deleteBtn.disabled = true;
            deleteBtn.innerHTML = '<span class="loading-spinner"></span>';
            
            const result = await window.dataSdk.delete(record);
            
            if (!result.isOk) {
                showNotification('Erro ao excluir registro.', 'error');
                deleteBtn.disabled = false;
                deleteBtn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>';
            }
        }

        async function handlePdfUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            showNotification('Processando PDF... Aguarde!');
            
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
                
                let fullText = '';
                
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + ' ';
                }
                
                fillFormFromPdfText(fullText);
                openAthleteForm();
                showNotification('PDF processado! Confira os dados preenchidos.', 'success');
                
            } catch (error) {
                console.error('Erro ao processar PDF:', error);
                showNotification('Erro ao processar PDF. Tente novamente.', 'error');
            }
            
            event.target.value = '';
        }

        function fillFormFromPdfText(text) {
            const normalizedText = text.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            
            const extractAfter = (keywords, defaultValue = '') => {
                for (let keyword of keywords) {
                    const regex = new RegExp(keyword + '[:\\s]*([^\\n]{1,100})', 'i');
                    const match = normalizedText.match(regex);
                    if (match && match[1].trim()) {
                        return match[1].trim().split(/\s{2,}/)[0].trim();
                    }
                }
                return defaultValue;
            };
            
            const extractDate = (keywords) => {
                for (let keyword of keywords) {
                    const regex = new RegExp(keyword + '[:\\s]*(\\d{2}[/-]\\d{2}[/-]\\d{4})', 'i');
                    const match = text.match(regex);
                    if (match && match[1]) {
                        const dateStr = match[1];
                        const parts = dateStr.split(/[/-]/);
                        if (parts.length === 3) {
                            return `${parts[2]}-${parts[1]}-${parts[0]}`;
                        }
                    }
                }
                return '';
            };
            
            const extractPhone = () => {
                const phoneRegex = /\(?\d{2}\)?\s?\d{4,5}[-\s]?\d{4}/g;
                const matches = text.match(phoneRegex);
                return matches ? matches[0].replace(/\D/g, '').replace(/(\d{2})(\d{4,5})(\d{4})/, '($1) $2-$3') : '';
            };
            
            const extractEmail = () => {
                const emailRegex = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g;
                const matches = text.match(emailRegex);
                return matches ? matches[0] : '';
            };
            
            const extractCEP = () => {
                const cepRegex = /\d{5}[-]?\d{3}/g;
                const matches = text.match(cepRegex);
                return matches ? matches[0].replace(/(\d{5})(\d{3})/, '$1-$2') : '';
            };
            
            const name = extractAfter(['nome completo', 'nome do atleta', 'nome', 'athlete name']);
            if (name) document.getElementById('athlete-full-name').value = name;
            
            const birthDate = extractDate(['data de nascimento', 'nascimento', 'dt nasc', 'birth date']);
            if (birthDate) {
                document.getElementById('athlete-birth-date').value = birthDate;
                calculateDetailedAge();
                calculateCategory();
            }
            
            const sexKeywords = ['sexo', 'genero', 'sex'];
            const sexText = extractAfter(sexKeywords);
            if (sexText.includes('masc') || sexText.includes('m')) {
                document.getElementById('athlete-sex').value = 'Masculino';
            } else if (sexText.includes('fem') || sexText.includes('f')) {
                document.getElementById('athlete-sex').value = 'Feminino';
            }
            
            const rg = extractAfter(['rg', 'identidade', 'documento']);
            if (rg) document.getElementById('athlete-rg').value = rg;
            
            const phone = extractPhone();
            if (phone) document.getElementById('athlete-phone').value = phone;
            
            const email = extractEmail();
            if (email) document.getElementById('athlete-email').value = email;
            
            const profession = extractAfter(['profissao', 'ocupacao', 'profession']);
            if (profession) document.getElementById('athlete-profession').value = profession;
            
            const team = extractAfter(['equipe', 'time', 'clube', 'team']);
            if (team) document.getElementById('athlete-team').value = team;
            
            const instagram = extractAfter(['instagram', 'insta', '@']);
            if (instagram) document.getElementById('athlete-instagram').value = instagram.replace('@', '');
            
            const cep = extractCEP();
            if (cep) {
                document.getElementById('athlete-cep').value = cep;
                setTimeout(() => fetchAddressByCEP(), 500);
            }
            
            const address = extractAfter(['endereco', 'logradouro', 'rua', 'avenida', 'address']);
            if (address) document.getElementById('athlete-address').value = address;
            
            const number = extractAfter(['numero', 'nº', 'n°', 'number']);
            if (number) document.getElementById('athlete-number').value = number;
            
            const complement = extractAfter(['complemento', 'apto', 'apartamento', 'bloco']);
            if (complement) document.getElementById('athlete-complement').value = complement;
            
            const guardianName = extractAfter(['nome do responsavel', 'responsavel', 'pai', 'mae', 'guardian']);
            if (guardianName) document.getElementById('guardian-name').value = guardianName;
            
            const relationship = extractAfter(['parentesco', 'relacao', 'relationship']);
            if (relationship) {
                const relationshipSelect = document.getElementById('guardian-relationship');
                if (relationship.includes('pai')) relationshipSelect.value = 'Pai';
                else if (relationship.includes('mae')) relationshipSelect.value = 'Mãe';
                else if (relationship.includes('avo')) relationshipSelect.value = 'Avô';
                else if (relationship.includes('avo')) relationshipSelect.value = 'Avó';
            }
            
            const guardianPhone = extractAfter(['telefone do responsavel', 'contato responsavel', 'tel responsavel']);
            if (guardianPhone) document.getElementById('guardian-phone').value = formatPhone(guardianPhone);
            
            const sport = extractAfter(['modalidade', 'esporte', 'sport']);
            if (sport) {
                const sportSelect = document.getElementById('main-sport');
                if (sport.includes('futebol') && !sport.includes('futsal')) sportSelect.value = 'Futebol';
                else if (sport.includes('futsal')) sportSelect.value = 'Futsal';
                else if (sport.includes('basquete') || sport.includes('basket')) sportSelect.value = 'Basquete';
                else if (sport.includes('volei') || sport.includes('voley')) sportSelect.value = 'Vôlei';
                else if (sport.includes('handebol') || sport.includes('handball')) sportSelect.value = 'Handebol';
                else if (sport.includes('natacao') || sport.includes('swim')) sportSelect.value = 'Natação';
                
                updatePositions();
                calculateCategory();
            }
            
            const position = extractAfter(['posicao', 'funcao', 'position']);
            if (position) document.getElementById('position').value = position;
            
            const status = extractAfter(['status', 'situacao']);
            if (status) {
                const statusSelect = document.getElementById('athlete-status');
                if (status.includes('ativo')) statusSelect.value = 'Ativo';
                else if (status.includes('lesionado')) statusSelect.value = 'Lesionado';
                else if (status.includes('inativo')) statusSelect.value = 'Inativo';
            }
            
            const planType = extractAfter(['plano de saude', 'convenio', 'health plan']);
            if (planType) {
                const planSelect = document.getElementById('health-plan-type');
                if (planType.includes('sus')) planSelect.value = 'sus';
                else if (planType.includes('particular') || planType.includes('privado')) planSelect.value = 'particular';
                else if (planType.includes('sem') || planType.includes('nao')) planSelect.value = 'sem-plano';
                
                toggleHealthPlanFields();
            }
        }

        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a2b7cb4b361b321',t:'MTc2Mzg0NjU5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>