<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SportHealth - Gest√£o de Sa√∫de para Atletas Jovens</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#ec4899',
                        accent: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Poppins', sans-serif; 
            box-sizing: border-box;
        }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .section { display: none; }
        .section.active { display: block; }
        .nav-btn.active { background: rgba(255, 255, 255, 0.2); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="bg-white p-2 rounded-full">
                        <svg class="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">SportHealth</h1>
                        <p class="text-sm opacity-90">Gest√£o de Sa√∫de para Atletas Jovens</p>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-6">
                    <button onclick="showSection('dashboard')" class="nav-btn hover:bg-white hover:bg-opacity-20 px-4 py-2 rounded-lg transition-all">
                        üìä Dashboard
                    </button>
                    <button onclick="showSection('athletes')" class="nav-btn hover:bg-white hover:bg-opacity-20 px-4 py-2 rounded-lg transition-all">
                        üë• Atletas
                    </button>
                    <button onclick="showSection('health')" class="nav-btn hover:bg-white hover:bg-opacity-20 px-4 py-2 rounded-lg transition-all">
                        üè• Sa√∫de
                    </button>
                    <button onclick="showSection('reports')" class="nav-btn hover:bg-white hover:bg-opacity-20 px-4 py-2 rounded-lg transition-all">
                        üìã Relat√≥rios
                    </button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Dashboard</h2>
                <p class="text-gray-600">Vis√£o geral do sistema de sa√∫de dos atletas</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-6 rounded-xl text-white card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100">Total de Atletas</p>
                            <p class="text-3xl font-bold" id="totalAthletes">1</p>
                        </div>
                        <div class="bg-white bg-opacity-20 p-3 rounded-full">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-green-500 to-green-600 p-6 rounded-xl text-white card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100">Exames em Dia</p>
                            <p class="text-3xl font-bold" id="upToDateExams">8</p>
                        </div>
                        <div class="bg-white bg-opacity-20 p-3 rounded-full">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 p-6 rounded-xl text-white card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-100">Exames Pendentes</p>
                            <p class="text-3xl font-bold" id="pendingExams">4</p>
                        </div>
                        <div class="bg-white bg-opacity-20 p-3 rounded-full">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-red-500 to-red-600 p-6 rounded-xl text-white card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-100">Alertas M√©dicos</p>
                            <p class="text-3xl font-bold" id="medicalAlerts">2</p>
                        </div>
                        <div class="bg-white bg-opacity-20 p-3 rounded-full">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Atividades Recentes</h3>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-3 p-3 bg-blue-50 rounded-lg">
                            <div class="bg-blue-500 p-2 rounded-full">
                                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">Novo atleta cadastrado</p>
                                <p class="text-sm text-gray-600">Maria Silva - Nata√ß√£o</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3 p-3 bg-green-50 rounded-lg">
                            <div class="bg-green-500 p-2 rounded-full">
                                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">Exame aprovado</p>
                                <p class="text-sm text-gray-600">Jo√£o Santos - Exame cardiol√≥gico</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg">
                            <div class="bg-yellow-500 p-2 rounded-full">
                                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">Exame vencendo</p>
                                <p class="text-sm text-gray-600">Ana Costa - Renovar em 7 dias</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Pr√≥ximos Vencimentos</h3>
                    <div class="space-y-4">
                        <div class="border-l-4 border-red-500 pl-4 py-2">
                            <p class="font-medium text-gray-800">Pedro Oliveira</p>
                            <p class="text-sm text-gray-600">Exame m√©dico - Vence em 3 dias</p>
                            <p class="text-xs text-red-600">Urgente</p>
                        </div>
                        <div class="border-l-4 border-yellow-500 pl-4 py-2">
                            <p class="font-medium text-gray-800">Lucas Ferreira</p>
                            <p class="text-sm text-gray-600">Exame cardiol√≥gico - Vence em 15 dias</p>
                            <p class="text-xs text-yellow-600">Aten√ß√£o</p>
                        </div>
                        <div class="border-l-4 border-blue-500 pl-4 py-2">
                            <p class="font-medium text-gray-800">Carla Mendes</p>
                            <p class="text-sm text-gray-600">Exame oftalmol√≥gico - Vence em 30 dias</p>
                            <p class="text-xs text-blue-600">Normal</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Athletes Section -->
        <div id="athletes" class="section">
            <div class="mb-8 flex justify-between items-center">
                <div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Gest√£o de Atletas</h2>
                    <p class="text-gray-600">Cadastro e acompanhamento de atletas at√© 18 anos</p>
                </div>
                <button onclick="showAddAthleteModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary-dark transition-all">
                    ‚ûï Novo Atleta
                </button>
            </div>

            <!-- Search and Filters -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="text" id="searchName" placeholder="Buscar por nome..." onkeyup="filterAthletes()" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                    <input type="text" id="searchId" placeholder="Buscar por ID..." onkeyup="filterAthletes()" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                    <select id="filterSport" onchange="filterAthletes()" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">Todos os esportes</option>
                    </select>
                    <select id="filterCategory" onchange="filterAthletes()" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">Todas as categorias</option>
                        <option value="Sub-11">Sub-11</option>
                        <option value="Sub-13">Sub-13</option>
                        <option value="Sub-15">Sub-15</option>
                        <option value="Sub-17">Sub-17</option>
                        <option value="Sub-20">Sub-20</option>
                    </select>
                </div>
                <div class="mt-4 text-sm text-gray-600">
                    <span id="athleteCount">0</span> atletas encontrados
                </div>
            </div>

            <!-- Athletes List -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Foto</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Idade</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Esporte</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="athletesTable">
                            <!-- Athletes will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Health Section -->
        <div id="health" class="section">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">√Årea de Sa√∫de</h2>
                <p class="text-gray-600">Dados de sa√∫de geral dos atletas</p>
            </div>

            <!-- Search for Athlete -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Buscar Atleta</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Buscar por Nome</label>
                        <input type="text" id="healthSearchName" placeholder="Digite o nome do atleta..." onkeyup="searchAthleteForHealth()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Buscar por ID</label>
                        <input type="text" id="healthSearchId" placeholder="Digite o ID do atleta..." onkeyup="searchAthleteForHealth()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                
                <!-- Search Results -->
                <div id="healthSearchResults" class="mt-6 hidden">
                    <h4 class="text-lg font-medium text-gray-800 mb-4">Resultados da Busca</h4>
                    <div id="healthAthletesList" class="space-y-3">
                        <!-- Athletes will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Selected Athlete Health Panel -->
            <div id="selectedAthletePanel" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-4">
                        <div id="selectedAthletePhoto" class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden">
                            <svg class="w-8 h-8 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div>
                            <h3 id="selectedAthleteName" class="text-xl font-semibold text-gray-800"></h3>
                            <p id="selectedAthleteInfo" class="text-sm text-gray-600"></p>
                        </div>
                    </div>
                    <button onclick="showNewHealthRecordModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary-dark transition-all">
                        ‚ûï Nova Ficha
                    </button>
                </div>
                
                <!-- Health Records List -->
                <div id="healthRecordsList" class="space-y-4">
                    <div class="text-center py-8 text-gray-500">
                        <svg class="w-12 h-12 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 6.306a7.962 7.962 0 00-6 0m6 0V3a1 1 0 00-1-1H10a1 1 0 00-1 1v3.306"/>
                        </svg>
                        <p class="text-lg font-medium">Nenhuma ficha de sa√∫de cadastrada</p>
                        <p class="text-sm">Clique em "Nova Ficha" para adicionar dados de sa√∫de</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Relat√≥rios</h2>
                <p class="text-gray-600">An√°lises e relat√≥rios do sistema</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Gerar Relat√≥rio</h3>
                    <form class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Relat√≥rio</label>
                            <select class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option>Relat√≥rio Geral de Atletas</option>
                                <option>Relat√≥rio de Exames M√©dicos</option>
                                <option>Relat√≥rio de Vencimentos</option>
                                <option>Relat√≥rio por Esporte</option>
                                <option>Relat√≥rio por Faixa Et√°ria</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Data Inicial</label>
                                <input type="date" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Data Final</label>
                                <input type="date" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg hover:bg-primary-dark transition-all">
                            Gerar Relat√≥rio
                        </button>
                    </form>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Relat√≥rios Recentes</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <p class="font-medium text-gray-800">Relat√≥rio Mensal - Dezembro</p>
                                <p class="text-sm text-gray-600">Gerado em 01/01/2024</p>
                            </div>
                            <button class="text-primary hover:text-primary-dark">
                                üì• Download
                            </button>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <p class="font-medium text-gray-800">Exames Vencidos - Q4</p>
                                <p class="text-sm text-gray-600">Gerado em 28/12/2023</p>
                            </div>
                            <button class="text-primary hover:text-primary-dark">
                                üì• Download
                            </button>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <p class="font-medium text-gray-800">Atletas por Esporte</p>
                                <p class="text-sm text-gray-600">Gerado em 15/12/2023</p>
                            </div>
                            <button class="text-primary hover:text-primary-dark">
                                üì• Download
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Athlete Profile Modal -->
    <div id="athleteProfileModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-6xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center space-x-4">
                    <div id="profilePhoto" class="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden">
                        <svg class="w-10 h-10 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div>
                        <h3 id="profileName" class="text-2xl font-bold text-gray-800"></h3>
                        <p id="profileId" class="text-sm text-gray-600"></p>
                    </div>
                </div>
                <div class="flex space-x-3">
                    <button id="editAthleteBtn" onclick="editAthlete()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary-dark transition-all flex items-center space-x-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        <span>Editar</span>
                    </button>
                    <button id="deleteAthleteBtn" onclick="confirmDeleteAthlete()" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-all flex items-center space-x-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                        <span>Excluir</span>
                    </button>
                    <button onclick="hideAthleteProfile()" class="text-gray-500 hover:text-gray-700 p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div id="profileContent" class="space-y-6">
                <!-- Profile content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Add Athlete Modal -->
    <div id="addAthleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-2xl font-bold text-gray-800">Cadastrar Novo Atleta</h3>
                    <p class="text-sm text-gray-600">ID ser√° gerado automaticamente: <span id="nextAthleteId" class="font-semibold text-primary"></span></p>
                </div>
                <button onclick="hideAddAthleteModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <form id="addAthleteForm" class="space-y-8">
                <!-- 1. Foto do Atleta -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">1. Foto do Atleta</h4>
                    <div class="flex items-center space-x-6">
                        <div class="flex-shrink-0">
                            <div id="photoPreview" class="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden">
                                <svg class="w-12 h-12 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                        </div>
                        <div>
                            <input type="file" id="athletePhoto" accept="image/jpeg,image/png" class="hidden">
                            <button type="button" onclick="document.getElementById('athletePhoto').click()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-all">
                                Selecionar Foto
                            </button>
                            <p class="text-sm text-gray-500 mt-2">JPG, PNG at√© 5MB</p>
                        </div>
                    </div>
                </div>

                <!-- 2. Dados Pessoais -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">2. Dados Pessoais</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo *</label>
                            <input type="text" name="fullName" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data de Nascimento *</label>
                            <input type="date" name="birthDate" required onchange="calculateAge(); calculateCategory();" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Idade</label>
                            <input type="text" id="ageDisplay" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Sexo Biol√≥gico *</label>
                            <select name="gender" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="masculino">Masculino</option>
                                <option value="feminino">Feminino</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">RG</label>
                            <input type="text" name="rg" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefone *</label>
                            <input type="tel" name="phone" required placeholder="(11) 99999-9999" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
                            <input type="email" name="email" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Profiss√£o</label>
                            <input type="text" name="profession" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Equipe/Time *</label>
                            <input type="text" name="team" required placeholder="Nome da equipe ou time" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                    </div>
                    
                    <!-- Redes Sociais -->
                    <div class="mt-6">
                        <h5 class="text-md font-medium text-gray-700 mb-3">Redes Sociais</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Instagram</label>
                                <div class="flex">
                                    <span class="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">@</span>
                                    <input type="text" name="instagram" placeholder="usuario" class="flex-1 border border-gray-300 rounded-r-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">TikTok</label>
                                <div class="flex">
                                    <span class="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">@</span>
                                    <input type="text" name="tiktok" placeholder="usuario" class="flex-1 border border-gray-300 rounded-r-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. Endere√ßo -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">3. Endere√ßo</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">CEP *</label>
                            <input type="text" name="cep" id="cepInput" required placeholder="00000-000" onblur="searchCEP()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            <p class="text-xs text-gray-500 mt-1">Digite o CEP para preenchimento autom√°tico</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Estado</label>
                            <select name="state" id="stateSelect" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amap√°</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Cear√°</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Esp√≠rito Santo</option>
                                <option value="GO">Goi√°s</option>
                                <option value="MA">Maranh√£o</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Par√°</option>
                                <option value="PB">Para√≠ba</option>
                                <option value="PR">Paran√°</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piau√≠</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rond√¥nia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">S√£o Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cidade</label>
                            <input type="text" name="city" id="cityInput" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Bairro</label>
                            <input type="text" name="neighborhood" id="neighborhoodInput" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Endere√ßo</label>
                            <input type="text" name="address" id="addressInput" placeholder="Rua, Avenida" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">N√∫mero</label>
                            <input type="text" name="addressNumber" placeholder="123" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Complemento</label>
                            <input type="text" name="addressComplement" placeholder="Apartamento, bloco, casa..." class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- 4. Contato de Emerg√™ncia -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">4. Contato de Emerg√™ncia</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Respons√°vel</label>
                            <input type="text" name="guardianName" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Parentesco</label>
                            <select name="guardianRelation" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="pai">Pai</option>
                                <option value="mae">M√£e</option>
                                <option value="avo">Av√¥/Av√≥</option>
                                <option value="tio">Tio/Tia</option>
                                <option value="tutor">Tutor Legal</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefone do Respons√°vel</label>
                            <input type="tel" name="guardianPhone" placeholder="(11) 99999-9999" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">E-mail do Respons√°vel</label>
                            <input type="email" name="guardianEmail" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div class="md:col-span-2">
                            <button type="button" onclick="addNewContact()" class="bg-accent text-white px-4 py-2 rounded-lg hover:bg-accent-dark transition-all">
                                ‚ûï Adicionar Novo Contato de Emerg√™ncia
                            </button>
                            <div id="additionalContacts" class="mt-4 space-y-4"></div>
                        </div>
                    </div>
                </div>

                <!-- 5. Dados Escolares -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">5. Dados Escolares</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Escola</label>
                            <input type="text" name="schoolName" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">S√©rie/Ano</label>
                            <select name="schoolGrade" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="6ano">6¬∫ Ano</option>
                                <option value="7ano">7¬∫ Ano</option>
                                <option value="8ano">8¬∫ Ano</option>
                                <option value="9ano">9¬∫ Ano</option>
                                <option value="1medio">1¬∫ Ano M√©dio</option>
                                <option value="2medio">2¬∫ Ano M√©dio</option>
                                <option value="3medio">3¬∫ Ano M√©dio</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Turno</label>
                            <select name="schoolShift" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="matutino">Matutino</option>
                                <option value="vespertino">Vespertino</option>
                                <option value="noturno">Noturno</option>
                                <option value="integral">Integral</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Endere√ßo da Escola</label>
                            <input type="text" name="schoolAddress" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Compete pela Escola?</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="competeForSchool" value="sim" class="mr-2">
                                    <span>Sim</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="competeForSchool" value="nao" class="mr-2">
                                    <span>N√£o</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- 6. Plano de Sa√∫de -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">6. Plano de Sa√∫de</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Plano *</label>
                            <select name="healthPlan" required id="healthPlanSelect" onchange="toggleHealthPlanFields()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="sem-plano">Sem Plano</option>
                                <option value="sus">SUS</option>
                                <option value="particular">Particular</option>
                            </select>
                        </div>
                        
                        <!-- SUS Fields -->
                        <div id="susFields" class="hidden space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">N√∫mero da Carteirinha SUS</label>
                                    <input type="text" name="susCardNumber" placeholder="000 0000 0000 0000" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">UBS de Refer√™ncia</label>
                                    <input type="text" name="ubsReference" placeholder="Nome da UBS" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Particular Fields -->
                        <div id="particularFields" class="hidden space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Conv√™nio</label>
                                    <select name="healthInsurance" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="">Selecione o conv√™nio</option>
                                        <option value="amil">Amil</option>
                                        <option value="bradesco-saude">Bradesco Sa√∫de</option>
                                        <option value="sulamerica">SulAm√©rica</option>
                                        <option value="unimed">Unimed</option>
                                        <option value="porto-seguro">Porto Seguro</option>
                                        <option value="hapvida">Hapvida</option>
                                        <option value="prevent-senior">Prevent Senior</option>
                                        <option value="golden-cross">Golden Cross</option>
                                        <option value="medial-saude">Medial Sa√∫de</option>
                                        <option value="notredame">NotreDame Interm√©dica</option>
                                        <option value="sao-cristovao">S√£o Crist√≥v√£o</option>
                                        <option value="trasmontano">Trasmontano</option>
                                        <option value="outro">Outro</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">N√∫mero da Carteirinha</label>
                                    <input type="text" name="insuranceCardNumber" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Data de Vencimento</label>
                                    <input type="date" name="insuranceExpiryDate" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Hospital de Refer√™ncia para Emerg√™ncias</label>
                                    <input type="text" name="emergencyHospital" placeholder="Nome do hospital" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 7. Dados Esportivos -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">7. Dados Esportivos</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Modalidade Principal *</label>
                            <select name="mainSport" required id="mainSportSelect" onchange="updatePositions(); calculateCategory();" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="futebol">‚öΩ Futebol</option>
                                <option value="futsal">ü•Ö Futsal</option>
                                <option value="volei">üèê V√¥lei</option>
                                <option value="basquete">üèÄ Basquete</option>
                                <option value="natacao">üèä Nata√ß√£o</option>
                                <option value="atletismo">üèÉ Atletismo</option>
                                <option value="handebol">ü§æ Handebol</option>
                                <option value="tenis">üéæ T√™nis</option>
                                <option value="judo">ü•ã Jud√¥</option>
                                <option value="karate">ü•ã Karat√™</option>
                                <option value="taekwondo">ü•ã Taekwondo</option>
                                <option value="boxe">ü•ä Boxe</option>
                                <option value="muaythai">ü•ä Muay Thai</option>
                                <option value="jiu-jitsu">ü•ã Jiu-Jitsu</option>
                                <option value="capoeira">ü§∏ Capoeira</option>
                                <option value="ginastica">ü§∏ Gin√°stica</option>
                                <option value="skate">üõπ Skate</option>
                                <option value="surf">üèÑ Surf</option>
                                <option value="ciclismo">üö¥ Ciclismo</option>
                                <option value="corrida">üèÉ Corrida</option>
                                <option value="tenis-mesa">üèì T√™nis de Mesa</option>
                                <option value="badminton">üè∏ Badminton</option>
                                <option value="rugby">üèâ Rugby</option>
                                <option value="hockey">üèë Hockey</option>
                                <option value="esgrima">ü§∫ Esgrima</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Posi√ß√£o/Fun√ß√£o</label>
                            <select name="position" id="positionSelect" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione primeiro a modalidade</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                            <input type="text" name="category" id="categoryDisplay" readonly placeholder="Calculada automaticamente" class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-50 text-gray-600">
                            <p class="text-xs text-gray-500 mt-1">Baseada na data de nascimento e modalidade</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Clube/Equipe</label>
                            <input type="text" name="club" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Outras Atividades F√≠sicas</label>
                            <input type="text" name="otherActivities" placeholder="Ex: Muscula√ß√£o, corrida" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status do Atleta *</label>
                            <select name="athleteStatus" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                                <option value="lesionado">Lesionado</option>
                                <option value="suspenso">Suspenso</option>
                                <option value="transferido">Transferido</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 8. Anexar Documentos -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">8. Anexar Documentos</h4>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Carteirinha do Plano de Sa√∫de</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors">
                                    <input type="file" id="healthCardFile" accept="image/*,.pdf" class="hidden">
                                    <button type="button" onclick="document.getElementById('healthCardFile').click()" class="text-primary hover:text-primary-dark">
                                        üìÑ Clique para anexar ou arraste aqui
                                    </button>
                                    <p class="text-xs text-gray-500 mt-2">JPG, PNG, PDF at√© 5MB</p>
                                    <div id="healthCardPreview" class="mt-2 text-sm text-green-600 hidden"></div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">RG (Documento de Identidade)</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors">
                                    <input type="file" id="rgFile" accept="image/*,.pdf" class="hidden">
                                    <button type="button" onclick="document.getElementById('rgFile').click()" class="text-primary hover:text-primary-dark">
                                        üìÑ Clique para anexar ou arraste aqui
                                    </button>
                                    <p class="text-xs text-gray-500 mt-2">JPG, PNG, PDF at√© 5MB</p>
                                    <div id="rgPreview" class="mt-2 text-sm text-green-600 hidden"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="hideAddAthleteModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition-all">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 bg-primary text-white py-3 rounded-lg hover:bg-primary-dark transition-all">
                        Cadastrar Atleta
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- New Health Record Modal -->
    <div id="newHealthRecordModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-2xl font-bold text-gray-800">Nova Ficha de Sa√∫de</h3>
                    <p id="healthRecordAthleteInfo" class="text-sm text-gray-600"></p>
                </div>
                <button onclick="hideNewHealthRecordModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <form id="newHealthRecordForm" class="space-y-8">
                <!-- 1. Dados Pessoais B√°sicos -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">1. Dados Pessoais B√°sicos</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo *</label>
                            <input type="text" name="fullName" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data de Nascimento *</label>
                            <input type="date" name="birthDate" required onchange="calculateHealthAge(); calculateHealthCategory();" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Idade</label>
                            <input type="text" id="healthAgeDisplay" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Sexo Biol√≥gico *</label>
                            <select name="gender" required onchange="calculateHealthMetrics()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="masculino">Masculino</option>
                                <option value="feminino">Feminino</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefone *</label>
                            <input type="tel" name="phone" required placeholder="(11) 99999-9999" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
                            <input type="email" name="email" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- 2. Dados Esportivos -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">2. Dados Esportivos</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Modalidade Principal *</label>
                            <select name="mainSport" required id="healthMainSportSelect" onchange="updateHealthPositions();" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="futebol">‚öΩ Futebol</option>
                                <option value="futsal">ü•Ö Futsal</option>
                                <option value="volei">üèê V√¥lei</option>
                                <option value="basquete">üèÄ Basquete</option>
                                <option value="natacao">üèä Nata√ß√£o</option>
                                <option value="atletismo">üèÉ Atletismo</option>
                                <option value="handebol">ü§æ Handebol</option>
                                <option value="tenis">üéæ T√™nis</option>
                                <option value="judo">ü•ã Jud√¥</option>
                                <option value="karate">ü•ã Karat√™</option>
                                <option value="taekwondo">ü•ã Taekwondo</option>
                                <option value="boxe">ü•ä Boxe</option>
                                <option value="muaythai">ü•ä Muay Thai</option>
                                <option value="jiu-jitsu">ü•ã Jiu-Jitsu</option>
                                <option value="capoeira">ü§∏ Capoeira</option>
                                <option value="ginastica">ü§∏ Gin√°stica</option>
                                <option value="skate">üõπ Skate</option>
                                <option value="surf">üèÑ Surf</option>
                                <option value="ciclismo">üö¥ Ciclismo</option>
                                <option value="corrida">üèÉ Corrida</option>
                                <option value="tenis-mesa">üèì T√™nis de Mesa</option>
                                <option value="badminton">üè∏ Badminton</option>
                                <option value="rugby">üèâ Rugby</option>
                                <option value="hockey">üèë Hockey</option>
                                <option value="esgrima">ü§∫ Esgrima</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Posi√ß√£o/Fun√ß√£o</label>
                            <select name="position" id="healthPositionSelect" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione primeiro a modalidade</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                            <select name="category" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="Sub-11">Sub-11</option>
                                <option value="Sub-13">Sub-13</option>
                                <option value="Sub-15">Sub-15</option>
                                <option value="Sub-17">Sub-17</option>
                                <option value="Sub-20">Sub-20</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Clube/Equipe</label>
                            <input type="text" name="club" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tempo de Pr√°tica</label>
                            <input type="text" name="practiceTime" placeholder="Ex: 2 anos" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Frequ√™ncia Semanal de Treinos</label>
                            <select name="trainingFrequency" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="1-2">1-2 vezes por semana</option>
                                <option value="3-4">3-4 vezes por semana</option>
                                <option value="5-6">5-6 vezes por semana</option>
                                <option value="diario">Di√°rio</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Dura√ß√£o do Treino (horas)</label>
                            <input type="number" name="trainingDuration" step="0.5" placeholder="Ex: 1.5" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Outras Atividades F√≠sicas</label>
                            <input type="text" name="otherActivities" placeholder="Ex: Muscula√ß√£o, corrida" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status do Atleta *</label>
                            <select name="athleteStatus" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                                <option value="lesionado">Lesionado</option>
                                <option value="suspenso">Suspenso</option>
                                <option value="transferido">Transferido</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 3. Dados Antropom√©tricos -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">3. Dados Antropom√©tricos</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Altura (cm) *</label>
                            <input type="number" name="height" required placeholder="Ex: 175" onchange="calculateHealthMetrics()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Peso (kg) *</label>
                            <input type="number" name="weight" step="0.1" required placeholder="Ex: 65.5" onchange="calculateHealthMetrics()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">IMC</label>
                            <input type="text" id="healthImcDisplay" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Percentual de Gordura (%) Estimado</label>
                            <input type="text" id="bodyFatDisplay" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Massa Muscular (kg) Estimada</label>
                            <input type="text" id="muscleMassDisplay" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Massa √ìssea (kg) Estimada</label>
                            <input type="text" id="boneMassDisplay" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">√Ågua Corporal (%) Estimada</label>
                            <input type="text" id="bodyWaterDisplay" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Taxa Metab√≥lica Basal Estimada</label>
                            <input type="text" id="bmrDisplay" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Idade Metab√≥lica Estimada</label>
                            <input type="text" id="metabolicAgeDisplay" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                    </div>
                    <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-sm text-blue-800">
                            <strong>Nota:</strong> Os valores estimados s√£o calculados automaticamente usando f√≥rmulas cient√≠ficas baseadas em idade, sexo, altura e peso. Para valores mais precisos, recomenda-se exames espec√≠ficos como bioimped√¢ncia ou DEXA.
                        </p>
                    </div>
                </div>

                <!-- 4. Cart√£o de Vacinas -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">4. Cart√£o de Vacinas <span class="text-sm font-normal text-gray-600">(A partir dos 6 anos)</span></h4>
                    
                    <!-- Vacinas Escolares (6-10 anos) -->
                    <div class="mb-6">
                        <h5 class="text-md font-medium text-gray-700 mb-3">üéí Vacinas Escolares (6-10 anos)</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Dupla Adulto (dT) - 1¬™ dose üíâ</label>
                                <input type="date" name="dt_first" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Febre Amarela üíâ</label>
                                <input type="date" name="yellow_fever" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tr√≠plice Viral - Refor√ßo üíâ</label>
                                <input type="date" name="mmr_booster" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- Vacinas Adolescentes (11-17 anos) -->
                    <div class="mb-6">
                        <h5 class="text-md font-medium text-gray-700 mb-3">üßë‚Äçüéì Vacinas Adolescentes (11-17 anos)</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">HPV - 1¬™ dose üíâ</label>
                                <input type="date" name="hpv_first" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">HPV - 2¬™ dose üíâ</label>
                                <input type="date" name="hpv_second" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Meningoc√≥cica ACWY üíâ</label>
                                <input type="date" name="meningococcal_acwy" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Meningoc√≥cica B üíâ</label>
                                <input type="date" name="meningococcal_b" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Dupla Adulto (dT) - Refor√ßo üíâ</label>
                                <input type="date" name="dt_booster" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Hepatite B - Refor√ßo üíâ</label>
                                <input type="date" name="hepatitis_b_booster" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- Vacinas Adultos (18+ anos) -->
                    <div class="mb-6">
                        <h5 class="text-md font-medium text-gray-700 mb-3">üë®‚Äçüíº Vacinas Adultos (18+ anos)</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Dupla Adulto (dT) üíâ</label>
                                <input type="date" name="dt_adult" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tr√≠plice Viral (SCR) üíâ</label>
                                <input type="date" name="mmr_adult" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Hepatite B üíâ</label>
                                <input type="date" name="hepatitis_b_adult" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">HPV (at√© 26 anos) üíâ</label>
                                <input type="date" name="hpv_adult" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- Vacinas Anuais -->
                    <div class="mb-6">
                        <h5 class="text-md font-medium text-gray-700 mb-3">üìÖ Vacinas Anuais (Todas as idades)</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Influenza (Gripe) üíâ</label>
                                <input type="date" name="influenza" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                                <p class="text-xs text-gray-500 mt-1">‚ÑπÔ∏è Vacina anual recomendada para todos</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">COVID-19 - 1¬™ dose üíâ</label>
                                <input type="date" name="covid_first" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">COVID-19 - 2¬™ dose üíâ</label>
                                <input type="date" name="covid_second" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">COVID-19 - Refor√ßo üíâ</label>
                                <input type="date" name="covid_booster" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- Status das Vacinas -->
                    <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <h5 class="text-md font-medium text-gray-700 mb-2">üìä Status das Vacinas</h5>
                        <p class="text-sm text-yellow-800">Preencha a data de nascimento para ver as recomenda√ß√µes espec√≠ficas por idade.</p>
                    </div>

                    <!-- Observa√ß√µes sobre Vacinas -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes sobre Vacinas</label>
                        <textarea name="vaccineObservations" rows="3" placeholder="Rea√ß√µes adversas, vacinas pendentes, contraindica√ß√µes m√©dicas, etc..." class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                    </div>
                </div>

                <!-- 5. Hist√≥rico M√©dico -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">5. Hist√≥rico M√©dico</h4>
                    <div class="space-y-6">
                        <!-- Possui alguma doen√ßa? -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Possui alguma doen√ßa?</label>
                            <div class="flex space-x-6 mb-3">
                                <label class="flex items-center">
                                    <input type="radio" name="hasDisease" value="sim" onchange="toggleDiseaseDetails()" class="mr-2">
                                    <span>Sim</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="hasDisease" value="nao" onchange="toggleDiseaseDetails()" class="mr-2">
                                    <span>N√£o</span>
                                </label>
                            </div>
                            <div id="diseaseDetails" class="hidden">
                                <textarea name="diseaseDetails" rows="3" placeholder="Descreva as doen√ßas..." class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                            </div>
                        </div>

                        <!-- Faz uso de medicamento? -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Faz uso de medicamento?</label>
                            <div class="flex space-x-6 mb-3">
                                <label class="flex items-center">
                                    <input type="radio" name="usesMedication" value="sim" onchange="toggleMedicationDetails()" class="mr-2">
                                    <span>Sim</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="usesMedication" value="nao" onchange="toggleMedicationDetails()" class="mr-2">
                                    <span>N√£o</span>
                                </label>
                            </div>
                            <div id="medicationDetails" class="hidden">
                                <textarea name="medicationDetails" rows="3" placeholder="Liste os medicamentos em uso..." class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                            </div>
                        </div>

                        <!-- Possui alguma alergia? -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Possui alguma alergia?</label>
                            <div class="flex space-x-6 mb-3">
                                <label class="flex items-center">
                                    <input type="radio" name="hasAllergy" value="sim" onchange="toggleAllergyDetails()" class="mr-2">
                                    <span>Sim</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="hasAllergy" value="nao" onchange="toggleAllergyDetails()" class="mr-2">
                                    <span>N√£o</span>
                                </label>
                            </div>
                            <div id="allergyDetails" class="hidden">
                                <textarea name="allergyDetails" rows="3" placeholder="Descreva as alergias..." class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                            </div>
                        </div>

                        <!-- J√° passou por alguma cirurgia? -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">J√° passou por alguma cirurgia?</label>
                            <div class="flex space-x-6 mb-3">
                                <label class="flex items-center">
                                    <input type="radio" name="hadSurgery" value="sim" onchange="toggleSurgeryDetails()" class="mr-2">
                                    <span>Sim</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="hadSurgery" value="nao" onchange="toggleSurgeryDetails()" class="mr-2">
                                    <span>N√£o</span>
                                </label>
                            </div>
                            <div id="surgeryDetails" class="hidden">
                                <textarea name="surgeryDetails" rows="3" placeholder="Descreva as cirurgias realizadas..." class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                            </div>
                        </div>

                        <!-- J√° sofreu alguma les√£o ortop√©dica? -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">J√° sofreu alguma les√£o ortop√©dica?</label>
                            <div class="flex space-x-6 mb-3">
                                <label class="flex items-center">
                                    <input type="radio" name="hadInjury" value="sim" onchange="toggleInjuryDetails()" class="mr-2">
                                    <span>Sim</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="hadInjury" value="nao" onchange="toggleInjuryDetails()" class="mr-2">
                                    <span>N√£o</span>
                                </label>
                            </div>
                            <div id="injuryDetails" class="hidden">
                                <textarea name="injuryDetails" rows="3" placeholder="Descreva as les√µes ortop√©dicas..." class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                            </div>
                        </div>

                        <!-- Fuma? -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Fuma?</label>
                            <div class="flex space-x-6 mb-3">
                                <label class="flex items-center">
                                    <input type="radio" name="smokes" value="sim" onchange="toggleSmokingDetails()" class="mr-2">
                                    <span>Sim</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="smokes" value="nao" onchange="toggleSmokingDetails()" class="mr-2">
                                    <span>N√£o</span>
                                </label>
                            </div>
                            <div id="smokingDetails" class="hidden">
                                <textarea name="smokingDetails" rows="2" placeholder="Frequ√™ncia, tipo, h√° quanto tempo..." class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                            </div>
                        </div>

                        <!-- Bebe? -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Bebe?</label>
                            <div class="flex space-x-6 mb-3">
                                <label class="flex items-center">
                                    <input type="radio" name="drinks" value="sim" onchange="toggleDrinkingDetails()" class="mr-2">
                                    <span>Sim</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="drinks" value="nao" onchange="toggleDrinkingDetails()" class="mr-2">
                                    <span>N√£o</span>
                                </label>
                            </div>
                            <div id="drinkingDetails" class="hidden">
                                <textarea name="drinkingDetails" rows="2" placeholder="Frequ√™ncia, tipo de bebida..." class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="hideNewHealthRecordModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition-all">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 bg-primary text-white py-3 rounded-lg hover:bg-primary-dark transition-all">
                        Cadastrar Atleta
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sample data with complete athlete information
        let athletes = [
            { 
                id: '110001', 
                name: 'Jo√£o Santos', 
                age: 16, 
                sport: 'Futebol',
                category: 'Sub-17',
                birthDate: '2008-03-15',
                gender: 'masculino',
                phone: '(11) 99999-1111',
                email: 'joao.santos@email.com',
                team: 'Santos FC Juvenil',
                position: 'Atacante',
                status: 'ativo',
                photo: null,
                rg: '12.345.678-9',
                profession: 'Estudante',
                instagram: 'joao_santos',
                tiktok: 'joaosantos10',
                address: {
                    cep: '01310-100',
                    state: 'SP',
                    city: 'S√£o Paulo',
                    neighborhood: 'Bela Vista',
                    address: 'Avenida Paulista',
                    number: '1000',
                    complement: 'Apto 101'
                },
                guardian: {
                    name: 'Carlos Santos',
                    relation: 'pai',
                    phone: '(11) 98888-1111',
                    email: 'carlos.santos@email.com'
                },
                school: {
                    name: 'Col√©gio S√£o Paulo',
                    grade: '2medio',
                    shift: 'matutino',
                    address: 'Rua da Escola, 100',
                    competeForSchool: 'nao'
                },
                healthPlan: 'particular',
                healthInsurance: 'unimed',
                insuranceCardNumber: '123456789',
                emergencyHospital: 'Hospital Albert Einstein',
                club: 'Santos FC',
                otherActivities: 'Muscula√ß√£o',
                documents: {}
            }
        ];

        let nextAthleteIdNumber = 110002; // Next ID to be assigned

        // Toggle health plan fields
        function toggleHealthPlanFields() {
            const healthPlanSelect = safeGetElement('healthPlanSelect');
            const susFields = safeGetElement('susFields');
            const particularFields = safeGetElement('particularFields');
            
            if (!healthPlanSelect || !susFields || !particularFields) {
                return; // Elements don't exist, skip silently
            }
            
            // Hide all fields first
            susFields.classList.add('hidden');
            particularFields.classList.add('hidden');
            
            // Show relevant fields based on selection
            if (healthPlanSelect.value === 'sus') {
                susFields.classList.remove('hidden');
            } else if (healthPlanSelect.value === 'particular') {
                particularFields.classList.remove('hidden');
            }
        }

        // Add new emergency contact
        let contactCounter = 0;
        function addNewContact() {
            contactCounter++;
            const additionalContacts = document.getElementById('additionalContacts');
            
            const contactDiv = document.createElement('div');
            contactDiv.className = 'bg-white border border-gray-200 rounded-lg p-4';
            contactDiv.id = `contact-${contactCounter}`;
            
            contactDiv.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h6 class="font-medium text-gray-700">Contato de Emerg√™ncia ${contactCounter + 1}</h6>
                    <button type="button" onclick="removeContact(${contactCounter})" class="text-red-500 hover:text-red-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Respons√°vel</label>
                        <input type="text" name="guardianName${contactCounter}" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Parentesco</label>
                        <select name="guardianRelation${contactCounter}" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">Selecione</option>
                            <option value="pai">Pai</option>
                            <option value="mae">M√£e</option>
                            <option value="avo">Av√¥/Av√≥</option>
                            <option value="tio">Tio/Tia</option>
                            <option value="tutor">Tutor Legal</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                        <input type="tel" name="guardianPhone${contactCounter}" placeholder="(11) 99999-9999" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
                        <input type="email" name="guardianEmail${contactCounter}" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
            `;
            
            additionalContacts.appendChild(contactDiv);
        }
        
        function removeContact(contactId) {
            const contactDiv = document.getElementById(`contact-${contactId}`);
            if (contactDiv) {
                contactDiv.remove();
            }
        }

        // Sport positions mapping
        const sportPositions = {
            futebol: ['Goleiro', 'Zagueiro', 'Lateral', 'Volante', 'Meia', 'Atacante'],
            futsal: ['Goleiro', 'Fixo', 'Ala', 'Piv√¥'],
            volei: ['Levantador', 'Ponteiro', 'Meio de Rede', 'Oposto', 'L√≠bero'],
            basquete: ['Armador', 'Ala-Armador', 'Ala', 'Ala-Piv√¥', 'Piv√¥'],
            natacao: ['Nado Livre', 'Nado Costas', 'Nado Peito', 'Nado Borboleta', 'Medley'],
            atletismo: ['Velocidade', 'Meio-Fundo', 'Fundo', 'Saltos', 'Arremessos', 'Lan√ßamentos'],
            handebol: ['Goleiro', 'Armador Central', 'Armador Lateral', 'Ponta', 'Piv√¥'],
            tenis: ['Simples', 'Duplas', 'Duplas Mistas'],
            judo: ['Peso Leve', 'Peso M√©dio', 'Peso Pesado'],
            karate: ['Kata', 'Kumite'],
            taekwondo: ['Peso Leve', 'Peso M√©dio', 'Peso Pesado'],
            boxe: ['Peso Leve', 'Peso M√©dio', 'Peso Pesado'],
            muaythai: ['Peso Leve', 'Peso M√©dio', 'Peso Pesado'],
            'jiu-jitsu': ['Peso Leve', 'Peso M√©dio', 'Peso Pesado'],
            capoeira: ['Iniciante', 'Intermedi√°rio', 'Avan√ßado'],
            ginastica: ['Solo', 'Salto', 'Barras Paralelas', 'Argolas', 'Cavalo com Al√ßas', 'Barra Fixa'],
            skate: ['Street', 'Vert', 'Park', 'Bowl'],
            surf: ['Longboard', 'Shortboard', 'Funboard'],
            ciclismo: ['Estrada', 'Mountain Bike', 'BMX', 'Pista'],
            corrida: ['Velocidade', 'Meio-Fundo', 'Fundo', 'Maratona'],
            'tenis-mesa': ['Ofensivo', 'Defensivo', 'All-Round'],
            badminton: ['Simples', 'Duplas', 'Duplas Mistas'],
            rugby: ['Primeira Linha', 'Segunda Linha', 'Terceira Linha', 'Backs'],
            hockey: ['Goleiro', 'Defensor', 'Meio-Campo', 'Atacante'],
            esgrima: ['Florete', 'Espada', 'Sabre']
        };

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked nav button
            event.target.classList.add('active');
        }

        // Modal functions
        function showAddAthleteModal() {
            document.getElementById('addAthleteModal').classList.remove('hidden');
            document.getElementById('addAthleteModal').classList.add('flex');
            updateNextAthleteId();
        }

        function hideAddAthleteModal() {
            document.getElementById('addAthleteModal').classList.add('hidden');
            document.getElementById('addAthleteModal').classList.remove('flex');
            
            // Reset form when closing modal
            resetAthleteForm();
        }

        function resetAthleteForm() {
            const form = safeGetElement('addAthleteForm');
            if (!form) return;
            
            form.reset();
            form.removeAttribute('data-edit-mode');
            form.removeAttribute('data-athlete-id');
            
            // Reset modal title and button
            const modalTitle = safeQuerySelector('#addAthleteModal h3');
            const submitButton = safeQuerySelector('#addAthleteModal button[type="submit"]');
            
            if (modalTitle) modalTitle.textContent = 'Cadastrar Novo Atleta';
            if (submitButton) submitButton.textContent = 'Cadastrar Atleta';
            
            // Reset photo preview
            const photoPreview = safeGetElement('photoPreview');
            if (photoPreview) {
                photoPreview.innerHTML = `
                    <svg class="w-12 h-12 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                    </svg>
                `;
            }
            
            // Reset health plan fields
            const susFields = safeGetElement('susFields');
            const particularFields = safeGetElement('particularFields');
            
            if (susFields) susFields.classList.add('hidden');
            if (particularFields) particularFields.classList.add('hidden');
            
            // Reset document previews
            const healthCardPreview = safeGetElement('healthCardPreview');
            const rgPreview = safeGetElement('rgPreview');
            
            if (healthCardPreview) {
                healthCardPreview.classList.add('hidden');
                healthCardPreview.innerHTML = '';
            }
            if (rgPreview) {
                rgPreview.classList.add('hidden');
                rgPreview.innerHTML = '';
            }
        }

        // Update next athlete ID display
        function updateNextAthleteId() {
            const nextIdEl = safeGetElement('nextAthleteId');
            if (nextIdEl) {
                nextIdEl.textContent = nextAthleteIdNumber.toString();
            }
        }

        // Calculate age from birth date
        function calculateAge() {
            const birthDateInput = safeQuerySelector('input[name="birthDate"]');
            const ageDisplay = safeGetElement('ageDisplay');
            
            if (birthDateInput && ageDisplay && birthDateInput.value) {
                const birthDate = new Date(birthDateInput.value);
                const today = new Date();
                
                let years = today.getFullYear() - birthDate.getFullYear();
                let months = today.getMonth() - birthDate.getMonth();
                let days = today.getDate() - birthDate.getDate();
                
                // Adjust for negative days
                if (days < 0) {
                    months--;
                    const lastMonth = new Date(today.getFullYear(), today.getMonth(), 0);
                    days += lastMonth.getDate();
                }
                
                // Adjust for negative months
                if (months < 0) {
                    years--;
                    months += 12;
                }
                
                ageDisplay.value = `${years} anos, ${months} meses e ${days} dias`;
            } else if (ageDisplay) {
                ageDisplay.value = '';
            }
        }

        // Calculate category based on birth date and sport
        function calculateCategory() {
            const birthDateInput = safeQuerySelector('input[name="birthDate"]');
            const sportSelect = safeGetElement('mainSportSelect');
            const categoryDisplay = safeGetElement('categoryDisplay');
            
            if (birthDateInput && sportSelect && categoryDisplay && birthDateInput.value && sportSelect.value) {
                const birthDate = new Date(birthDateInput.value);
                const currentYear = new Date().getFullYear();
                const age = currentYear - birthDate.getFullYear();
                
                let category = '';
                
                // Calculate category based on age
                if (age <= 11) {
                    category = 'Sub-11';
                } else if (age <= 13) {
                    category = 'Sub-13';
                } else if (age <= 15) {
                    category = 'Sub-15';
                } else if (age <= 17) {
                    category = 'Sub-17';
                } else if (age <= 20) {
                    category = 'Sub-20';
                } else {
                    category = 'Adulto';
                }
                
                categoryDisplay.value = category;
            } else if (categoryDisplay) {
                categoryDisplay.value = '';
            }
        }

        // Search CEP and auto-fill address
        async function searchCEP() {
            const cepInput = safeGetElement('cepInput');
            if (!cepInput) return;
            
            const cep = cepInput.value.replace(/\D/g, '');
            
            if (cep.length === 8) {
                try {
                    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                    const data = await response.json();
                    
                    if (!data.erro) {
                        // Fill address fields
                        const addressInput = safeGetElement('addressInput');
                        const neighborhoodInput = safeGetElement('neighborhoodInput');
                        const cityInput = safeGetElement('cityInput');
                        const stateSelect = safeGetElement('stateSelect');
                        
                        if (addressInput) addressInput.value = data.logradouro || '';
                        if (neighborhoodInput) neighborhoodInput.value = data.bairro || '';
                        if (cityInput) cityInput.value = data.localidade || '';
                        if (stateSelect) stateSelect.value = data.uf || '';
                        
                        // Show success message
                        cepInput.style.borderColor = '#10b981';
                        setTimeout(() => {
                            cepInput.style.borderColor = '';
                        }, 2000);
                    } else {
                        // CEP not found
                        alert('CEP n√£o encontrado. Verifique o n√∫mero digitado.');
                        cepInput.style.borderColor = '#ef4444';
                        setTimeout(() => {
                            cepInput.style.borderColor = '';
                        }, 2000);
                    }
                } catch (error) {
                    console.error('Erro ao buscar CEP:', error);
                    alert('Erro ao buscar CEP. Tente novamente.');
                }
            }
        }

        // Update positions based on selected sport
        function updatePositions() {
            const sportSelect = safeGetElement('mainSportSelect');
            const positionSelect = safeGetElement('positionSelect');
            
            if (!sportSelect || !positionSelect) {
                return; // Elements don't exist, skip silently
            }
            
            const selectedSport = sportSelect.value;
            
            // Clear current options
            positionSelect.innerHTML = '<option value="">Selecione uma posi√ß√£o</option>';
            
            if (selectedSport && sportPositions[selectedSport]) {
                sportPositions[selectedSport].forEach(position => {
                    const option = document.createElement('option');
                    option.value = position.toLowerCase().replace(/\s+/g, '_');
                    option.textContent = position;
                    positionSelect.appendChild(option);
                });
            } else {
                positionSelect.innerHTML = '<option value="">Selecione primeiro a modalidade</option>';
            }
        }

        // Document upload functionality
        let uploadedDocuments = {};

        function initializeDocumentUploads() {
            const healthCardFile = safeGetElement('healthCardFile');
            const rgFile = safeGetElement('rgFile');
            
            if (healthCardFile) {
                healthCardFile.addEventListener('change', function(e) {
                    handleDocumentUpload(e, 'healthCardPreview', 'Carteirinha do plano anexada com sucesso!', 'healthCard');
                });
            }

            if (rgFile) {
                rgFile.addEventListener('change', function(e) {
                    handleDocumentUpload(e, 'rgPreview', 'RG anexado com sucesso!', 'rg');
                });
            }
        }

        function handleDocumentUpload(e, previewId, successMessage, documentType) {
            const file = e.target.files[0];
            const preview = document.getElementById(previewId);
            
            if (file) {
                // Check file size (5MB limit)
                if (file.size > 5 * 1024 * 1024) {
                    alert('Arquivo muito grande. M√°ximo 5MB permitido.');
                    e.target.value = '';
                    return;
                }
                
                // Check file type
                if (!file.type.match('image/') && file.type !== 'application/pdf') {
                    alert('Apenas arquivos de imagem (JPG, PNG) e PDF s√£o permitidos.');
                    e.target.value = '';
                    return;
                }
                
                // Convert file to base64 for storage
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedDocuments[documentType] = {
                        name: file.name,
                        type: file.type,
                        data: e.target.result,
                        uploadDate: new Date().toISOString()
                    };
                    
                    preview.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                            <span class="text-green-600">${successMessage}</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">üìÑ ${file.name}</p>
                    `;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                delete uploadedDocuments[documentType];
                preview.classList.add('hidden');
            }
        }

        // Photo preview functionality
        function initializePhotoPreview() {
            const athletePhoto = safeGetElement('athletePhoto');
            if (athletePhoto) {
                athletePhoto.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // Check file size (5MB limit)
                        if (file.size > 5 * 1024 * 1024) {
                            alert('Arquivo muito grande. M√°ximo 5MB permitido.');
                            e.target.value = '';
                            return;
                        }
                        
                        // Check file type
                        if (!file.type.match('image/(jpeg|png)')) {
                            alert('Apenas arquivos JPG e PNG s√£o permitidos.');
                            e.target.value = '';
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const preview = safeGetElement('photoPreview');
                            if (preview) {
                                preview.innerHTML = `<img src="${e.target.result}" alt="Preview" class="w-full h-full object-cover rounded-full">`;
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        }

        // Filter athletes
        let filteredAthletes = [...athletes];
        
        function filterAthletes() {
            const searchNameEl = safeGetElement('searchName');
            const searchIdEl = safeGetElement('searchId');
            const filterSportEl = safeGetElement('filterSport');
            const filterCategoryEl = safeGetElement('filterCategory');
            
            const searchName = searchNameEl ? searchNameEl.value.toLowerCase() : '';
            const searchId = searchIdEl ? searchIdEl.value.toLowerCase() : '';
            const filterSport = filterSportEl ? filterSportEl.value : '';
            const filterCategory = filterCategoryEl ? filterCategoryEl.value : '';
            
            filteredAthletes = athletes.filter(athlete => {
                const matchesName = athlete.name.toLowerCase().includes(searchName);
                const matchesId = athlete.id.toLowerCase().includes(searchId);
                const matchesSport = !filterSport || athlete.sport === filterSport;
                const matchesCategory = !filterCategory || athlete.category === filterCategory;
                
                return matchesName && matchesId && matchesSport && matchesCategory;
            });
            
            populateAthletesTable();
            updateAthleteCount();
        }
        
        function updateAthleteCount() {
            const countEl = safeGetElement('athleteCount');
            if (countEl) {
                countEl.textContent = filteredAthletes.length;
            }
        }
        
        function populateSportFilter() {
            const sportFilter = safeGetElement('filterSport');
            if (!sportFilter) {
                return; // Element doesn't exist, skip silently
            }
            
            const sports = [...new Set(athletes.map(athlete => athlete.sport))];
            
            sports.forEach(sport => {
                const option = document.createElement('option');
                option.value = sport;
                option.textContent = sport;
                sportFilter.appendChild(option);
            });
        }

        // Populate athletes table
        function populateAthletesTable() {
            const tableBody = safeGetElement('athletesTable');
            if (!tableBody) {
                return; // Element doesn't exist, skip silently
            }
            
            tableBody.innerHTML = '';
            
            if (filteredAthletes.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                            <div class="flex flex-col items-center">
                                <svg class="w-12 h-12 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 6.306a7.962 7.962 0 00-6 0m6 0V3a1 1 0 00-1-1H10a1 1 0 00-1 1v3.306"/>
                                </svg>
                                <p class="text-lg font-medium">Nenhum atleta encontrado</p>
                                <p class="text-sm">Tente ajustar os filtros de busca</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredAthletes.forEach(athlete => {
                const row = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex-shrink-0 h-12 w-12 cursor-pointer" onclick="showAthleteProfile('${athlete.id}')">
                                ${athlete.photo ? 
                                    `<img src="${athlete.photo}" alt="${athlete.name}" class="h-12 w-12 rounded-full object-cover hover:ring-2 hover:ring-primary transition-all">` :
                                    `<div class="h-12 w-12 rounded-full bg-primary text-white flex items-center justify-center font-semibold text-lg hover:bg-primary-dark transition-all">
                                        ${athlete.name.charAt(0)}
                                    </div>`
                                }
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900 hover:text-primary cursor-pointer transition-colors" onclick="showAthleteProfile('${athlete.id}')">${athlete.name}</div>
                            <div class="text-sm text-gray-500">${athlete.team}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">${athlete.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${athlete.age} anos</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${athlete.sport}</div>
                            <div class="text-sm text-gray-500">${athlete.category}</div>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // Populate athlete select in medical form
        function populateAthleteSelect() {
            const select = safeGetElement('athleteSelect');
            if (!select) {
                return; // Element doesn't exist, skip silently
            }
            
            select.innerHTML = '<option>Selecione um atleta</option>';
            
            athletes.forEach(athlete => {
                select.innerHTML += `<option value="${athlete.id}">${athlete.id} - ${athlete.name}</option>`;
            });
        }

        // Form handlers
        function initializeAthleteForm() {
            const form = safeGetElement('addAthleteForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    console.log('Form submitted!'); // Debug log
                    
                    // Check if it's edit mode
                    const isEditMode = e.target.getAttribute('data-edit-mode') === 'true';
                    const athleteId = e.target.getAttribute('data-athlete-id');
                    
                    // Get form data
                    const formData = new FormData(e.target);
                    const fullName = formData.get('fullName');
                    const birthDate = formData.get('birthDate');
                    const mainSport = formData.get('mainSport');
                    const phone = formData.get('phone');
                    const team = formData.get('team');
                    const gender = formData.get('gender');
                    const cep = formData.get('cep');
                    
                    console.log('Form data:', { fullName, birthDate, mainSport, phone, team, gender, cep, isEditMode, athleteId }); // Debug log
            
            // Validate required fields
            if (!fullName || !birthDate || !mainSport || !phone || !team || !gender || !cep) {
                alert('Por favor, preencha todos os campos obrigat√≥rios marcados com *');
                return;
            }
            
            const birthDateObj = new Date(birthDate);
            const today = new Date();
            let age = today.getFullYear() - birthDateObj.getFullYear();
            const monthDiff = today.getMonth() - birthDateObj.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDateObj.getDate())) {
                age--;
            }
            
            // Check if athlete is over 18
            if (age > 18) {
                alert('Este sistema √© destinado apenas para atletas at√© 18 anos.');
                return;
            }
            
            // Get sport name with icon
            const sportSelect = document.getElementById('mainSportSelect');
            const sportText = sportSelect.options[sportSelect.selectedIndex].text;
            const sportName = sportText.split(' ').slice(1).join(' '); // Remove emoji
            
            // Calculate category
            let category = '';
            if (age <= 11) {
                category = 'Sub-11';
            } else if (age <= 13) {
                category = 'Sub-13';
            } else if (age <= 15) {
                category = 'Sub-15';
            } else if (age <= 17) {
                category = 'Sub-17';
            } else if (age <= 20) {
                category = 'Sub-20';
            } else {
                category = 'Adulto';
            }
            
            // Function to add or update athlete
            function saveAthleteToSystem(photoUrl = null) {
                const athleteData = {
                    name: fullName,
                    age: age,
                    sport: sportName,
                    category: category,
                    birthDate: birthDate,
                    gender: gender,
                    phone: phone,
                    email: formData.get('email') || 'N√£o informado',
                    team: team,
                    position: formData.get('position') || 'N√£o definida',
                    status: formData.get('athleteStatus') || 'ativo',
                    photo: photoUrl,
                    rg: formData.get('rg') || 'N√£o informado',
                    profession: formData.get('profession') || 'Estudante',
                    instagram: formData.get('instagram') || '',
                    tiktok: formData.get('tiktok') || '',
                    address: {
                        cep: cep,
                        state: formData.get('state') || '',
                        city: formData.get('city') || '',
                        neighborhood: formData.get('neighborhood') || '',
                        address: formData.get('address') || '',
                        number: formData.get('addressNumber') || '',
                        complement: formData.get('addressComplement') || ''
                    },
                    guardian: {
                        name: formData.get('guardianName') || 'N√£o informado',
                        relation: formData.get('guardianRelation') || 'N√£o informado',
                        phone: formData.get('guardianPhone') || 'N√£o informado',
                        email: formData.get('guardianEmail') || 'N√£o informado'
                    },
                    school: {
                        name: formData.get('schoolName') || 'N√£o informado',
                        grade: formData.get('schoolGrade') || 'N√£o informado',
                        shift: formData.get('schoolShift') || 'N√£o informado',
                        address: formData.get('schoolAddress') || 'N√£o informado',
                        competeForSchool: formData.get('competeForSchool') || 'nao'
                    },
                    healthPlan: formData.get('healthPlan') || 'sem-plano',
                    healthInsurance: formData.get('healthInsurance') || '',
                    insuranceCardNumber: formData.get('insuranceCardNumber') || '',
                    emergencyHospital: formData.get('emergencyHospital') || '',
                    susCardNumber: formData.get('susCardNumber') || '',
                    ubsReference: formData.get('ubsReference') || '',
                    club: formData.get('club') || 'N√£o informado',
                    otherActivities: formData.get('otherActivities') || 'N√£o informado',
                    documents: { ...uploadedDocuments }
                };
                
                if (isEditMode && athleteId) {
                    // Update existing athlete
                    const athleteIndex = athletes.findIndex(a => a.id === athleteId);
                    if (athleteIndex > -1) {
                        // Keep the original ID and preserve existing photo if no new photo
                        athleteData.id = athleteId;
                        if (!photoUrl && athletes[athleteIndex].photo) {
                            athleteData.photo = athletes[athleteIndex].photo;
                        }
                        athletes[athleteIndex] = athleteData;
                        
                        console.log('Updated athlete:', athleteData); // Debug log
                        
                        showSuccessMessage(`‚úÖ Dados do atleta ${athleteData.name} atualizados com sucesso!`);
                        
                        // Open updated athlete profile
                        setTimeout(() => {
                            showAthleteProfile(athleteId);
                        }, 100);
                    }
                } else {
                    // Add new athlete
                    athleteData.id = nextAthleteIdNumber.toString();
                    athletes.push(athleteData);
                    nextAthleteIdNumber++;
                    
                    console.log('Added athlete:', athleteData); // Debug log
                    
                    showSuccessMessage(`‚úÖ Atleta ${athleteData.name} cadastrado com sucesso!`);
                    
                    // Open new athlete profile
                    setTimeout(() => {
                        showAthleteProfile(athleteData.id);
                    }, 100);
                }
                
                // Update displays
                filteredAthletes = [...athletes];
                populateAthletesTable();
                populateAthleteSelect();
                populateSportFilter();
                updateAthleteCount();
                hideAddAthleteModal();
                
                // Reset form and clear uploaded documents
                resetAthleteForm();
                uploadedDocuments = {};
                
                // Update dashboard stats
                document.getElementById('totalAthletes').textContent = athletes.length;
            }
            
            function resetAthleteForm() {
                const form = safeGetElement('addAthleteForm');
                if (!form) return;
                
                form.reset();
                form.removeAttribute('data-edit-mode');
                form.removeAttribute('data-athlete-id');
                
                // Reset modal title and button
                const modalTitle = safeQuerySelector('#addAthleteModal h3');
                const submitButton = safeQuerySelector('#addAthleteModal button[type="submit"]');
                
                if (modalTitle) modalTitle.textContent = 'Cadastrar Novo Atleta';
                if (submitButton) submitButton.textContent = 'Cadastrar Atleta';
                
                // Reset photo preview
                const photoPreview = safeGetElement('photoPreview');
                if (photoPreview) {
                    photoPreview.innerHTML = `
                        <svg class="w-12 h-12 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                        </svg>
                    `;
                }
                
                // Reset health plan fields
                const susFields = safeGetElement('susFields');
                const particularFields = safeGetElement('particularFields');
                
                if (susFields) susFields.classList.add('hidden');
                if (particularFields) particularFields.classList.add('hidden');
                
                // Reset document previews
                const healthCardPreview = safeGetElement('healthCardPreview');
                const rgPreview = safeGetElement('rgPreview');
                
                if (healthCardPreview) {
                    healthCardPreview.classList.add('hidden');
                    healthCardPreview.innerHTML = '';
                }
                if (rgPreview) {
                    rgPreview.classList.add('hidden');
                    rgPreview.innerHTML = '';
                }
            }
            
            // Get photo if uploaded
            const photoFile = safeGetElement('athletePhoto');
            const photoFileInput = photoFile ? photoFile.files[0] : null;
            
            if (photoFileInput) {
                // Validate photo
                if (photoFileInput.size > 5 * 1024 * 1024) {
                    alert('Foto muito grande. M√°ximo 5MB permitido.');
                    return;
                }
                
                if (!photoFileInput.type.match('image/(jpeg|png)')) {
                    alert('Apenas arquivos JPG e PNG s√£o permitidos para a foto.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    saveAthleteToSystem(e.target.result);
                };
                reader.readAsDataURL(photoFileInput);
            } else {
                saveAthleteToSystem();
            }
                });
            }
        }

        function initializeMedicalForm() {
            const form = safeGetElement('medicalForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    showSuccessMessage('‚úÖ Exame registrado com sucesso!');
                    e.target.reset();
                });
            }
        }

        // Athlete profile functions
        let currentAthleteId = null;
        let isEditMode = false;
        
        function showAthleteProfile(athleteId) {
            console.log('Showing profile for athlete:', athleteId);
            const athlete = athletes.find(a => a.id === athleteId);
            if (!athlete) {
                console.log('Athlete not found:', athleteId);
                return;
            }
            
            currentAthleteId = athleteId;
            isEditMode = false;
            
            // Update modal header
            const profileName = document.getElementById('profileName');
            const profileId = document.getElementById('profileId');
            const profilePhoto = document.getElementById('profilePhoto');
            
            if (profileName) profileName.textContent = athlete.name;
            if (profileId) profileId.textContent = `ID: ${athlete.id}`;
            
            // Update photo
            if (profilePhoto) {
                if (athlete.photo) {
                    profilePhoto.innerHTML = `<img src="${athlete.photo}" alt="${athlete.name}" class="w-full h-full object-cover rounded-full">`;
                } else {
                    profilePhoto.innerHTML = `
                        <div class="w-full h-full rounded-full bg-primary text-white flex items-center justify-center font-semibold text-2xl">
                            ${athlete.name.charAt(0)}
                        </div>
                    `;
                }
            }
            
            // Populate profile content
            populateProfileContent(athlete);
            
            // Show modal
            const modal = document.getElementById('athleteProfileModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                console.log('Profile modal should be visible now');
            }
        }
        
        function hideAthleteProfile() {
            document.getElementById('athleteProfileModal').classList.add('hidden');
            document.getElementById('athleteProfileModal').classList.remove('flex');
            currentAthleteId = null;
            isEditMode = false;
        }
        
        function populateProfileContent(athlete) {
            const content = document.getElementById('profileContent');
            
            content.innerHTML = `
                <!-- Dados Pessoais -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Dados Pessoais</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Nome Completo</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.name}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Data de Nascimento</label>
                            <p class="mt-1 text-sm text-gray-900">${new Date(athlete.birthDate).toLocaleDateString('pt-BR')}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Idade</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.age} anos</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Sexo</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.gender === 'masculino' ? 'Masculino' : 'Feminino'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">RG</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.rg || 'N√£o informado'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Telefone</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.phone}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">E-mail</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.email}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Profiss√£o</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.profession || 'N√£o informado'}</p>
                        </div>
                    </div>
                    
                    <!-- Redes Sociais -->
                    <div class="mt-6">
                        <h5 class="text-md font-medium text-gray-700 mb-3">Redes Sociais</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Instagram</label>
                                <p class="mt-1 text-sm text-gray-900">${athlete.instagram ? '@' + athlete.instagram : 'N√£o informado'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">TikTok</label>
                                <p class="mt-1 text-sm text-gray-900">${athlete.tiktok ? '@' + athlete.tiktok : 'N√£o informado'}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Endere√ßo -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Endere√ßo</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">CEP</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.address.cep}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Estado</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.address.state}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Cidade</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.address.city}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Bairro</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.address.neighborhood}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Endere√ßo</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.address.address}, ${athlete.address.number}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Complemento</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.address.complement || '-'}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Contato de Emerg√™ncia -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Contato de Emerg√™ncia</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Nome do Respons√°vel</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.guardian.name}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Parentesco</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.guardian.relation}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Telefone</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.guardian.phone}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">E-mail</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.guardian.email}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Plano de Sa√∫de -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Plano de Sa√∫de</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tipo de Plano</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.healthPlan === 'sus' ? 'SUS' : athlete.healthPlan === 'particular' ? 'Particular' : 'Sem Plano'}</p>
                        </div>
                        ${athlete.healthPlan === 'particular' ? `
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Conv√™nio</label>
                                <p class="mt-1 text-sm text-gray-900">${athlete.healthInsurance}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">N√∫mero da Carteirinha</label>
                                <p class="mt-1 text-sm text-gray-900">${athlete.insuranceCardNumber}</p>
                            </div>
                        ` : ''}
                        ${athlete.healthPlan === 'sus' ? `
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Carteirinha SUS</label>
                                <p class="mt-1 text-sm text-gray-900">${athlete.susCardNumber}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">UBS de Refer√™ncia</label>
                                <p class="mt-1 text-sm text-gray-900">${athlete.ubsReference}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                <!-- Dados Escolares -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Dados Escolares</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Nome da Escola</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.school?.name || 'N√£o informado'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">S√©rie/Ano</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.school?.grade || 'N√£o informado'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Turno</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.school?.shift || 'N√£o informado'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Endere√ßo da Escola</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.school?.address || 'N√£o informado'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Compete pela Escola?</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.school?.competeForSchool === 'sim' ? 'Sim' : 'N√£o'}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Dados Esportivos -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Dados Esportivos</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Modalidade Principal</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.sport}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Posi√ß√£o/Fun√ß√£o</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.position}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Categoria</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.category}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Equipe/Time</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.team}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Clube</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.club || 'N√£o informado'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Outras Atividades</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.otherActivities || 'N√£o informado'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Status</label>
                            <p class="mt-1 text-sm text-gray-900">${athlete.status}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Documentos -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Documentos Anexados</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Carteirinha do Plano -->
                        <div class="border border-gray-200 rounded-lg p-4">
                            ${athlete.documents?.healthCard ? `
                                <div class="text-center">
                                    <div class="bg-green-100 p-3 rounded-full w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 6.306a7.962 7.962 0 00-6 0m6 0V3a1 1 0 00-1-1H10a1 1 0 00-1 1v3.306"/>
                                        </svg>
                                    </div>
                                    <p class="text-sm font-medium text-gray-800">Carteirinha do Plano</p>
                                    <p class="text-xs text-green-600 mb-2">‚úÖ Anexado</p>
                                    <p class="text-xs text-gray-500 mb-3">üìÑ ${athlete.documents.healthCard.name}</p>
                                    <div class="space-y-2">
                                        <button onclick="viewDocument('${athlete.id}', 'healthCard')" class="w-full bg-blue-500 text-white px-3 py-2 rounded text-xs hover:bg-blue-600 transition-all">
                                            üëÅÔ∏è Visualizar
                                        </button>
                                        <button onclick="downloadDocument('${athlete.id}', 'healthCard')" class="w-full bg-green-500 text-white px-3 py-2 rounded text-xs hover:bg-green-600 transition-all">
                                            üì• Download
                                        </button>
                                    </div>
                                </div>
                            ` : `
                                <div class="text-center">
                                    <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 6.306a7.962 7.962 0 00-6 0m6 0V3a1 1 0 00-1-1H10a1 1 0 00-1 1v3.306"/>
                                    </svg>
                                    <p class="text-sm text-gray-600">Carteirinha do Plano</p>
                                    <p class="text-xs text-gray-400">‚ùå N√£o anexado</p>
                                </div>
                            `}
                        </div>
                        
                        <!-- RG -->
                        <div class="border border-gray-200 rounded-lg p-4">
                            ${athlete.documents?.rg ? `
                                <div class="text-center">
                                    <div class="bg-green-100 p-3 rounded-full w-12 h-12 mx-auto mb-2 flex items-center justify-center">
                                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 6.306a7.962 7.962 0 00-6 0m6 0V3a1 1 0 00-1-1H10a1 1 0 00-1 1v3.306"/>
                                        </svg>
                                    </div>
                                    <p class="text-sm font-medium text-gray-800">RG (Documento)</p>
                                    <p class="text-xs text-green-600 mb-2">‚úÖ Anexado</p>
                                    <p class="text-xs text-gray-500 mb-3">üìÑ ${athlete.documents.rg.name}</p>
                                    <div class="space-y-2">
                                        <button onclick="viewDocument('${athlete.id}', 'rg')" class="w-full bg-blue-500 text-white px-3 py-2 rounded text-xs hover:bg-blue-600 transition-all">
                                            üëÅÔ∏è Visualizar
                                        </button>
                                        <button onclick="downloadDocument('${athlete.id}', 'rg')" class="w-full bg-green-500 text-white px-3 py-2 rounded text-xs hover:bg-green-600 transition-all">
                                            üì• Download
                                        </button>
                                    </div>
                                </div>
                            ` : `
                                <div class="text-center">
                                    <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 6.306a7.962 7.962 0 00-6 0m6 0V3a1 1 0 00-1-1H10a1 1 0 00-1 1v3.306"/>
                                    </svg>
                                    <p class="text-sm text-gray-600">RG (Documento)</p>
                                    <p class="text-xs text-gray-400">‚ùå N√£o anexado</p>
                                </div>
                            `}
                        </div>
                    </div>
                    
                    ${athlete.documents?.healthCard || athlete.documents?.rg ? `
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-800">
                                <strong>üí° Dica:</strong> Clique em "Visualizar" para ver o documento ou "Download" para baix√°-lo.
                                ${athlete.documents?.healthCard ? `<br>üìÖ Carteirinha anexada em: ${new Date(athlete.documents.healthCard.uploadDate).toLocaleDateString('pt-BR')}` : ''}
                                ${athlete.documents?.rg ? `<br>üìÖ RG anexado em: ${new Date(athlete.documents.rg.uploadDate).toLocaleDateString('pt-BR')}` : ''}
                            </p>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        function editAthlete() {
            console.log('Edit athlete called, currentAthleteId:', currentAthleteId);
            if (!currentAthleteId) {
                console.log('No current athlete ID');
                return;
            }
            
            const athlete = athletes.find(a => a.id === currentAthleteId);
            if (!athlete) {
                console.log('Athlete not found for ID:', currentAthleteId);
                return;
            }
            
            console.log('Found athlete for editing:', athlete);
            
            // Close profile modal
            hideAthleteProfile();
            
            // Open edit modal with pre-filled data
            showEditAthleteModal(athlete);
        }
        
        function showEditAthleteModal(athlete) {
            // Show the add athlete modal but change title and button
            showAddAthleteModal();
            
            // Change modal title and button text
            const modalTitle = safeQuerySelector('#addAthleteModal h3');
            const submitButton = safeQuerySelector('#addAthleteModal button[type="submit"]');
            const nextAthleteId = safeGetElement('nextAthleteId');
            
            if (modalTitle) modalTitle.textContent = 'Editar Atleta';
            if (submitButton) submitButton.textContent = 'Salvar Altera√ß√µes';
            if (nextAthleteId) nextAthleteId.textContent = athlete.id;
            
            // Pre-fill all form fields
            const form = safeGetElement('addAthleteForm');
            if (!form) return;
            
            // Basic info - using safe selectors
            const fullNameInput = form.querySelector('input[name="fullName"]');
            const birthDateInput = form.querySelector('input[name="birthDate"]');
            const genderSelect = form.querySelector('select[name="gender"]');
            const rgInput = form.querySelector('input[name="rg"]');
            const phoneInput = form.querySelector('input[name="phone"]');
            const emailInput = form.querySelector('input[name="email"]');
            const professionInput = form.querySelector('input[name="profession"]');
            const teamInput = form.querySelector('input[name="team"]');
            const instagramInput = form.querySelector('input[name="instagram"]');
            const tiktokInput = form.querySelector('input[name="tiktok"]');
            
            if (fullNameInput) fullNameInput.value = athlete.name;
            if (birthDateInput) birthDateInput.value = athlete.birthDate;
            if (genderSelect) genderSelect.value = athlete.gender;
            if (rgInput) rgInput.value = athlete.rg || '';
            if (phoneInput) phoneInput.value = athlete.phone;
            if (emailInput) emailInput.value = athlete.email || '';
            if (professionInput) professionInput.value = athlete.profession || '';
            if (teamInput) teamInput.value = athlete.team;
            if (instagramInput) instagramInput.value = athlete.instagram || '';
            if (tiktokInput) tiktokInput.value = athlete.tiktok || '';
            
            // Address - using safe selectors
            const cepInput = form.querySelector('input[name="cep"]');
            const stateSelect = form.querySelector('select[name="state"]');
            const cityInput = form.querySelector('input[name="city"]');
            const neighborhoodInput = form.querySelector('input[name="neighborhood"]');
            const addressInput = form.querySelector('input[name="address"]');
            const addressNumberInput = form.querySelector('input[name="addressNumber"]');
            const addressComplementInput = form.querySelector('input[name="addressComplement"]');
            
            if (cepInput) cepInput.value = athlete.address?.cep || '';
            if (stateSelect) stateSelect.value = athlete.address?.state || '';
            if (cityInput) cityInput.value = athlete.address?.city || '';
            if (neighborhoodInput) neighborhoodInput.value = athlete.address?.neighborhood || '';
            if (addressInput) addressInput.value = athlete.address?.address || '';
            if (addressNumberInput) addressNumberInput.value = athlete.address?.number || '';
            if (addressComplementInput) addressComplementInput.value = athlete.address?.complement || '';
            
            // Guardian - using safe selectors
            const guardianNameInput = form.querySelector('input[name="guardianName"]');
            const guardianRelationSelect = form.querySelector('select[name="guardianRelation"]');
            const guardianPhoneInput = form.querySelector('input[name="guardianPhone"]');
            const guardianEmailInput = form.querySelector('input[name="guardianEmail"]');
            
            if (guardianNameInput) guardianNameInput.value = athlete.guardian?.name || '';
            if (guardianRelationSelect) guardianRelationSelect.value = athlete.guardian?.relation || '';
            if (guardianPhoneInput) guardianPhoneInput.value = athlete.guardian?.phone || '';
            if (guardianEmailInput) guardianEmailInput.value = athlete.guardian?.email || '';
            
            // School - using safe selectors
            const schoolNameInput = form.querySelector('input[name="schoolName"]');
            const schoolGradeSelect = form.querySelector('select[name="schoolGrade"]');
            const schoolShiftSelect = form.querySelector('select[name="schoolShift"]');
            const schoolAddressInput = form.querySelector('input[name="schoolAddress"]');
            
            if (schoolNameInput) schoolNameInput.value = athlete.school?.name || '';
            if (schoolGradeSelect) schoolGradeSelect.value = athlete.school?.grade || '';
            if (schoolShiftSelect) schoolShiftSelect.value = athlete.school?.shift || '';
            if (schoolAddressInput) schoolAddressInput.value = athlete.school?.address || '';
            
            if (athlete.school?.competeForSchool) {
                const competeRadio = form.querySelector(`input[name="competeForSchool"][value="${athlete.school.competeForSchool}"]`);
                if (competeRadio) competeRadio.checked = true;
            }
            
            // Health plan - using safe selectors
            const healthPlanSelect = form.querySelector('select[name="healthPlan"]');
            if (healthPlanSelect) {
                healthPlanSelect.value = athlete.healthPlan || '';
                toggleHealthPlanFields(); // Show relevant fields
            }
            
            if (athlete.healthPlan === 'particular') {
                const healthInsuranceSelect = form.querySelector('select[name="healthInsurance"]');
                const insuranceCardNumberInput = form.querySelector('input[name="insuranceCardNumber"]');
                const emergencyHospitalInput = form.querySelector('input[name="emergencyHospital"]');
                
                if (healthInsuranceSelect) healthInsuranceSelect.value = athlete.healthInsurance || '';
                if (insuranceCardNumberInput) insuranceCardNumberInput.value = athlete.insuranceCardNumber || '';
                if (emergencyHospitalInput) emergencyHospitalInput.value = athlete.emergencyHospital || '';
            } else if (athlete.healthPlan === 'sus') {
                const susCardNumberInput = form.querySelector('input[name="susCardNumber"]');
                const ubsReferenceInput = form.querySelector('input[name="ubsReference"]');
                
                if (susCardNumberInput) susCardNumberInput.value = athlete.susCardNumber || '';
                if (ubsReferenceInput) ubsReferenceInput.value = athlete.ubsReference || '';
            }
            
            // Sports data - using safe selectors
            const sportMapping = {
                'Futebol': 'futebol',
                'Nata√ß√£o': 'natacao',
                'Basquete': 'basquete',
                'V√¥lei': 'volei',
                'Futsal': 'futsal',
                'Atletismo': 'atletismo',
                'Handebol': 'handebol',
                'T√™nis': 'tenis',
                'Jud√¥': 'judo',
                'Karat√™': 'karate',
                'Taekwondo': 'taekwondo',
                'Boxe': 'boxe',
                'Muay Thai': 'muaythai',
                'Jiu-Jitsu': 'jiu-jitsu',
                'Capoeira': 'capoeira',
                'Gin√°stica': 'ginastica',
                'Skate': 'skate',
                'Surf': 'surf',
                'Ciclismo': 'ciclismo',
                'Corrida': 'corrida',
                'T√™nis de Mesa': 'tenis-mesa',
                'Badminton': 'badminton',
                'Rugby': 'rugby',
                'Hockey': 'hockey',
                'Esgrima': 'esgrima'
            };
            
            const mainSportSelect = form.querySelector('select[name="mainSport"]');
            const clubInput = form.querySelector('input[name="club"]');
            const otherActivitiesInput = form.querySelector('input[name="otherActivities"]');
            const athleteStatusSelect = form.querySelector('select[name="athleteStatus"]');
            
            if (mainSportSelect) {
                const sportValue = sportMapping[athlete.sport] || athlete.sport.toLowerCase();
                mainSportSelect.value = sportValue;
                updatePositions(); // Update positions
                
                setTimeout(() => {
                    if (athlete.position) {
                        const positionSelect = form.querySelector('select[name="position"]');
                        if (positionSelect) {
                            const positionValue = athlete.position.toLowerCase().replace(/\s+/g, '_');
                            positionSelect.value = positionValue;
                        }
                    }
                }, 100);
            }
            
            if (clubInput) clubInput.value = athlete.club || '';
            if (otherActivitiesInput) otherActivitiesInput.value = athlete.otherActivities || '';
            if (athleteStatusSelect) athleteStatusSelect.value = athlete.status || '';
            
            // Calculate age and category
            calculateAge();
            calculateCategory();
            
            // Set photo if exists
            if (athlete.photo) {
                document.getElementById('photoPreview').innerHTML = `<img src="${athlete.photo}" alt="Preview" class="w-full h-full object-cover rounded-full">`;
            }
            
            // Load existing documents
            if (athlete.documents) {
                uploadedDocuments = { ...athlete.documents };
                
                // Update document previews
                if (athlete.documents.healthCard) {
                    const healthCardPreview = document.getElementById('healthCardPreview');
                    if (healthCardPreview) {
                        healthCardPreview.innerHTML = `
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                <span class="text-green-600">Carteirinha do plano anexada com sucesso!</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">üìÑ ${athlete.documents.healthCard.name}</p>
                        `;
                        healthCardPreview.classList.remove('hidden');
                    }
                }
                
                if (athlete.documents.rg) {
                    const rgPreview = document.getElementById('rgPreview');
                    if (rgPreview) {
                        rgPreview.innerHTML = `
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                <span class="text-green-600">RG anexado com sucesso!</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">üìÑ ${athlete.documents.rg.name}</p>
                        `;
                        rgPreview.classList.remove('hidden');
                    }
                }
            }
            
            // Mark form as edit mode
            form.setAttribute('data-edit-mode', 'true');
            form.setAttribute('data-athlete-id', athlete.id);
        }
        
        function confirmDeleteAthlete() {
            console.log('Confirm delete called, currentAthleteId:', currentAthleteId);
            if (!currentAthleteId) {
                console.log('No current athlete ID for deletion');
                return;
            }
            
            const athlete = athletes.find(a => a.id === currentAthleteId);
            if (!athlete) {
                console.log('Athlete not found for deletion:', currentAthleteId);
                return;
            }
            
            console.log('Creating delete confirmation for athlete:', athlete.name);
            
            // Remove existing modal if any
            const existingModal = window.document.getElementById('deleteConfirmModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Create custom confirmation modal
            const confirmationHtml = `
                <div id="deleteConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
                        <div class="text-center">
                            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                                <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Confirmar Exclus√£o</h3>
                            <p class="text-sm text-gray-600 mb-6">
                                Tem certeza que deseja excluir permanentemente o atleta <strong>${athlete.name}</strong>?
                                <br><br>
                                <span class="text-red-600 font-medium">‚ö†Ô∏è Esta a√ß√£o n√£o pode ser desfeita!</span>
                                <br><br>
                                Todos os dados do atleta, incluindo fichas de sa√∫de e hist√≥rico, ser√£o perdidos.
                            </p>
                            <div class="flex space-x-3">
                                <button onclick="cancelDelete()" class="flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 transition-all font-medium">
                                    Cancelar
                                </button>
                                <button onclick="executeDelete()" class="flex-1 bg-red-500 text-white py-3 px-4 rounded-lg hover:bg-red-600 transition-all font-medium">
                                    Sim, Excluir
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add modal to body
            const modalDiv = window.document.createElement('div');
            modalDiv.innerHTML = confirmationHtml;
            window.document.body.appendChild(modalDiv.firstElementChild);
        }
        
        function cancelDelete() {
            const modal = window.document.getElementById('deleteConfirmModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function executeDelete() {
            console.log('Execute delete called, currentAthleteId:', currentAthleteId);
            if (!currentAthleteId) {
                console.log('No current athlete ID for execution');
                return;
            }
            
            const athlete = athletes.find(a => a.id === currentAthleteId);
            if (!athlete) {
                console.log('Athlete not found for execution:', currentAthleteId);
                return;
            }
            
            console.log('Executing delete for athlete:', athlete.name);
            
            // Remove athlete from array
            const index = athletes.findIndex(a => a.id === currentAthleteId);
            if (index > -1) {
                athletes.splice(index, 1);
                console.log('Athlete removed from array, new length:', athletes.length);
            }
            
            // Remove related health records
            const initialHealthRecordsLength = healthRecords.length;
            healthRecords = healthRecords.filter(record => record.athleteId !== currentAthleteId);
            console.log('Health records filtered, removed:', initialHealthRecordsLength - healthRecords.length);
            
            // Update displays
            filteredAthletes = [...athletes];
            populateAthletesTable();
            populateAthleteSelect();
            populateSportFilter();
            updateAthleteCount();
            
            // Update dashboard stats
            const totalAthletesElement = document.getElementById('totalAthletes');
            if (totalAthletesElement) {
                totalAthletesElement.textContent = athletes.length;
            }
            
            // Close modals
            cancelDelete();
            hideAthleteProfile();
            
            // Show success message
            showSuccessMessage(`‚úÖ Atleta ${athlete.name} foi exclu√≠do com sucesso!`);
        }
        
        function showSuccessMessage(message) {
            const successHtml = `
                <div id="successMessage" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 flex items-center space-x-3">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    <span>${message}</span>
                </div>
            `;
            
            // Create message element
            const messageDiv = window.document.createElement('div');
            messageDiv.innerHTML = successHtml;
            window.document.body.appendChild(messageDiv.firstElementChild);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                const successMsg = window.document.getElementById('successMessage');
                if (successMsg) {
                    successMsg.remove();
                }
            }, 3000);
        }

        // Health section variables
        let selectedAthleteForHealth = null;
        let healthRecords = [];

        // Search athletes for health section
        function searchAthleteForHealth() {
            const searchNameInput = document.getElementById('healthSearchName');
            const searchIdInput = document.getElementById('healthSearchId');
            const resultsDiv = document.getElementById('healthSearchResults');
            const athletesList = document.getElementById('healthAthletesList');
            
            if (!searchNameInput || !searchIdInput || !resultsDiv || !athletesList) {
                console.log('Health search elements not found');
                return;
            }
            
            const searchName = searchNameInput.value.toLowerCase().trim();
            const searchId = searchIdInput.value.toLowerCase().trim();
            
            // Show results if there's any search term
            if (!searchName && !searchId) {
                resultsDiv.classList.add('hidden');
                return;
            }
            
            const filteredAthletes = athletes.filter(athlete => {
                const matchesName = searchName ? athlete.name.toLowerCase().includes(searchName) : false;
                const matchesId = searchId ? athlete.id.toLowerCase().includes(searchId) : false;
                return matchesName || matchesId;
            });
            
            if (filteredAthletes.length > 0) {
                resultsDiv.classList.remove('hidden');
                athletesList.innerHTML = '';
                
                filteredAthletes.forEach(athlete => {
                    const athleteDiv = document.createElement('div');
                    athleteDiv.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors';
                    athleteDiv.onclick = () => selectAthleteForHealth(athlete);
                    
                    athleteDiv.innerHTML = `
                        <div class="flex items-center space-x-4">
                            <div class="flex-shrink-0">
                                ${athlete.photo ? 
                                    `<img src="${athlete.photo}" alt="${athlete.name}" class="h-12 w-12 rounded-full object-cover">` :
                                    `<div class="h-12 w-12 rounded-full bg-primary text-white flex items-center justify-center font-semibold">
                                        ${athlete.name.charAt(0)}
                                    </div>`
                                }
                            </div>
                            <div>
                                <p class="font-medium text-gray-900">${athlete.name}</p>
                                <p class="text-sm text-gray-600">ID: ${athlete.id} ‚Ä¢ ${athlete.age} anos ‚Ä¢ ${athlete.sport}</p>
                            </div>
                        </div>
                        <button class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-all">
                            Selecionar
                        </button>
                    `;
                    
                    athletesList.appendChild(athleteDiv);
                });
            } else {
                resultsDiv.classList.remove('hidden');
                athletesList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <svg class="w-12 h-12 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 6.306a7.962 7.962 0 00-6 0m6 0V3a1 1 0 00-1-1H10a1 1 0 00-1 1v3.306"/>
                        </svg>
                        <p class="text-lg font-medium">Nenhum atleta encontrado</p>
                        <p class="text-sm">Tente ajustar os termos de busca</p>
                    </div>
                `;
            }
        }

        // Select athlete for health management
        function selectAthleteForHealth(athlete) {
            selectedAthleteForHealth = athlete;
            
            // Hide search results
            document.getElementById('healthSearchResults').classList.add('hidden');
            
            // Clear search fields
            document.getElementById('healthSearchName').value = '';
            document.getElementById('healthSearchId').value = '';
            
            // Open health record modal directly
            showNewHealthRecordModal();
        }

        // Load health records for selected athlete
        function loadHealthRecords(athleteId) {
            const recordsList = document.getElementById('healthRecordsList');
            const athleteHealthRecords = healthRecords.filter(record => record.athleteId === athleteId);
            
            if (athleteHealthRecords.length === 0) {
                recordsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <svg class="w-12 h-12 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 6.306a7.962 7.962 0 00-6 0m6 0V3a1 1 0 00-1-1H10a1 1 0 00-1 1v3.306"/>
                        </svg>
                        <p class="text-lg font-medium">Nenhuma ficha de sa√∫de cadastrada</p>
                        <p class="text-sm">Clique em "Nova Ficha" para adicionar dados de sa√∫de</p>
                    </div>
                `;
            } else {
                recordsList.innerHTML = '';
                athleteHealthRecords.forEach(record => {
                    const recordDiv = document.createElement('div');
                    recordDiv.className = 'bg-gray-50 border border-gray-200 rounded-lg p-4';
                    
                    recordDiv.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h5 class="font-medium text-gray-900">Avalia√ß√£o de ${new Date(record.evaluationDate).toLocaleDateString('pt-BR')}</h5>
                                <p class="text-sm text-gray-600">IMC: ${record.imc} ‚Ä¢ Peso: ${record.weight}kg ‚Ä¢ Altura: ${record.height}cm</p>
                            </div>
                            <button onclick="viewHealthRecord('${record.id}')" class="text-primary hover:text-primary-dark text-sm">
                                Ver Detalhes
                            </button>
                        </div>
                        <div class="text-sm text-gray-700">
                            <p><strong>Press√£o:</strong> ${record.bloodPressure || 'N√£o informado'}</p>
                            <p><strong>Freq. Card√≠aca:</strong> ${record.heartRate ? record.heartRate + ' bpm' : 'N√£o informado'}</p>
                        </div>
                    `;
                    
                    recordsList.appendChild(recordDiv);
                });
            }
        }

        // Show new athlete health modal (for new athletes)
        function showNewAthleteHealthModal() {
            // Clear any previous selection
            selectedAthleteForHealth = null;
            
            const modal = document.getElementById('newHealthRecordModal');
            const athleteInfo = document.getElementById('healthRecordAthleteInfo');
            
            athleteInfo.textContent = 'Cadastrando novo atleta - Preencha todos os dados';
            
            // Clear all form fields for new athlete
            const form = document.getElementById('newHealthRecordForm');
            if (form) {
                form.reset();
                
                // Clear calculated fields
                document.getElementById('healthImcDisplay').value = '';
                document.getElementById('bodyFatDisplay').value = '';
                document.getElementById('muscleMassDisplay').value = '';
                document.getElementById('boneMassDisplay').value = '';
                document.getElementById('bodyWaterDisplay').value = '';
                document.getElementById('bmrDisplay').value = '';
                document.getElementById('metabolicAgeDisplay').value = '';
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Show new health record modal
        function showNewHealthRecordModal() {
            if (!selectedAthleteForHealth) return;
            
            const modal = document.getElementById('newHealthRecordModal');
            const athleteInfo = document.getElementById('healthRecordAthleteInfo');
            
            athleteInfo.textContent = `Atleta: ${selectedAthleteForHealth.name} (ID: ${selectedAthleteForHealth.id})`;
            
            // Pre-fill athlete data from registration
            const athlete = selectedAthleteForHealth;
            
            // Fill sport data
            const sportSelect = document.getElementById('healthMainSportSelect');
            const sportValue = athlete.sport.toLowerCase().replace(/\s+/g, '');
            
            // Map sport names to select values
            const sportMapping = {
                'futebol': 'futebol',
                'nata√ß√£o': 'natacao',
                'basquete': 'basquete',
                'v√¥lei': 'volei',
                'futsal': 'futsal',
                'atletismo': 'atletismo',
                'handebol': 'handebol',
                't√™nis': 'tenis',
                'jud√¥': 'judo',
                'karat√™': 'karate',
                'taekwondo': 'taekwondo',
                'boxe': 'boxe',
                'muaythai': 'muaythai',
                'jiu-jitsu': 'jiu-jitsu',
                'capoeira': 'capoeira',
                'gin√°stica': 'ginastica',
                'skate': 'skate',
                'surf': 'surf',
                'ciclismo': 'ciclismo',
                'corrida': 'corrida',
                't√™nisdemesa': 'tenis-mesa',
                'badminton': 'badminton',
                'rugby': 'rugby',
                'hockey': 'hockey',
                'esgrima': 'esgrima'
            };
            
            const mappedSport = sportMapping[sportValue] || sportValue;
            if (mappedSport) {
                sportSelect.value = mappedSport;
                updateHealthPositions(); // Update positions after setting sport
                
                // Set position if available
                setTimeout(() => {
                    const positionSelect = document.getElementById('healthPositionSelect');
                    if (athlete.position) {
                        const positionValue = athlete.position.toLowerCase().replace(/\s+/g, '_');
                        positionSelect.value = positionValue;
                    }
                }, 100);
            }
            
            // Set category
            const categorySelect = document.querySelector('select[name="category"]');
            if (athlete.category) {
                categorySelect.value = athlete.category;
            }
            
            // Set club
            const clubInput = document.querySelector('input[name="club"]');
            if (athlete.club) {
                clubInput.value = athlete.club;
            }
            
            // Set other activities
            const otherActivitiesInput = document.querySelector('input[name="otherActivities"]');
            if (athlete.otherActivities) {
                otherActivitiesInput.value = athlete.otherActivities;
            }
            
            // Set athlete status
            const statusSelect = document.querySelector('select[name="athleteStatus"]');
            if (athlete.status) {
                statusSelect.value = athlete.status;
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Set today's date as default
            document.querySelector('input[name="evaluationDate"]').value = new Date().toISOString().split('T')[0];
        }

        // Hide new health record modal
        function hideNewHealthRecordModal() {
            const modal = document.getElementById('newHealthRecordModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            
            // Reset form
            document.getElementById('newHealthRecordForm').reset();
            document.getElementById('imcDisplay').value = '';
        }

        // Update positions for health form
        function updateHealthPositions() {
            const sportSelect = document.getElementById('healthMainSportSelect');
            const positionSelect = document.getElementById('healthPositionSelect');
            const selectedSport = sportSelect.value;
            
            // Clear current options
            positionSelect.innerHTML = '<option value="">Selecione uma posi√ß√£o</option>';
            
            if (selectedSport && sportPositions[selectedSport]) {
                sportPositions[selectedSport].forEach(position => {
                    const option = document.createElement('option');
                    option.value = position.toLowerCase().replace(/\s+/g, '_');
                    option.textContent = position;
                    positionSelect.appendChild(option);
                });
            } else {
                positionSelect.innerHTML = '<option value="">Selecione primeiro a modalidade</option>';
            }
        }

        // Calculate age for health form
        function calculateHealthAge() {
            const birthDateInput = document.querySelector('input[name="birthDate"]');
            const ageDisplay = document.getElementById('healthAgeDisplay');
            
            if (birthDateInput && ageDisplay && birthDateInput.value) {
                const birthDate = new Date(birthDateInput.value);
                const today = new Date();
                
                let years = today.getFullYear() - birthDate.getFullYear();
                let months = today.getMonth() - birthDate.getMonth();
                let days = today.getDate() - birthDate.getDate();
                
                // Adjust for negative days
                if (days < 0) {
                    months--;
                    const lastMonth = new Date(today.getFullYear(), today.getMonth(), 0);
                    days += lastMonth.getDate();
                }
                
                // Adjust for negative months
                if (months < 0) {
                    years--;
                    months += 12;
                }
                
                ageDisplay.value = `${years} anos, ${months} meses e ${days} dias`;
                
                // Trigger metrics calculation
                calculateHealthMetrics();
            } else if (ageDisplay) {
                ageDisplay.value = '';
            }
        }

        // Calculate category for health form
        function calculateHealthCategory() {
            const birthDateInput = document.querySelector('input[name="birthDate"]');
            const categorySelect = document.querySelector('select[name="category"]');
            
            if (birthDateInput && categorySelect && birthDateInput.value) {
                const birthDate = new Date(birthDateInput.value);
                const currentYear = new Date().getFullYear();
                const age = currentYear - birthDate.getFullYear();
                
                let category = '';
                
                // Calculate category based on age
                if (age <= 11) {
                    category = 'Sub-11';
                } else if (age <= 13) {
                    category = 'Sub-13';
                } else if (age <= 15) {
                    category = 'Sub-15';
                } else if (age <= 17) {
                    category = 'Sub-17';
                } else if (age <= 20) {
                    category = 'Sub-20';
                } else {
                    category = 'Adulto';
                }
                
                categorySelect.value = category;
            }
        }

        // Calculate health metrics
        function calculateHealthMetrics() {
            const weightInput = document.querySelector('input[name="weight"]');
            const heightInput = document.querySelector('input[name="height"]');
            const genderSelect = document.querySelector('select[name="gender"]');
            const birthDateInput = document.querySelector('input[name="birthDate"]');
            const imcDisplay = document.getElementById('healthImcDisplay');
            const bodyFatDisplay = document.getElementById('bodyFatDisplay');
            const muscleMassDisplay = document.getElementById('muscleMassDisplay');
            const boneMassDisplay = document.getElementById('boneMassDisplay');
            const bodyWaterDisplay = document.getElementById('bodyWaterDisplay');
            const bmrDisplay = document.getElementById('bmrDisplay');
            const metabolicAgeDisplay = document.getElementById('metabolicAgeDisplay');
            
            const weight = parseFloat(weightInput.value);
            const height = parseFloat(heightInput.value);
            const gender = genderSelect ? genderSelect.value : '';
            
            // Calculate age from birth date
            let age = 16; // Default
            if (birthDateInput && birthDateInput.value) {
                const birthDate = new Date(birthDateInput.value);
                const today = new Date();
                age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
            }
            
            if (weight && height && gender) {
                const heightInMeters = height / 100;
                const imc = weight / (heightInMeters * heightInMeters);
                
                // IMC Classification
                let classification = '';
                if (imc < 18.5) {
                    classification = 'Abaixo do peso';
                } else if (imc < 25) {
                    classification = 'Peso normal';
                } else if (imc < 30) {
                    classification = 'Sobrepeso';
                } else {
                    classification = 'Obesidade';
                }
                
                imcDisplay.value = `${imc.toFixed(1)} (${classification})`;
                
                // Estimate body fat percentage (Jackson-Pollock formula approximation)
                const isMale = gender === 'masculino';
                
                let bodyFat;
                if (isMale) {
                    bodyFat = (1.20 * imc) + (0.23 * age) - 16.2;
                } else {
                    bodyFat = (1.20 * imc) + (0.23 * age) - 5.4;
                }
                bodyFat = Math.max(5, Math.min(50, bodyFat)); // Clamp between 5-50%
                bodyFatDisplay.value = `${bodyFat.toFixed(1)}%`;
                
                // Estimate muscle mass (Boer formula approximation)
                let muscleMass;
                if (isMale) {
                    muscleMass = (0.407 * weight) + (0.267 * height) - 19.2;
                } else {
                    muscleMass = (0.252 * weight) + (0.473 * height) - 48.3;
                }
                muscleMass = Math.max(10, muscleMass);
                muscleMassDisplay.value = `${muscleMass.toFixed(1)} kg`;
                
                // Estimate bone mass (approximately 15% of body weight for athletes)
                const boneMass = weight * 0.15;
                boneMassDisplay.value = `${boneMass.toFixed(1)} kg`;
                
                // Estimate body water (approximately 60% for males, 55% for females)
                const bodyWater = isMale ? weight * 0.60 : weight * 0.55;
                const bodyWaterPercent = (bodyWater / weight) * 100;
                bodyWaterDisplay.value = `${bodyWaterPercent.toFixed(1)}%`;
                
                // Calculate BMR (Mifflin-St Jeor Equation)
                let bmr;
                if (isMale) {
                    bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
                } else {
                    bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
                }
                bmrDisplay.value = `${Math.round(bmr)} kcal/dia`;
                
                // Estimate metabolic age (simplified calculation)
                const idealBMR = isMale ? 1800 : 1400; // Approximate ideal BMR for athletes
                const metabolicAge = age + ((bmr - idealBMR) / 50);
                const clampedMetabolicAge = Math.max(15, Math.min(50, metabolicAge));
                metabolicAgeDisplay.value = `${Math.round(clampedMetabolicAge)} anos`;
                
            } else {
                // Clear all displays if inputs are invalid
                imcDisplay.value = '';
                bodyFatDisplay.value = '';
                muscleMassDisplay.value = '';
                boneMassDisplay.value = '';
                bodyWaterDisplay.value = '';
                bmrDisplay.value = '';
                metabolicAgeDisplay.value = '';
            }
        }

        // Toggle functions for medical history
        function toggleDiseaseDetails() {
            const hasDisease = document.querySelector('input[name="hasDisease"]:checked');
            const details = document.getElementById('diseaseDetails');
            if (hasDisease && hasDisease.value === 'sim') {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        }

        function toggleMedicationDetails() {
            const usesMedication = document.querySelector('input[name="usesMedication"]:checked');
            const details = document.getElementById('medicationDetails');
            if (usesMedication && usesMedication.value === 'sim') {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        }

        function toggleAllergyDetails() {
            const hasAllergy = document.querySelector('input[name="hasAllergy"]:checked');
            const details = document.getElementById('allergyDetails');
            if (hasAllergy && hasAllergy.value === 'sim') {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        }

        function toggleSurgeryDetails() {
            const hadSurgery = document.querySelector('input[name="hadSurgery"]:checked');
            const details = document.getElementById('surgeryDetails');
            if (hadSurgery && hadSurgery.value === 'sim') {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        }

        function toggleInjuryDetails() {
            const hadInjury = document.querySelector('input[name="hadInjury"]:checked');
            const details = document.getElementById('injuryDetails');
            if (hadInjury && hadInjury.value === 'sim') {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        }

        function toggleSmokingDetails() {
            const smokes = document.querySelector('input[name="smokes"]:checked');
            const details = document.getElementById('smokingDetails');
            if (smokes && smokes.value === 'sim') {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        }

        function toggleDrinkingDetails() {
            const drinks = document.querySelector('input[name="drinks"]:checked');
            const details = document.getElementById('drinkingDetails');
            if (drinks && drinks.value === 'sim') {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        }

        // Handle new health record form submission
        function initializeHealthRecordForm() {
            const form = safeGetElement('newHealthRecordForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(e.target);
                    
                    // Check if it's a new athlete (no selectedAthleteForHealth)
                    if (!selectedAthleteForHealth) {
                        // Create new athlete from health form
                        const fullName = formData.get('fullName');
                        const birthDate = formData.get('birthDate');
                        const gender = formData.get('gender');
                        const phone = formData.get('phone');
                        const mainSport = formData.get('mainSport');
                        
                        // Validate required fields
                        if (!fullName || !birthDate || !gender || !phone || !mainSport) {
                            alert('Por favor, preencha todos os campos obrigat√≥rios marcados com *');
                            return;
                        }
                        
                        // Calculate age
                        const birthDateObj = new Date(birthDate);
                        const today = new Date();
                        let age = today.getFullYear() - birthDateObj.getFullYear();
                        const monthDiff = today.getMonth() - birthDateObj.getMonth();
                        
                        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDateObj.getDate())) {
                            age--;
                        }
                        
                        // Check if athlete is over 18
                        if (age > 18) {
                            alert('Este sistema √© destinado apenas para atletas at√© 18 anos.');
                            return;
                        }
                        
                        // Get sport name
                        const sportSelect = document.getElementById('healthMainSportSelect');
                        const sportText = sportSelect.options[sportSelect.selectedIndex].text;
                        const sportName = sportText.split(' ').slice(1).join(' '); // Remove emoji
                        
                        // Calculate category
                        let category = '';
                        if (age <= 11) {
                            category = 'Sub-11';
                        } else if (age <= 13) {
                            category = 'Sub-13';
                        } else if (age <= 15) {
                            category = 'Sub-15';
                        } else if (age <= 17) {
                            category = 'Sub-17';
                        } else if (age <= 20) {
                            category = 'Sub-20';
                        } else {
                            category = 'Adulto';
                        }
                        
                        // Create new athlete
                        const newAthlete = {
                            id: nextAthleteIdNumber.toString(),
                            name: fullName,
                            age: age,
                            sport: sportName,
                            category: category,
                            birthDate: birthDate,
                            gender: gender,
                            phone: phone,
                            email: formData.get('email') || 'N√£o informado',
                            team: 'N√£o informado',
                            position: formData.get('position') || 'N√£o definida',
                            status: formData.get('athleteStatus') || 'ativo',
                            photo: null,
                            rg: 'N√£o informado',
                            profession: 'Estudante',
                            instagram: '',
                            tiktok: '',
                            address: {
                                cep: '',
                                state: '',
                                city: '',
                                neighborhood: '',
                                address: '',
                                number: '',
                                complement: ''
                            },
                            guardian: {
                                name: 'N√£o informado',
                                relation: 'N√£o informado',
                                phone: 'N√£o informado',
                                email: 'N√£o informado'
                            },
                            school: {
                                name: 'N√£o informado',
                                grade: 'N√£o informado',
                                shift: 'N√£o informado',
                                address: 'N√£o informado',
                                competeForSchool: 'nao'
                            },
                            healthPlan: 'sem-plano',
                            healthInsurance: '',
                            insuranceCardNumber: '',
                            emergencyHospital: '',
                            susCardNumber: '',
                            ubsReference: '',
                            club: formData.get('club') || 'N√£o informado',
                            otherActivities: formData.get('otherActivities') || 'N√£o informado',
                            documents: {}
                        };
                        
                        // Add athlete to system
                        athletes.push(newAthlete);
                        nextAthleteIdNumber++;
                        
                        // Update displays
                        filteredAthletes = [...athletes];
                        populateAthletesTable();
                        populateAthleteSelect();
                        populateSportFilter();
                        updateAthleteCount();
                        
                        // Update dashboard stats
                        document.getElementById('totalAthletes').textContent = athletes.length;
                        
                        // Create health record if weight and height provided
                        const weight = parseFloat(formData.get('weight'));
                        const height = parseFloat(formData.get('height'));
                        
                        if (weight && height) {
                            const heightInMeters = height / 100;
                            const imc = weight / (heightInMeters * heightInMeters);
                            
                            const newRecord = {
                                id: Date.now().toString(),
                                athleteId: newAthlete.id,
                                evaluationDate: new Date().toISOString().split('T')[0],
                                weight: weight,
                                height: height,
                                imc: imc.toFixed(1),
                                // Vaccination data
                                dt_first: formData.get('dt_first') || '',
                                yellow_fever: formData.get('yellow_fever') || '',
                                mmr_booster: formData.get('mmr_booster') || '',
                                hpv_first: formData.get('hpv_first') || '',
                                hpv_second: formData.get('hpv_second') || '',
                                meningococcal_acwy: formData.get('meningococcal_acwy') || '',
                                meningococcal_b: formData.get('meningococcal_b') || '',
                                dt_booster: formData.get('dt_booster') || '',
                                hepatitis_b_booster: formData.get('hepatitis_b_booster') || '',
                                dt_adult: formData.get('dt_adult') || '',
                                mmr_adult: formData.get('mmr_adult') || '',
                                hepatitis_b_adult: formData.get('hepatitis_b_adult') || '',
                                hpv_adult: formData.get('hpv_adult') || '',
                                influenza: formData.get('influenza') || '',
                                covid_first: formData.get('covid_first') || '',
                                covid_second: formData.get('covid_second') || '',
                                covid_booster: formData.get('covid_booster') || '',
                                vaccineObservations: formData.get('vaccineObservations') || '',
                                // Medical history
                                hasDisease: formData.get('hasDisease') || '',
                                diseaseDetails: formData.get('diseaseDetails') || '',
                                usesMedication: formData.get('usesMedication') || '',
                                medicationDetails: formData.get('medicationDetails') || '',
                                hasAllergy: formData.get('hasAllergy') || '',
                                allergyDetails: formData.get('allergyDetails') || '',
                                hadSurgery: formData.get('hadSurgery') || '',
                                surgeryDetails: formData.get('surgeryDetails') || '',
                                hadInjury: formData.get('hadInjury') || '',
                                injuryDetails: formData.get('injuryDetails') || '',
                                smokes: formData.get('smokes') || '',
                                smokingDetails: formData.get('smokingDetails') || '',
                                drinks: formData.get('drinks') || '',
                                drinkingDetails: formData.get('drinkingDetails') || ''
                            };
                            
                            healthRecords.push(newRecord);
                        }
                        
                        // Hide modal
                        hideNewHealthRecordModal();
                        
                        showSuccessMessage(`‚úÖ Atleta ${newAthlete.name} cadastrado com sucesso!`);
                        
                        // Open athlete profile
                        setTimeout(() => {
                            showAthleteProfile(newAthlete.id);
                        }, 100);
                        
                        return;
                    }
                    
                    // Existing athlete - create health record only
                    const weight = parseFloat(formData.get('weight'));
                    const height = parseFloat(formData.get('height'));
                    
                    if (!weight || !height) {
                        alert('Por favor, preencha peso e altura para calcular o IMC.');
                        return;
                    }
                    
                    const heightInMeters = height / 100;
                    const imc = weight / (heightInMeters * heightInMeters);
                    
                    const newRecord = {
                        id: Date.now().toString(),
                        athleteId: selectedAthleteForHealth.id,
                        evaluationDate: formData.get('evaluationDate') || new Date().toISOString().split('T')[0],
                        weight: weight,
                        height: height,
                        imc: imc.toFixed(1),
                        bloodPressure: formData.get('bloodPressure') || '',
                        heartRate: formData.get('heartRate') || '',
                        bodyFat: formData.get('bodyFat') || '',
                        muscleMass: formData.get('muscleMass') || '',
                        flexibility: formData.get('flexibility') || '',
                        cardioResistance: formData.get('cardioResistance') || '',
                        allergies: formData.get('allergies') || '',
                        medications: formData.get('medications') || '',
                        surgeries: formData.get('surgeries') || '',
                        injuries: formData.get('injuries') || '',
                        observations: formData.get('observations') || '',
                        recommendations: formData.get('recommendations') || ''
                    };
                    
                    healthRecords.push(newRecord);
                    
                    // Reload health records for the athlete
                    loadHealthRecords(selectedAthleteForHealth.id);
                    
                    // Hide modal
                    hideNewHealthRecordModal();
                    
                    showSuccessMessage('‚úÖ Ficha de sa√∫de salva com sucesso!');
                });
            }
        }

        // View health record details
        function viewHealthRecord(recordId) {
            const record = healthRecords.find(r => r.id === recordId);
            if (!record) return;
            
            alert(`Detalhes da Avalia√ß√£o de ${new Date(record.evaluationDate).toLocaleDateString('pt-BR')}:\n\nPeso: ${record.weight}kg\nAltura: ${record.height}cm\nIMC: ${record.imc}\nPress√£o: ${record.bloodPressure || 'N√£o informado'}\nFreq. Card√≠aca: ${record.heartRate ? record.heartRate + ' bpm' : 'N√£o informado'}\n\nObserva√ß√µes: ${record.observations || 'Nenhuma observa√ß√£o'}`);
        }

        // View document
        function viewDocument(athleteId, documentType) {
            const athlete = athletes.find(a => a.id === athleteId);
            if (!athlete || !athlete.documents || !athlete.documents[documentType]) {
                showSuccessMessage('‚ùå Documento n√£o encontrado. Verifique se o arquivo foi anexado corretamente.');
                return;
            }
            
            const document = athlete.documents[documentType];
            
            try {
                // Create modal for document viewing
                const modalHtml = `
                    <div id="documentViewModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onclick="closeDocumentModal()">
                        <div class="bg-white rounded-xl max-w-4xl w-full mx-4 max-h-screen overflow-hidden" onclick="event.stopPropagation()">
                            <div class="flex justify-between items-center p-6 border-b">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-800">${documentType === 'healthCard' ? 'Carteirinha do Plano de Sa√∫de' : 'RG (Documento de Identidade)'}</h3>
                                    <p class="text-sm text-gray-600">${athlete.name} ‚Ä¢ ${document.name}</p>
                                    <p class="text-xs text-gray-500">Anexado em: ${new Date(document.uploadDate).toLocaleDateString('pt-BR')}</p>
                                </div>
                                <button onclick="closeDocumentModal()" class="text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="p-6 max-h-96 overflow-auto bg-gray-50">
                                <div class="bg-white rounded-lg p-4 shadow-inner">
                                    ${document.type.includes('pdf') ? 
                                        `<div class="text-center py-8">
                                            <svg class="w-16 h-16 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 6.306a7.962 7.962 0 00-6 0m6 0V3a1 1 0 00-1-1H10a1 1 0 00-1 1v3.306"/>
                                            </svg>
                                            <h4 class="text-lg font-semibold text-gray-800 mb-2">Documento PDF</h4>
                                            <p class="text-gray-600 mb-4">${document.name}</p>
                                            <p class="text-sm text-gray-500 mb-4">Clique em "Download" para visualizar o arquivo PDF</p>
                                            <button onclick="downloadDocument('${athleteId}', '${documentType}')" class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition-all">
                                                üìÑ Abrir PDF
                                            </button>
                                        </div>` :
                                        `<img src="${document.data}" alt="${document.name}" class="max-w-full h-auto mx-auto rounded-lg shadow-lg border" style="max-height: 400px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" />
                                        <div class="text-center py-8 hidden">
                                            <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                            </svg>
                                            <p class="text-gray-600">Erro ao carregar imagem</p>
                                            <button onclick="downloadDocument('${athleteId}', '${documentType}')" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-all">
                                                üì• Fazer Download
                                            </button>
                                        </div>`
                                    }
                                </div>
                            </div>
                            <div class="flex justify-between items-center p-6 border-t bg-gray-50">
                                <div class="text-sm text-gray-600">
                                    <p><strong>Tipo:</strong> ${document.type}</p>
                                    <p><strong>Tamanho:</strong> ${(document.data.length * 0.75 / 1024).toFixed(1)} KB</p>
                                </div>
                                <div class="flex space-x-3">
                                    <button onclick="downloadDocument('${athleteId}', '${documentType}')" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-all flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                        </svg>
                                        <span>Download</span>
                                    </button>
                                    <button onclick="closeDocumentModal()" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 transition-all">
                                        Fechar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Create modal element
                const modalDiv = window.document.createElement('div');
                modalDiv.innerHTML = modalHtml;
                window.document.body.appendChild(modalDiv.firstElementChild);
                
                // Add escape key listener
                const escapeHandler = function(e) {
                    if (e.key === 'Escape') {
                        closeDocumentModal();
                        window.document.removeEventListener('keydown', escapeHandler);
                    }
                };
                window.document.addEventListener('keydown', escapeHandler);
                
            } catch (error) {
                console.error('Erro ao visualizar documento:', error);
                showSuccessMessage('‚ùå Erro ao abrir o documento. Tente fazer o download.');
            }
        }

        // Download document
        function downloadDocument(athleteId, documentType) {
            console.log('Download iniciado para:', athleteId, documentType);
            
            const athlete = athletes.find(a => a.id === athleteId);
            if (!athlete || !athlete.documents || !athlete.documents[documentType]) {
                showSuccessMessage('‚ùå Documento n√£o encontrado. Verifique se o arquivo foi anexado corretamente.');
                return;
            }
            
            const documentData = athlete.documents[documentType];
            console.log('Dados do documento encontrados:', documentData.name, documentData.type);
            
            try {
                // Validate base64 data
                if (!documentData.data || !documentData.data.startsWith('data:')) {
                    console.error('Dados base64 inv√°lidos:', documentData.data ? documentData.data.substring(0, 50) : 'null');
                    showSuccessMessage('‚ùå Dados do documento corrompidos. Tente anexar o arquivo novamente.');
                    return;
                }
                
                // Convert base64 to blob
                const base64Data = documentData.data.split(',')[1];
                const mimeType = documentData.data.split(',')[0].split(':')[1].split(';')[0];
                console.log('MIME type detectado:', mimeType);
                
                // Create binary data
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                console.log('Dados bin√°rios criados, tamanho:', byteArray.length);
                
                // Create blob
                const blob = new Blob([byteArray], { type: mimeType });
                console.log('Blob criado:', blob.size, 'bytes');
                
                // Generate filename with proper extension
                const fileExtension = mimeType.includes('pdf') ? '.pdf' : 
                                    mimeType.includes('png') ? '.png' : 
                                    mimeType.includes('jpeg') || mimeType.includes('jpg') ? '.jpg' : 
                                    documentData.name.includes('.') ? documentData.name.substring(documentData.name.lastIndexOf('.')) : '.bin';
                
                const fileName = `${athlete.name.replace(/\s+/g, '_')}_${documentType === 'healthCard' ? 'Carteirinha' : 'RG'}_${new Date().toISOString().split('T')[0]}${fileExtension}`;
                console.log('Nome do arquivo gerado:', fileName);
                
                // Try multiple download methods
                let downloadSuccess = false;
                
                // Method 1: Direct blob download
                try {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = fileName;
                    link.style.display = 'none';
                    
                    // Force click with user interaction
                    document.body.appendChild(link);
                    
                    // Add click event listener to detect success
                    link.addEventListener('click', function() {
                        console.log('Link clicado com sucesso');
                        downloadSuccess = true;
                    });
                    
                    // Trigger click
                    link.click();
                    
                    // Clean up
                    setTimeout(() => {
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    }, 1000);
                    
                    console.log('M√©todo 1 executado');
                    
                } catch (method1Error) {
                    console.error('M√©todo 1 falhou:', method1Error);
                }
                
                // Method 2: Open in new window if method 1 fails
                if (!downloadSuccess) {
                    try {
                        const url = URL.createObjectURL(blob);
                        const newWindow = window.open(url, '_blank');
                        
                        if (newWindow) {
                            console.log('M√©todo 2: Nova janela aberta');
                            downloadSuccess = true;
                            
                            // Clean up after delay
                            setTimeout(() => {
                                URL.revokeObjectURL(url);
                            }, 5000);
                        }
                    } catch (method2Error) {
                        console.error('M√©todo 2 falhou:', method2Error);
                    }
                }
                
                // Method 3: Data URL fallback
                if (!downloadSuccess) {
                    try {
                        const link = document.createElement('a');
                        link.href = documentData.data;
                        link.download = fileName;
                        link.style.display = 'none';
                        
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        console.log('M√©todo 3: Data URL executado');
                        downloadSuccess = true;
                        
                    } catch (method3Error) {
                        console.error('M√©todo 3 falhou:', method3Error);
                    }
                }
                
                if (downloadSuccess) {
                    showSuccessMessage(`‚úÖ Download iniciado: ${fileName}`);
                    console.log('Download conclu√≠do com sucesso');
                } else {
                    throw new Error('Todos os m√©todos de download falharam');
                }
                
                // Close modal if open
                const modal = document.getElementById('documentViewModal');
                if (modal) {
                    setTimeout(() => closeDocumentModal(), 2000);
                }
                
            } catch (error) {
                console.error('Erro no download:', error);
                showSuccessMessage('‚ùå Erro ao fazer download. Verifique se o documento foi anexado corretamente.');
                
                // Show detailed error for debugging
                console.error('Detalhes do erro:', {
                    athleteId,
                    documentType,
                    hasDocument: !!documentData,
                    dataType: typeof documentData?.data,
                    dataStart: documentData?.data?.substring(0, 50)
                });
            }
        }

        // Close document modal
        function closeDocumentModal() {
            const modal = window.document.getElementById('documentViewModal');
            if (modal) {
                modal.remove();
            }
        }

        // Safe element access functions
        function safeGetElement(id) {
            const element = document.getElementById(id);
            if (!element) {
                console.warn(`Element with id '${id}' not found`);
            }
            return element;
        }

        function safeQuerySelector(selector) {
            const element = document.querySelector(selector);
            if (!element) {
                console.warn(`Element with selector '${selector}' not found`);
            }
            return element;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - Initializing system...');
            
            try {
                // Initialize all form handlers
                initializeAthleteForm();
                initializeMedicalForm();
                initializeHealthRecordForm();
                initializeDocumentUploads();
                initializePhotoPreview();
                
                // Check if elements exist before calling functions
                if (safeGetElement('filterSport')) {
                    populateSportFilter();
                }
                
                if (safeGetElement('athletesTable')) {
                    filterAthletes();
                }
                
                updateNextAthleteId();
                
                // Set active nav button
                const firstNavBtn = safeQuerySelector('.nav-btn');
                if (firstNavBtn) {
                    firstNavBtn.classList.add('active');
                }
                
                console.log('System initialized successfully');
                console.log('Athletes loaded:', athletes.length);
                console.log('All form handlers initialized');
            } catch (error) {
                console.error('Error during initialization:', error);
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98c0ede265e4f231',t:'MTc2MDA0NDkwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
